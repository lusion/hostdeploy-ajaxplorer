Interface.create("IAjxpWidget",{resize:function(){},showElement:function(a){}});Interface.create("IAjxpNodeProvider",{initProvider:function(a){},loadNode:function(c,a,b){}});Interface.create("IActionProvider",{getActions:function(){}});Interface.create("IFocusable",{setFocusBehaviour:function(){},focus:function(){},blur:function(){}});Interface.create("IContextMenuable",{setContextualMenu:function(a){}});Class.create("AjxpPane",{__implements:"IAjxpWidget",initialize:function(b,a){this.htmlElement=$(b);if(!this.htmlElement){throw new Error("Cannot find element for AjxpPane : "+this.__className)}if(a){this.options=a}this.htmlElement.ajxpPaneObject=this;if(this.htmlElement.getAttribute("ajxpPaneHeader")){this.addPaneHeader(this.htmlElement.getAttribute("ajxpPaneHeader"),this.htmlElement.getAttribute("ajxpPaneIcon"))}this.childrenPanes=$A([]);this.scanChildrenPanes(this.htmlElement)},resize:function(){if(this.options.fit&&this.options.fit=="height"){var marginBottom=0;if(this.options.fitMarginBottom){var expr=this.options.fitMarginBottom;try{marginBottom=parseInt(eval(expr))}catch(e){}}fitHeightToBottom(this.htmlElement,(this.options.fitParent?$(this.options.fitParent):null),expr)}this.childrenPanes.invoke("resize")},scanChildrenPanes:function(a){if(!a.childNodes){return}$A(a.childNodes).each(function(b){if(b.ajxpPaneObject){this.childrenPanes.push(b.ajxpPaneObject)}else{this.scanChildrenPanes(b)}}.bind(this))},showElement:function(a){if(a){this.htmlElement.show()}else{this.htmlElement.hide()}},addPaneHeader:function(b,a){this.htmlElement.insert({top:new Element("div",{className:"panelHeader",ajxp_message_id:b}).update(MessageHash[b])});disableTextSelection(this.htmlElement.select("div")[0])},setFocusBehaviour:function(){this.htmlElement.observe("click",function(){if(ajaxplorer){ajaxplorer.focusOn(this)}}.bind(this))}});Class.create("AjxpNode",{initialize:function(e,b,c,d,a){this._path=e;if(this._path&&this._path.length&&this._path.length>1){if(this._path[this._path.length-1]=="/"){this._path=this._path.substring(0,this._path.length-1)}}this._metadata=$H();this._isLeaf=b||false;this._label=c||"";this._icon=d||"";this._children=$A([]);this._isRoot=false;this._isLoaded=false;this.fake=false;this._iNodeProvider=a},isLoaded:function(){return this._isLoaded},setLoaded:function(a){this._isLoaded=a},load:function(a){if(this.isLoading){return}if(!a){if(this._iNodeProvider){a=this._iNodeProvider}else{a=new RemoteNodeProvider()}}this.isLoading=true;this.notify("loading");if(this._isLoaded){this.isLoading=false;this.notify("loaded");return}a.loadNode(this,function(b){this._isLoaded=true;this.isLoading=false;this.notify("loaded");this.notify("first_load")}.bind(this))},reload:function(a){this._children.each(function(b){this.removeChild(b)}.bind(this));this._isLoaded=false;this.load(a)},clear:function(){this._children.each(function(a){this.removeChild(a)}.bind(this));this._isLoaded=false;this.notify("force_clear")},setRoot:function(){this._isRoot=true},setChildren:function(a){this._children=$A(a);this._children.invoke("setParent",this)},getChildren:function(){return this._children},addChild:function(a){a.setParent(this);if(this._iNodeProvider){a._iNodeProvider=this._iNodeProvider}if(existingNode=this.findChildByPath(a.getPath())){existingNode.replaceBy(a)}else{this._children.push(a);this.notify("child_added",a.getPath())}},removeChild:function(b){var a=b.getPath();b.notify("node_removed");this._children=this._children.without(b);this.notify("child_removed",a)},replaceBy:function(a){this._isLeaf=a._isLeaf;if(a._label){this._label=a._label}if(a._icon){this._icon=a._icon}if(a._iNodeProvider){this._iNodeProvider=a._iNodeProvider}this._isRoot=a._isRoot;this._isLoaded=a._isLoaded;this.fake=a.fake;a.getChildren().each(function(c){this.addChild(c)}.bind(this));var b=a.getMetadata();b.each(function(c){if(this._metadata.get(c.key)&&c.value===""){return}this._metadata.set(c.key,c.value)}.bind(this));this.notify("node_replaced",this)},findChildByPath:function(a){return $A(this._children).find(function(b){return(b.getPath()==a)})},setMetadata:function(a){this._metadata=a},getMetadata:function(a){return this._metadata},isLeaf:function(){return this._isLeaf},getPath:function(){return this._path},getLabel:function(){return this._label},getIcon:function(){return this._icon},isRecycle:function(){return(this.getAjxpMime()=="ajxp_recycle")},inZip:function(){},hasAjxpMimeInBranch:function(c){if(this.getAjxpMime()==c.toLowerCase()){return true}var b,a=this;while(b=a._parentNode){if(b.getAjxpMime()==c.toLowerCase()){return true}a=b}return false},setParent:function(a){this._parentNode=a},getParent:function(){return this._parentNode},findInArbo:function(d,g){if(!this.getPath()){return}var f=this.getPath().split("/");var c=$A();var a="";var h,b=d;for(var e=0;e<f.length;e++){if(f[e]==""){continue}a=a+"/"+f[e];if(node=b.findChildByPath(a)){h=node}else{h=new AjxpNode(a,false,getBaseName(a));h.fake=true;g.push(h);b.addChild(h)}b=h}return h},isRoot:function(){return this._isRoot},isParentOf:function(c){var b=c.getPath();var a=this.getPath();return(b.substring(0,a.length)==a)},isChildOf:function(c){var b=this.getPath();var a=c.getPath();return(b.substring(0,a.length)==a)},getAjxpMime:function(){if(this._metadata&&this._metadata.get("ajxp_mime")){return this._metadata.get("ajxp_mime").toLowerCase()}if(this._metadata&&this.isLeaf()){return getAjxpMimeType(this._metadata).toLowerCase()}return""}});SelectableElements=Class.create({initialize:function(a,b){if(a==null){return}this.initSelectableItems(a,b)},initSelectableItems:function(b,c,a){this._htmlElement=b;this._multiple=Boolean(c);this._selectedItems=[];this._fireChange=true;this.hasFocus=false;this._onclick=function(d){if(d==null){d=b.ownerDocument.parentWindow.event}this.click(d)}.bind(this);$(this._htmlElement).observe("contextmenu",function(d){if(this._selectedItems.length>1){return}if(Prototype.Browser.WebKit){return}this.click(d)}.bind(this));this._ondblclick=function(d){if(d==null){d=b.ownerDocument.parentWindow.event}this.dblClick(d)}.bind(this);if(b.addEventListener){b.addEventListener("click",this._onclick,false)}else{if(b.attachEvent){b.attachEvent("onclick",this._onclick);b.attachEvent("ondblclick",this._ondblclick)}}this.eventMouseUp=this.dragEnd.bindAsEventListener(this);this.eventMouseDown=this.dragStart.bindAsEventListener(this);this.eventMouseMove=this.drag.bindAsEventListener(this);this.selectorAdded=false;if(a){this.dragSelectionElement=$(a)}else{this.dragSelectionElement=$(b)}Event.observe(this.dragSelectionElement,"mousedown",this.eventMouseDown)},dragStart:function(c){var a=this._htmlElement;this.originalX=c.clientX;this.originalY=c.clientY;this.dSEPosition=Position.cumulativeOffset(this.dragSelectionElement);this.dSEDimension=Element.getDimensions(this.dragSelectionElement);var b=this.dSEDimension.height;if(this.dragSelectionElement.scrollHeight>b){if(this.originalX>(this.dSEPosition[0]+this.dSEDimension.width)-18){return}}if(this.dragSelectionElement.scrollWidth>this.dSEDimension.width){if(this.originalY>(this.dSEPosition[1]+this.dSEDimension.height)-18){return}}Event.observe(document,"mousemove",this.eventMouseMove);Event.observe(document,"mouseup",this.eventMouseUp);if(!this.divSelector){this.divSelector=new Element("div",{style:"border : 1px dotted #999; background-color:#ddd;	filter:alpha(opacity=50);opacity: 0.5;-moz-opacity:0.5;z-index:100000;position:absolute;top:0px;left:0px;height:0px;width:0px;"})}$(this.dragSelectionElement).setStyle({cursor:"move"})},drag:function(u){if(!this.selectorAdded){this.body=document.getElementsByTagName("body")[0];this.body.appendChild(this.divSelector);this.selectorAdded=true}var h=u.clientX;var g=u.clientY;var v=this.dSEPosition[0];var t=this.dSEPosition[1];var B=v+this.dSEDimension.width;var A=t+this.dSEDimension.height;h=Math.max(h,v);g=Math.max(g,t);h=Math.min(h,B);g=Math.min(g,A);var l,d,p,n;d=Math.min(this.originalX,h);p=Math.abs((this.originalX-h));l=Math.min(this.originalY,g);n=Math.abs((this.originalY-g));this.divSelector.setStyle({top:l+"px",left:d+"px",width:p+"px",height:n+"px"});var m=this.getItems();var z=d;var y=d+p;var x=l;var w=l+n;for(var q=0;q<m.length;q++){var a=$(m[q]);var f=Position.cumulativeOffset(a);var o=Element.getDimensions(a);var s=f[0];var r=f[0]+o.width;var c=f[1];var b=f[1]+o.height;if(((s>=z&&s<=y)||(r>=z&&r<=y)||(z>=s&&y<=r))&&((c>=x&&c<=w)||(b>=x&&b<=w)||(x>=c&&w<=b))){this.setItemSelected(m[q],true)}else{if(!u.shiftKey&&!u.crtlKey){this.setItemSelected(m[q],false)}}}},dragEnd:function(a){Event.stopObserving(document,"mousemove",this.eventMouseMove);Event.stopObserving(document,"mouseup",this.eventMouseUp);if(this.selectorAdded){this.body.removeChild(this.divSelector);this.selectorAdded=false}$(this.dragSelectionElement).setStyle({cursor:"default"})},setItemSelected:function(c,f){if(!this._multiple){if(f){var a=this._selectedItems[0];if(c==a){return}if(a!=null){this.setItemSelectedUi(a,false)}this.setItemSelectedUi(c,true);this._selectedItems=[c];this.fireChange()}else{if(this._selectedItems[0]==c){this.setItemSelectedUi(c,false);this._selectedItems=[]}}}else{if(Boolean(c._selected)==Boolean(f)){return}this.setItemSelectedUi(c,f);if(f){this._selectedItems[this._selectedItems.length]=c}else{var e=[];var b=0;for(var d=0;d<this._selectedItems.length;d++){if(this._selectedItems[d]!=c){e[b++]=this._selectedItems[d]}}this._selectedItems=e}this.fireChange()}},setItemSelectedUi:function(d,g){if(g){$(d).addClassName("selected");$(d).addClassName("selected-focus");if(!this.skipScroll){var f=$("selectable_div");if($("table_rows_container")){f=$("table_rows_container")}var c=d.offsetTop;var e=f.getHeight();var b=f.scrollTop;var a=$(d).getHeight();if(c+a>(e+b)){f.scrollTop=c-e+a}else{if(c<(b)){f.scrollTop=c-a}}}}else{$(d).removeClassName("selected");$(d).removeClassName("selected-focus")}d._selected=g},focus:function(){this.hasFocus=true;this.selectFirst();for(var a=0;a<this._selectedItems.length;a++){if(this._selectedItems[a]){$(this._selectedItems[a]).addClassName("selected-focus")}}},blur:function(){this.hasFocus=false;for(var a=0;a<this._selectedItems.length;a++){if(this._selectedItems[a]){$(this._selectedItems[a]).removeClassName("selected-focus")}}},selectFirst:function(){if(this._selectedItems.length){return}if(this.getItem(0)!=null){this.setItemSelected(this.getItem(0),true)}},selectAll:function(){var a=this.getItems();for(var b=0;b<a.length;b++){this.setItemSelected(a[b],true)}},getItemSelected:function(a){return Boolean(a._selected)},fireChange:function(){if(!this._fireChange){return}if(typeof this.onchange=="string"){this.onchange=new Function(this.onchange)}if(typeof this.onchange=="function"){this.onchange()}},fireDblClick:function(){if(!this._fireChange){return}if(typeof this.ondblclick=="string"&&this.ondblclick!=""){this.ondblclick=new Funtion(this.ondblclick)}if(typeof this.ondblclick=="function"){this.ondblclick()}},dblClick:function(a){this.fireDblClick()},click:function(m){if(m.detail&&m.detail>1){this.fireDblClick()}var a=this._fireChange;this._fireChange=false;var n=this.getSelectedItems();var c=m.target!=null?m.target:m.srcElement;while(c!=null&&!this.isItem(c)){c=c.parentNode}if(c==null){this._fireChange=a;return}var f=c;var b=this._anchorIndex;if(this._selectedItems.length==0||(m.ctrlKey&&!m.shiftKey&&this._multiple)){b=this._anchorIndex=f}if(!m.ctrlKey&&!m.shiftKey||!this._multiple){var o=this._selectedItems;for(var l=o.length-1;l>=0;l--){if(o[l]._selected&&o[l]!=c){this.setItemSelectedUi(o[l],false)}}this._anchorIndex=f;if(!c._selected){this.setItemSelectedUi(c,true)}this._selectedItems=[c]}else{if(this._multiple&&m.ctrlKey&&!m.shiftKey){this.setItemSelected(c,!c._selected);this._anchorIndex=f}else{if(this._multiple&&m.ctrlKey&&m.shiftKey){var d=this.isBefore(f,b);var p=b;while(p!=null&&p!=f){if(!p._selected&&p!=c){this.setItemSelected(p,true)}p=d?this.getPrevious(p):this.getNext(p)}if(!c._selected){this.setItemSelected(c,true)}}else{if(this._multiple&&!m.ctrlKey&&m.shiftKey){var d=this.isBefore(f,b);var o=this._selectedItems;for(var l=o.length-1;l>=0;l--){this.setItemSelectedUi(o[l],false)}this._selectedItems=[];var p=b;this.skipScroll=true;while(p!=null){this.setItemSelected(p,true);if(p==f-1){this.skipScroll=false}if(p==f){break}p=d?this.getPrevious(p):this.getNext(p)}this.skipScroll=false}}}}var q;var h=n.length!=this._selectedItems.length;if(!h){for(var l=0;l<n.length;l++){q=false;for(var g=0;g<this._selectedItems.length;g++){if(n[l]==this._selectedItems[g]){q=true;break}}if(!q){h=true;break}}}this._fireChange=a;if(h&&this._fireChange){this.fireChange()}},getSelectedItems:function(){var b=this._selectedItems;var a=b.length;var d=new Array(a);for(var c=0;c<a;c++){d[c]=b[c]}return d},getSelectedNodes:function(){var b=this._selectedItems;var a=$A([]);for(var c=0;c<b.length;c++){if(b[c].ajxpNode){a.push(b[c].ajxpNode)}}return a},setSelectedNodes:function(c){var a=this.getItems();for(var b=0;b<a.length;b++){if(a[b].ajxpNode&&c.detect(function(d){return(d.getPath()==a[b].ajxpNode.getPath())})){this.setItemSelected(a[b],true)}else{this.setItemSelected(a[b],false)}}},isItem:function(a){return a!=null&&a.nodeType==1&&a.parentNode==this._htmlElement},findSelectableParent:function(a,b){while(a!=null&&!this.isItem(a)){a=a.parentNode}if(a!=null&&b){this.setItemSelected(a,true)}return a},destroy:function(){if(this._htmlElement.removeEventListener){this._htmlElement.removeEventListener("click",this._onclick,false)}else{if(this._htmlElement.detachEvent){this._htmlElement.detachEvent("onclick",this._onclick)}}this._htmlElement=null;this._onclick=null;this._selectedItems=null},getNext:function(a){var b=a.nextSibling;if(b==null||this.isItem(b)){return b}return this.getNext(b)},getPrevious:function(a){var b=a.previousSibling;if(b==null||this.isItem(b)){return b}return this.getPrevious(b)},isBefore:function(c,a){var b=this.getNext(c);while(b!=null){if(b==a){return true}b=this.getNext(b)}return false},getItems:function(){var d=[];var b=0;var e=this._htmlElement.childNodes;var a=e.length;for(var c=0;c<a;c++){if(e[c].nodeType==1){d[b++]=e[c]}}return d},getItem:function(a){var c=0;var e=this._htmlElement.childNodes;var b=e.length;for(var d=0;d<b;d++){if(e[d].nodeType==1){if(c==a){return e[d]}c++}}return null},getSelectedIndexes:function(){var b=this.getSelectedItems();var a=b.length;var d=new Array(a);for(var c=0;c<a;c++){d[c]=this.getItemIndex(b[c])}return d},getItemIndex:function(e){var b=0;var d=this._htmlElement.childNodes;var a=d.length;for(var c=0;c<a;c++){if(d[c]==e){return b}if(d[c].nodeType==1){b++}}return -1}});SortableTable=Class.create({initialize:function(c,b,a){this.gecko=Prototype.Browser.Gecko;this.msie=Prototype.Browser.IE;this.removeBeforeSort=this.gecko;this.sortTypes=b||[];this.sortColumn=null;this.descending=null;this._headerOnclick=function(f){this.headerOnclick(f)}.bind(this);if(c){this.setTable(c,a);this.document=c.ownerDocument||c.document}else{this.document=document}var d=this.document.defaultView||this.document.parentWindow;this._onunload=function(){this.destroy()}.bind(this);if(d&&typeof d.attachEvent!="undefined"){d.attachEvent("onunload",this._onunload)}this.addSortType("Number",Number);this.addSortType("CaseInsensitiveString",this.toUpperCase);this.addSortType("Date",this.toDate);this.addSortType("String")},onsort:function(){},defaultDescending:false,_sortTypeInfo:{},setTable:function(b,a){if(this.tHead){this.uninitHeader()}this.element=b;this.setTHead((a?a:b.tHead));this.setTBody(b.tBodies[0])},setTHead:function(a){if(this.tHead&&this.tHead!=a){this.uninitHeader()}this.tHead=$(a);this.initHeader(this.sortTypes)},setTBody:function(a){this.tBody=$(a)},setSortTypes:function(a){if(this.tHead){this.uninitHeader()}this.sortTypes=a||[];if(this.tHead){this.initHeader(this.sortTypes)}},getHeaderCells:function(){if(!this.headerCells){this.headerCells=this.tHead.select("div.header_cell");this.headerCells.each(function(a){var b=a.previous("div");if(b&&b.hasClassName("resizer")){a.resizer=b}})}return this.headerCells},initHeader:function(b){if(!this.tHead){return}var d=this.getHeaderCells();this.sortTypes=b||[];var a=d.length;var f;for(var e=0;e<a;e++){f=d[e];f.cellIndex=e;if(this.sortTypes[e]!=null&&this.sortTypes[e]!="None"){if(this.sortTypes[e]!=null){f._sortType=this.sortTypes[e]}f.observe("click",this._headerOnclick.bind(this))}else{f.setAttribute("_sortType",b[e]);f._sortType="None"}}this.updateHeaderArrows()},onHeaderResize:function(a){},setGridCellWidth:function(l,a){var h=l.down(".text_label");if(!h){if(a){l.setStyle({width:a+"px"})}return}var g;if(a){g=parseInt(a)}else{g=l.getWidth()-3}var e=l.getStyle("paddingLeft")||0;var b=l.getStyle("paddingRight")||0;var c=h.getStyle("paddingLeft")||0;var d=h.getStyle("paddingRight")||0;var f=1;h.siblings().each(function(m){f+=m.getWidth()});h.setStyle({width:(g-f-parseInt(e)-parseInt(b)-parseInt(c)-parseInt(d))+"px"});if(a){l.setStyle({width:g+"px"})}},uninitHeader:function(){try{var b=this.getHeaderCells()}catch(f){return}var a=b.length;var g;for(var d=0;d<a;d++){g=b[d];if(g._sortType!=null&&g._sortType!="None"){if(g.firstChild){g.removeChild(g.firstChild)}if(typeof g.removeEventListener!="undefined"){g.removeEventListener("click",this._headerOnclick,false)}else{if(typeof g.detachEvent!="undefined"){g.detachEvent("onclick",this._headerOnclick)}}g._sortType=null;g.removeAttribute("_sortType")}}},updateHeaderArrows:function(){if(!this.tHead){return}var b=this.getHeaderCells();var a=b.length;for(var c=0;c<a;c++){if(b[c]._sortType!=null&&b[c]._sortType!="None"){b[c].removeClassName("descending");b[c].removeClassName("ascending");if(b[c].resizer){b[c].resizer.removeClassName("resizer_sortable")}if(c==this.sortColumn){b[c].addClassName(this.descending?"descending":"ascending");if(b[c].resizer){b[c].resizer.addClassName("resizer_sortable")}}}}},headerOnclick:function(b){var a=Event.findElement(b);this.sort(a.cellIndex)},getCellIndex:function(d){var b=d.parentNode.childNodes;var a=b.length;var c;for(c=0;b[c]!=d&&c<a;c++){}return c},getSortType:function(a){return this.sortTypes[a]||"String"},sort:function(d,m,b){if(!this.tBody){return}if(b==null){b=this.getSortType(d)}if(b=="None"){return}if(m==null){if(this.sortColumn!=d){this.descending=this.defaultDescending}else{this.descending=!this.descending}}else{this.descending=m}this.sortColumn=d;if(typeof this.onbeforesort=="function"){this.onbeforesort()}var n=this.getSortFunction(b,d);var o=this.getCache(b,d);var q=this.tBody;o.sort(n);if(this.descending){o.reverse()}if(this.removeBeforeSort){var g=q.nextSibling;var c=q.parentNode;c.removeChild(q)}var e=o.length;for(var h=0;h<e;h++){q.appendChild(o[h].element)}if(this.removeBeforeSort){c.insertBefore(q,g)}this.updateHeaderArrows();this.destroyCache(o);if(typeof this.onsort=="function"){this.onsort()}},asyncSort:function(c,a,d){var b=this;this._asyncsort=function(){b.sort(c,a,d)};window.setTimeout(this._asyncsort,1)},getCache:function(h,f){if(!this.tBody){return[]}var g=this.tBody.rows;var c=g.length;var b=new Array(c);var e;for(var d=0;d<c;d++){e=g[d];b[d]={value:this.getRowValue(e,h,f),element:e}}return b},destroyCache:function(c){var a=c.length;for(var b=0;b<a;b++){c[b].value=null;c[b].element=null;c[b]=null}},getRowValue:function(a,f,d){if(this._sortTypeInfo[f]&&this._sortTypeInfo[f].getRowValue){return this._sortTypeInfo[f].getRowValue(a,d)}var b;var e=a.cells[d];if(typeof e.innerText!="undefined"){b=e.innerText}else{b=this.getInnerText(e)}return this.getValueFromString(b,f)},getInnerText:function(e){var d="";var c=e.childNodes;var a=c.length;for(var b=0;b<a;b++){switch(c[b].nodeType){case 1:d+=this.getInnerText(c[b]);break;case 3:d+=c[b].nodeValue;break}}return d},getValueFromString:function(a,b){if(this._sortTypeInfo[b]){return this._sortTypeInfo[b].getValueFromString(a)}return a},getSortFunction:function(b,a){if(this._sortTypeInfo[b]){return this._sortTypeInfo[b].compare}return this.basicCompare},destroy:function(){this.uninitHeader();var a=this.document.parentWindow;if(a&&typeof a.detachEvent!="undefined"){a.detachEvent("onunload",this._onunload)}this._onunload=null;this.element=null;this.tHead=null;this.tBody=null;this.headerCells=null;this.document=null;this._headerOnclick=null;this.sortTypes=null;this._asyncsort=null;this.onsort=null},addSortType:function(d,a,c,b){this._sortTypeInfo[d]={type:d,getValueFromString:a||this.idFunction,compare:c||this.basicCompare,getRowValue:b}},removeSortType:function(a){delete this._sortTypeInfo[a]},basicCompare:function compare(b,a){if(b.value<a.value){return -1}if(a.value<b.value){return 1}return 0},idFunction:function(a){return a},toUpperCase:function(a){return a.toUpperCase()},toDate:function(a){var b=a.split("-");var c=new Date(0);c.setFullYear(b[0]);c.setDate(b[2]);c.setMonth(b[1]-1);return c.valueOf()}});if(Object.isUndefined(Proto)){var Proto={}}Proto.Menu=Class.create({initialize:function(){var a=Prototype.emptyFunction;this.ie=Prototype.Browser.IE;this.options=Object.extend({selector:".contextmenu",className:"protoMenu",mouseClick:"right",anchor:"mouse",pageOffset:25,topOffset:0,leftOffset:0,submenuArrow:ajxpResourcesFolder+"/images/arrow_right.png",position:"bottom",menuTitle:"",fade:false,zIndex:100,createAnchor:false,anchorContainer:null,anchorSrc:"",anchorTitle:"",anchorPosition:"last",beforeShow:a,beforeHide:a,beforeSelect:a,shadowOptions:{distance:4,angle:130,opacity:0.3,nestedShadows:3,color:"#000000"}},arguments[0]||{});this.subMenus=$A();this.shim=new Element("iframe",{style:"position:absolute;filter:progid:DXImageTransform.Microsoft.Alpha(opacity=0);display:none",src:"javascript:false;",frameborder:0});if(this.options.createAnchor){this.createAnchor()}else{if(typeof(this.options.anchor)=="string"&&this.options.anchor!="mouse"){this.options.selector='[id="'+this.options.anchor+'"]'}else{if(typeof(this.options.anchor)!="string"){this.options.selector=this.options.anchor}}}this.eventToObserve=((this.options.mouseClick!="right"||Prototype.Browser.Opera)?"click":"contextmenu");if(this.options.mouseClick=="over"){this.eventToObserve="mouseover"}this.options.fade=this.options.fade&&!Object.isUndefined(Effect);this.container=new Element("div",{className:this.options.className,style:"display:none"});if(this.options.mouseClick=="right"){$(document.body).observe("contextmenu",function(b){Event.stop(b)});$(document.body).insert(this.container.observe("contextmenu",Event.stop))}else{$(document.body).insert(this.container)}if(this.ie){$(document.body).insert(this.shim)}if(this.eventToObserve=="mouseover"){this.container.observe("mouseover",this.mouseoverFunction.bind(this));this.container.observe("mouseout",this.mouseoutFunction.bind(this))}document.observe("click",function(b){if(this.container.visible()&&!b.isRightClick()){this.hide()}}.bind(this));this.addElements(this.options.selector)},destroy:function(){try{if(this.subMenus.length){this.subMenus.invoke("destroy")}if(this.ie){this.shim.remove()}this.container.remove();if(this.options.createAnchor&&this.options.anchor){this.options.anchor.remove()}}catch(a){}},observerFunction:function(a){if(this.options.mouseClick=="right"&&Prototype.Browser.Opera&&!a.ctrlKey){return}if(this.options.mouseClick=="left"&&Event.findElement(a,".protomenu_selector")&&Event.findElement(a,".protomenu_selector").hasClassName("disabled")){return}this.show(a)},mouseoverFunction:function(a){if(this.timer){window.clearTimeout(this.timer);this.timer=null}},mouseoutFunction:function(a){this.timer=window.setTimeout(function(){this.hide(a)}.bind(this),300)},removeElements:function(a){if(typeof(a)=="string"){$$(a).invoke("removeClassName","protomenu_selector");$$(a).invoke("stopObserving",this.eventToObserve,this.observerFunction.bind(this))}else{$(a).removeClassName("protomenu_selector");$(a).stopObserving(this.eventToObserve,this.observerFunction.bind(this))}},addElements:function(a){if(typeof(a)=="string"){$$(a).invoke("observe",this.eventToObserve,this.observerFunction.bind(this));$$(a).invoke("addClassName","protomenu_selector");if(this.eventToObserve=="mouseover"){$$(a).invoke("observe","mouseover",this.mouseoverFunction.bind(this));$$(a).invoke("observe","mouseout",this.mouseoutFunction.bind(this))}}else{$(a).observe(this.eventToObserve,this.observerFunction.bind(this));$(a).addClassName("protomenu_selector");if(this.eventToObserve=="mouseover"){$(a).observe("mouseover",this.mouseoverFunction.bind(this));$(a).observe("mouseout",this.mouseoutFunction.bind(this))}}},refreshList:function(){this.container.childElements().invoke("remove");var a=new Element("ul");if(this.options.menuTitle!=""){var c=this.options.menuTitle;a.insert(new Element("li",{text:c,className:"menuTitle"}).update(c))}this.options.menuItems.each(function(f){var e=new Element("li",{className:f.separator?"separator":""});if(f.moreActions){var d=new Element("div",{className:"menuActions"});f.moreActions.each(function(h){d.insert(new Element("a",{title:h.name,href:"#"}).writeAttribute("onclick","return false;").observe("click",h.callback).insert('<img src="'+h.image+'" width="16" height="16" border="0">'))});e.insert(d);d.observe("mouseover",function(){e.select("a.enabled")[0].addClassName("hovered")});d.observe("mouseout",function(){e.select("a.enabled")[0].removeClassName("hovered")})}if(f.subMenu){var g=new Element("div",{className:"menuActions",style:"padding-top:7px;padding-right:5px"});g.insert(new Element("img",{src:this.options.submenuArrow,width:6,height:10}));e.insert(g)}e.insert(f.separator?"":Object.extend(new Element("a",{href:"#",title:f.alt,className:(f.className?f.className+" ":"")+(f.disabled?"disabled":"enabled"),style:(f.isDefault?"font-weight:bold":"")}),{_callback:f.callback}).writeAttribute("onclick","return false;").observe("click",this.onClick.bind(this)).observe("contextmenu",Event.stop).update(Object.extend(new Element("img",{src:f.image,border:"0",height:16,width:16,align:"absmiddle"}),{_callback:f.callback})).insert(f.name));e._callback=f.callback;if(f.subMenu){if(!f.subMenuBeforeShow){f.subMenuBeforeShow=Prototype.emptyFunction}if(!f.subMenuBeforeHide){f.subMenuBeforeHide=Prototype.emptyFunction}e.subMenu=new Proto.Menu({mouseClick:"over",anchor:e,className:"menu desktop",topOffset:0,leftOffset:-1,menuItems:f.subMenu,fade:false,zIndex:2010,position:"right",parent:this,beforeShow:function(){var h=e.subMenu;if(h.options.parent&&h.options.parent.subMenus){h.options.parent.subMenus.invoke("hide")}if(h.options.anchor){h.options.anchor.addClassName("menuAnchorSelected")}window.setTimeout(function(){f.subMenuBeforeShow(h)},0)},beforeHide:function(){var h=e.subMenu;if(h.options.anchor){h.options.anchor.removeClassName("menuAnchorSelected")}window.setTimeout(function(){f.subMenuBeforeHide(h)},0)}});window.setTimeout(function(){f.subMenuBeforeShow(e.subMenu)},0);this.subMenus.push(e.subMenu)}a.insert(e)}.bind(this));this.container.insert(a);try{Shadower.shadow(this.container,this.options.shadowOptions,true)}catch(b){}},show:function(c){if(this.options.parent&&this.options.parent.subMenus){this.options.parent.subMenus.map(function(d){if(d!=this){d.hide()}}.bind(this))}this.options.beforeShow(c);this.refreshList();var b={};var a=this.container.getDimensions();if(this.options.anchor=="mouse"){b=this.computeMouseOffset(c)}else{b=this.computeAnchorOffset()}this.container.setStyle(b);this.container.setStyle({zIndex:this.options.zIndex});if(this.ie){this.shim.setStyle(Object.extend(Object.extend(a,b),{zIndex:this.options.zIndex-1})).show()}if(this.options.fade){Effect.Appear(this.container,{duration:this.options.fadeTime||0.15,afterFinish:function(d){this.checkHeight(b.top);Shadower.showShadows(this.container,this.options.shadowOptions)}.bind(this)})}else{this.container.show();this.checkHeight(b.top);Shadower.showShadows(this.container,this.options.shadowOptions)}this.event=c},checkHeight:function(c){if(this.options.anchor=="mouse"){return}var d=getViewPortHeight();var b=document.viewport.getScrollOffsets();var a=this.container.getDimensions();var e=parseInt(c);if((e-b.top+a.height)>d){this.container.setStyle({height:(d-(e-b.top))+"px",overflowY:"scroll"});if(!this.containerShrinked){this.container.setStyle({width:a.width+16+"px"})}this.containerShrinked=true}else{this.container.setStyle({height:"auto",overflowY:"hidden"})}},computeMouseOffset:function(g){var b=Event.pointer(g).x,h=Event.pointer(g).y,d=document.viewport.getDimensions(),f=document.viewport.getScrollOffsets(),a=this.container.getDimensions(),c={left:((b+a.width+this.options.pageOffset)>d.width?(d.width-a.width-this.options.pageOffset):b)+"px",top:((h-f.top+a.height)>d.height&&(h-f.top)>a.height?(h-a.height):h)+"px"};return c},computeAnchorOffset:function(){var e=Position.cumulativeOffset($(this.options.anchor));var d=this.options.anchor.cumulativeScrollOffset();if(this.options.position=="bottom"||this.options.position=="bottom right"){var b=e[1]+$(this.options.anchor).getHeight()+this.options.topOffset-d[1];var c=e[0]+this.options.leftOffset-d[0];if(this.options.position=="bottom right"){c=e[0]+$(this.options.anchor).getWidth()+this.options.leftOffset-d[0];c-=this.container.getWidth()}}else{if(this.options.position=="right"){var a=document.viewport.getDimensions();var b=e[1]+this.options.topOffset-d[1];var c=e[0]+$(this.options.anchor).getWidth()+this.options.leftOffset-d[0];if(c+this.container.getDimensions().width>a.width){c=e[0]-(this.container.getDimensions().width)}}}this.anchorOffset={top:b+"px",left:c+"px"};return this.anchorOffset},createAnchor:function(){if(!this.options.createAnchor||this.options.anchor=="mouse"){return}this.options.anchor=new Element("img",{id:this.options.anchor,src:this.options.anchorSrc,alt:this.options.anchorTitle,align:"absmiddle"}).setStyle({cursor:"pointer"});this.options.anchorContainer.appendChild(this.options.anchor);this.options.selector=this.options.anchor},onClick:function(a){if(a.target._callback&&!a.target.hasClassName("disabled")){this.options.beforeSelect(a);if(this.options.anchor&&typeof(this.options.anchor)!="string"){this.options.anchor.removeClassName("menuAnchorSelected")}if(this.ie){this.shim.hide()}Shadower.deshadow(this.container);this.container.hide();a.target._callback(this.event)}},hide:function(a){this.options.beforeHide(a);if(this.ie){this.shim.hide()}Shadower.deshadow(this.container);this.container.setStyle({height:"auto",overflowY:"hidden"});this.container.hide();if(this.subMenus.length){$A(this.subMenus).invoke("destroy");this.subMenus=$A()}}});Class.create("Splitter",AjxpPane,{initialize:function(a,c){this.options=Object.extend({direction:"vertical",activeClass:"active",fit:null,onDrag:Prototype.EmptyFunction,endDrag:Prototype.EmptyFunction,startDrag:Prototype.EmptyFunction},arguments[1]||{});var b={cursor:"e-resize",splitbarClass:"vsplitbar",eventPointer:Event.pointerX,set:"left",adjust:"width",getAdjust:this.getWidth,offsetAdjust:"offsetWidth",adjSide1:"Left",adjSide2:"Right",fixed:"height",getFixed:this.getHeight,offsetFixed:"offsetHeight",fixSide1:"Top",fixSide2:"Bottom"};var e={cursor:"n-resize",splitbarClass:"hsplitbar",eventPointer:Event.pointerY,set:"top",adjust:"height",getAdjust:this.getHeight,offsetAdjust:"offsetHeight",adjSide1:"Top",adjSide2:"Bottom",fixed:"width",getFixed:this.getWidth,offsetFixed:"offsetWidth",fixSide1:"Left",fixSide2:"Right"};if(this.options.direction=="vertical"){Object.extend(this.options,b)}else{Object.extend(this.options,e)}this.htmlElement=$(a);this.htmlElement.ajxpPaneObject=this;this.group=$(a).setStyle({position:"relative"});var d=this.group.childElements();d.each(function(f){f.setStyle({position:"absolute",margin:0})});this.paneA=d[0];this.paneB=d[1];this.initBorderA=parseInt(this.paneA.getStyle("borderWidth"))||0;this.initBorderB=parseInt(this.paneB.getStyle("borderWidth"))||0;this.splitbar=new Element("div",{unselectable:"on"});this.splitbar.addClassName(this.options.splitbarClass).setStyle({position:"absolute",cursor:this.options.cursor,fontSize:"1px"});this.paneA.insert({after:this.splitbar});this.splitbar.observe("mousedown",this.startSplit.bind(this));this.splitbar.observe("mouseup",this.endSplit.bind(this));this.initCaches();this.paneA._init=(this.options.initA==true?parseInt(this.options.getAdjust(this.paneA)):this.options.initA)||0;this.paneB._init=(this.options.initB==true?parseInt(this.options.getAdjust(this.paneB)):this.options.initB)||0;if(this.paneB._init){this.paneB.setStyle(this.makeStyleObject(this.options.adjust,this.paneB._init))}if(this.paneA._init){this.paneA.setStyle(this.makeStyleObject(this.options.adjust,this.paneA._init))}this.resizeGroup(null,this.paneB._init||this.paneA._init||Math.round((this.group[this.options.offsetAdjust]-this.group._borderAdjust-this.splitbar._adjust)/2));Event.observe(document,"ajaxplorer:user_logged",function(){if(!ajaxplorer||!ajaxplorer.user){return}var f=ajaxplorer.user.getPreference(this.htmlElement.id+"_size");if(f){this.moveSplitter(parseInt(f))}}.bind(this));Event.observe(this.group,"mousemove",this.doSplitMouse.bind(this));Event.observe(this.group,"mouseup",this.endSplit.bind(this));this.splitbar.draggable=true},resizeGroup:function(e,d,a){var c=this.group._adjust;this.group._fixed=this.options.getFixed(this.group)-this.group._borderFixed;this.group._adjust=this.group[this.options.offsetAdjust]-this.group._borderAdjust;if(this.group._fixed<=0||this.group._adjust<=0){return}var f=this.options.fixed;var b=(!Prototype.Browser.IE?(this.initBorderA*2):0);this.paneA.setStyle(this.makeStyleObject(f,this.group._fixed-this.paneA._padFixed-b+"px"));var b=(!Prototype.Browser.IE?(this.initBorderB*2):0);this.paneB.setStyle(this.makeStyleObject(f,this.group._fixed-this.paneB._padFixed-b+"px"));this.splitbar.setStyle(this.makeStyleObject(f,this.group._fixed+"px"));if(a&&!d&&c){d=parseInt(this.paneA[this.options.offsetAdjust]*this.group._adjust/c)}else{d=d||(!this.options.initB?this.paneA[this.options.offsetAdjust]:this.group._adjust-this.paneB[this.options.offsetAdjust]-this.splitbar._adjust)}this.moveSplitter(d)},startSplit:function(a){this.splitbar.addClassName(this.options.activeClass);this.paneA._posAdjust=this.paneA[this.options.offsetAdjust]-this.options.eventPointer(a);if(this.options.startDrag){this.options.startDrag(this.getCurrentSize())}},doSplitMouse:function(a){if(!this.splitbar.hasClassName(this.options.activeClass)){return this.endSplit(a)}this.moveSplitter(this.paneA._posAdjust+this.options.eventPointer(a))},endSplit:function(a){if(!this.splitbar.hasClassName(this.options.activeClass)){return}this.splitbar.removeClassName(this.options.activeClass);if(this.options.endDrag){this.options.endDrag(this.getCurrentSize())}if($(this.paneA).ajxpPaneObject){$(this.paneA).ajxpPaneObject.resize()}if($(this.paneB).ajxpPaneObject){$(this.paneB).ajxpPaneObject.resize()}if(ajaxplorer&&ajaxplorer.user){ajaxplorer.user.setPreference(this.htmlElement.id+"_size",this.getCurrentSize());ajaxplorer.user.savePreference(this.htmlElement.id+"_size")}},moveSplitter:function(d){d=Math.max(this.paneA._min+this.paneA._padAdjust,this.group._adjust-(this.paneB._max||9999),16,Math.min(d,this.paneA._max||9999,this.group._adjust-this.splitbar._adjust-Math.max(this.paneB._min+this.paneB._padAdjust,16)));var a=this.options.set;var c=this.options.adjust;this.splitbar.setStyle(this.makeStyleObject(this.options.set,d+"px"));var b=0;if(!Prototype.Browser.IE&&this.initBorderA){b=this.initBorderA*2}this.paneA.setStyle(this.makeStyleObject(this.options.adjust,d-this.paneA._padAdjust-b+"px"));this.paneB.setStyle(this.makeStyleObject(this.options.set,d+this.splitbar._adjust+"px"));if(!Prototype.Browser.IE&&this.initBorderB){b=this.initBorderB*2}this.paneB.setStyle(this.makeStyleObject(this.options.adjust,this.group._adjust-this.splitbar._adjust-this.paneB._padAdjust-d-b+"px"));if(!Prototype.Browser.IE){this.paneA.fire("resize");this.paneB.fire("resize")}if(this.options.onDrag){this.options.onDrag()}if($(this.paneA).ajxpPaneObject){$(this.paneA).ajxpPaneObject.resize()}if($(this.paneB).ajxpPaneObject){$(this.paneB).ajxpPaneObject.resize()}},cssCache:function(f,e,a,c,b){var d=(!Prototype.Browser.IE||document.compatMode=="CSS1Compat");f[e]=d?(parseInt(f.getStyle(a+c))||0)+(parseInt(f.getStyle(a+b))||0):0},optCache:function(b,a){b._min=Math.max(0,this.options["min"+a]||parseInt(b.getStyle("min-"+this.options.adjust))||0);b._max=Math.max(0,this.options["max"+a]||parseInt(b.getStyle("max-"+this.options.adjust))||0)},initCaches:function(){this.splitbar._adjust=this.splitbar[this.options.offsetAdjust];this.cssCache(this.group,"_borderAdjust","border",this.options.adjSide1,this.options.adjSide2);this.cssCache(this.group,"_borderFixed","border",this.options.fixSide1,this.options.fixSide2);this.cssCache(this.paneA,"_padAdjust","padding",this.options.adjSide1,this.options.adjSide2);this.cssCache(this.paneA,"_padFixed","padding",this.options.fixSide1,this.options.fixSide2);this.cssCache(this.paneB,"_padAdjust","padding",this.options.adjSide1,this.options.adjSide2);this.cssCache(this.paneB,"_padFixed","padding",this.options.fixSide1,this.options.fixSide2);this.optCache(this.paneA,"A");this.optCache(this.paneB,"B")},getWidth:function(a){return a.offsetWidth},getHeight:function(b){if(b.offsetHeight){return parseInt(b.offsetHeight)}else{var a=b.getHeight();if(!a){a=$(b.parentNode).getHeight();if(!Prototype.Browser.IE){a-=parseInt($(b.parentNode).paddingHeight*2)}}return a}},makeStyleObject:function(c,b){var a={};a[c]=b;return a},getCurrentSize:function(){return this.options.getAdjust(this.paneA)},resize:function(){if(this.options.fit&&this.options.fit=="height"){fitHeightToBottom(this.htmlElement,(this.options.fitParent?$(this.options.fitParent):null))}this.resizeGroup(null,null,true)},showElement:function(a){}});Proto.History=Class.create({historyCurrentHash:undefined,historyCallback:undefined,initialize:function(c){this.historyCallback=c;var b=location.hash;this.historyCurrentHash=b;if(Prototype.Browser.IE){if(this.historyCurrentHash==""){this.historyCurrentHash="#"}bod=document.getElementsByTagName("body")[0];var a=new Element("iframe");a.writeAttribute("id","prototype_history").writeAttribute("style","display:none;");bod.appendChild(a);a=$("prototype_history").contentWindow.document;a.open();a.close();a.location.hash=b}else{if(Prototype.Browser.WebKit){this.historyBackStack=[];this.historyBackStack.length=history.length;this.historyForwardStack=[];this.isFirst=true}}new PeriodicalExecuter(function(){this.historyCheck()}.bind(this),0.2)},historyAddHistory:function(a){this.historyBackStack.push(a);this.historyForwardStack.length=0;this.isFirst=true},historyCheck:function(){if(Prototype.Browser.IE){var c=$("prototype_history").contentDocument||$("prototype_history").contentWindow.document;var e=c.location.hash;if(e!=this.historyCurrentHash){location.hash=e;this.refreshFavicon();this.historyCurrentHash=e;this.historyCallback(e.replace(/^#/,""))}}else{if(Prototype.Browser.WebKit){if(!this.dontCheck){var a=history.length-this.historyBackStack.length;if(a){this.isFirst=false;if(a<0){for(var b=0;b<Math.abs(a);b++){this.historyForwardStack.unshift(this.historyBackStack.pop())}}else{for(var b=0;b<a;b++){this.historyBackStack.push(this.historyForwardStack.shift())}}var d=this.historyBackStack[this.historyBackStack.length-1];if(d!=undefined){this.historyCurrentHash=location.hash;this.historyCallback(d)}}else{if(this.historyBackStack[this.historyBackStack.length-1]==undefined&&!this.isFirst){if(document.URL.indexOf("#")>=0){this.historyCallback(document.URL.split("#")[1])}else{var e=location.hash;this.historyCallback("")}this.isFirst=true}}}}else{var e=location.hash;if(e!=this.historyCurrentHash){this.historyCurrentHash=e;this.historyCallback(e.replace(/^#/,""))}}}},historyLoad:function(c){var d;if(Prototype.Browser.WebKit){d=c}else{d="#"+c;location.hash=d;this.refreshFavicon()}this.historyCurrentHash=d;if(Prototype.Browser.IE){var b=$("prototype_history").contentWindow.document;b.open();b.close();b.location.hash=d}else{if(Prototype.Browser.WebKit){this.dontCheck=true;this.historyAddHistory(c);var a=function(){this.dontCheck=false}.bind(this);window.setTimeout(a,200);location.hash=d;this.refreshFavicon()}else{}}},refreshFavicon:function(){if(!Prototype.Browser.Gecko){return}var a=$$('link[type="image/x-png"]')[0].remove();$$("head")[0].insert('<link href="'+a.href+'" type="image/x-png" rel="icon">');delete a}});var CookieJar=Class.create();CookieJar.prototype={appendString:"__CJ_",initialize:function(b){this.options={expires:3600,path:"",domain:"",secure:""};Object.extend(this.options,b||{});if(this.options.expires!=""){var a=new Date();a=new Date(a.getTime()+(this.options.expires*1000));this.options.expires="; expires="+a.toGMTString()}if(this.options.path!=""){this.options.path="; path="+escape(this.options.path)}if(this.options.domain!=""){this.options.domain="; domain="+escape(this.options.domain)}if(this.options.secure=="secure"){this.options.secure="; secure"}else{this.options.secure=""}},put:function(a,c){a=this.appendString+a;cookie=this.options;var b=typeof c;switch(b){case"undefined":case"function":case"unknown":return false;case"boolean":case"string":case"number":c=String(c.toString())}var f=a+"="+escape(Object.toJSON(c));try{document.cookie=f+cookie.expires+cookie.path+cookie.domain+cookie.secure}catch(d){return false}return true},remove:function(c){c=this.appendString+c;cookie=this.options;try{var b=new Date();b.setTime(b.getTime()-(3600*1000));var a="; expires="+b.toGMTString();document.cookie=c+"="+a+cookie.path+cookie.domain+cookie.secure}catch(d){return false}return true},get:function(a){a=this.appendString+a;var b=document.cookie.match(a+"=(.*?)(;|$)");if(b){return(unescape(b[1])).evalJSON()}else{return null}},empty:function(){keys=this.getKeys();size=keys.size();for(i=0;i<size;i++){this.remove(keys[i])}},getPack:function(){pack={};keys=this.getKeys();size=keys.size();for(i=0;i<size;i++){pack[keys[i]]=this.get(keys[i])}return pack},getKeys:function(){keys=$A();keyRe=/[^=; ]+(?=\=)/g;str=document.cookie;CJRe=new RegExp("^"+this.appendString);while((match=keyRe.exec(str))!=undefined){if(CJRe.test(match[0].strip())){keys.push(match[0].strip().gsub("^"+this.appendString,""))}}return keys}};var Protopass=Class.create({initialize:function(f,c){this.item=$(f);this.field_name=this.item.id;this.options={messages:["Unsafe password word!","Too short","Very weak","Weak","Medium","Strong","Very strong"],colors:["#f00","#999","#f00","#c06","#f60","#3c0","#2c0"],scores:[10,15,30,40],common:["password","123456","123","1234","mypass","pass","letmein","qwerty","monkey","asdfgh","zxcvbn","pass"],minchar:8,barContainer:this.item,barPosition:"after",labelWidth:39};if(window.MessageHash){var e=[379,380,381,382,383,384,385];for(var d in e){this.options.messages[d]=window.MessageHash[e[d]]}}if(window.ajxpBootstrap&&window.ajxpBootstrap.parameters.get("password_min_length")){this.options.minchar=window.ajxpBootstrap.parameters.get("password_min_length")}Object.extend(this.options,c||{});var b={};var a='<div class="password-strength-info" style="float:left;width:'+this.options.labelWidth+'%;text-align:right;" id="'+this.field_name+'_text"></div>';a+='<div style="float:left;width:'+(100-this.options.labelWidth-(Prototype.Browser.IE?7:0))+'%;"><div class="password-strength-bar" id="'+this.field_name+'_bar" style="'+(Prototype.Browser.IE?"":"margin-top:5px;")+'height:0px; width: 0px;"></div></div>';b[this.options.barPosition]=a;this.options.barContainer.insert(b);this.bar=$(this.field_name+"_bar");this.feedback_text=$(this.field_name+"_text");this.item.observe("keyup",function(){this.checkUserPasswordStrength()}.bind(this));if(modal){this.observeOnce("strength_change",function(){modal.refreshDialogAppearance()})}},checkUserPasswordStrength:function(b){var a=this.options;var c=this.item.value;var b=this.field_name;strength=this.getPasswordScore(c,a);if(strength==-200){this.displayPasswordStrengthFeedback(0,0)}else{if(strength<0&&strength>-199){this.displayPasswordStrengthFeedback(1,10)}else{if(strength<=a.scores[0]){this.displayPasswordStrengthFeedback(2,10)}else{if(strength>a.scores[0]&&strength<=a.scores[1]){this.displayPasswordStrengthFeedback(3,25)}else{if(strength>a.scores[1]&&strength<=a.scores[2]){this.displayPasswordStrengthFeedback(4,55)}else{if(strength>a.scores[2]&&strength<=a.scores[3]){this.displayPasswordStrengthFeedback(5,80)}else{this.displayPasswordStrengthFeedback(6,98)}}}}}}this.notify("strength_change")},displayPasswordStrengthFeedback:function(b,a){this.feedback_text.innerHTML="<span style='color: "+this.options.colors[b]+";'>"+this.options.messages[b]+" &nbsp;&nbsp; </span>";this.bar.setStyle("height: "+(Prototype.Browser.IE?"5px":"8px;")+"; width:"+a+"%;background-color:"+this.options.colors[b])},getPasswordScore:function(c,a){var d=0;if(c.length<a.minchar){d=(d-100)}else{if(c.length>=a.minchar&&c.length<=(a.minchar+2)){d=(d+6)}else{if(c.length>=(a.minchar+3)&&c.length<=(a.minchar+4)){d=(d+12)}else{if(c.length>=(a.minchar+5)){d=(d+18)}}}}if(c.match(/[a-z]/)){d=(d+1)}if(c.match(/[A-Z]/)){d=(d+5)}if(c.match(/\d+/)){d=(d+5)}if(c.match(/(.*[0-9].*[0-9].*[0-9])/)){d=(d+7)}if(c.match(/.[!,@,#,$,%,^,&,*,?,_,~]/)){d=(d+5)}if(c.match(/(.*[!,@,#,$,%,^,&,*,?,_,~].*[!,@,#,$,%,^,&,*,?,_,~])/)){d=(d+7)}if(c.match(/([a-z].*[A-Z])|([A-Z].*[a-z])/)){d=(d+2)}if(c.match(/([a-zA-Z])/)&&c.match(/([0-9])/)){d=(d+3)}if(c.match(/([a-zA-Z0-9].*[!,@,#,$,%,^,&,*,?,_,~])|([!,@,#,$,%,^,&,*,?,_,~].*[a-zA-Z0-9])/)){d=(d+3)}for(var b=0;b<a.common.length;b++){if(c.toLowerCase()==a.common[b]){d=-200}}return d}});var detect=navigator.userAgent.toLowerCase();var OS,browser,version,total,thestring;var currentLightBox,currentDraggable;function getBrowserInfo(){if(checkIt("konqueror")){browser="Konqueror";OS="Linux"}else{if(checkIt("safari")){browser="Safari"}else{if(checkIt("omniweb")){browser="OmniWeb"}else{if(checkIt("opera")){browser="Opera"}else{if(checkIt("webtv")){browser="WebTV"}else{if(checkIt("icab")){browser="iCab"}else{if(checkIt("msie")){browser="Internet Explorer"}else{if(!checkIt("compatible")){browser="Netscape Navigator";version=detect.charAt(8)}else{browser="An unknown browser"}}}}}}}}if(!version){version=detect.charAt(place+thestring.length)}if(!OS){if(checkIt("linux")){OS="Linux"}else{if(checkIt("x11")){OS="Unix"}else{if(checkIt("mac")){OS="Mac"}else{if(checkIt("win")){OS="Windows"}else{OS="an unknown operating system"}}}}}}function checkIt(a){place=detect.indexOf(a)+1;thestring=a;return place}Event.observe(window,"load",initialize,false);Event.observe(window,"load",getBrowserInfo,false);Event.observe(window,"unload",Event.unloadCache,false);var lightbox=Class.create();lightbox.prototype={yPos:0,xPos:0,initialize:function(a){this.content=a},activate:function(){if(browser=="Internet Explorer"){this.getScroll();this.setScroll(0,0)}this.displayLightbox("block")},prepareIE:function(a,b){bod=document.getElementsByTagName("body")[0];bod.style.overflow=b;bod.style.height=a;htm=document.getElementsByTagName("html")[0];htm.style.overflow=b;htm.style.height=a},hideSelects:function(a){selects=document.getElementsByTagName("select");for(i=0;i<selects.length;i++){selects[i].style.visibility=a}},getScroll:function(){if(self.pageYOffset){this.yPos=self.pageYOffset}else{if(document.documentElement&&document.documentElement.scrollTop){this.yPos=document.documentElement.scrollTop}else{if(document.body){this.yPos=document.body.scrollTop}}}},setScroll:function(a,b){window.scrollTo(a,b)},displayLightbox:function(a){if(!$("overlay")){addLightboxMarkup()}if(a=="none"){$("overlay").fade({duration:0.5})}else{$("overlay").style.display=a}if(this.content!=null){$(this.content).style.display=a;currentDraggable=new Draggable(this.content,{handle:"dialogTitle",zindex:1050,starteffect:function(b){if(b.shadows){Shadower.deshadow(b);b.hadShadow=true}},endeffect:function(b){if(b.hadShadow){Shadower.shadow(b,{distance:4,angle:130,opacity:0.5,nestedShadows:3,color:"#000000",shadowStyle:{display:"block"}})}}})}},actions:function(){lbActions=document.getElementsByClassName("lbAction");for(i=0;i<lbActions.length;i++){Event.observe(lbActions[i],"click",this[lbActions[i].rel].bindAsEventListener(this),false);lbActions[i].onclick=function(){return false}}},deactivate:function(){if(browser=="Internet Explorer"){this.setScroll(0,this.yPos)}this.displayLightbox("none")}};function initialize(){addLightboxMarkup();Event.observe(document,"keydown",function(a){if(a==null){a=window.event}if(a.keyCode==27){ajaxplorer.cancelCopyOrMove();hideLightBox()}if(a.keyCode==9){return false}return true})}function displayLightBoxById(a){valid=new lightbox(a);valid.activate();currentLightBox=valid;if(a!="copymove_div"){}}function hideLightBox(b){if(modal.closeValidation){var a=modal.closeValidation();if(a===false){return}modal.closeValidation=null}if(currentLightBox){currentLightBox.deactivate();hideOverlay();if(!b){currentLightBox=null}ajaxplorer.enableNavigation();ajaxplorer.focusLast();ajaxplorer.enableShortcuts();document.fire("ajaxplorer:selection_changed")}if(currentDraggable){currentDraggable.destroy()}if(modal.closeFunction){modal.closeFunction();modal.closeFunction=null}Shadower.deshadow($(modal.elementName))}function setOverlay(){currentLightBox=new lightbox(null);currentLightBox.activate()}function hideOverlay(){if(currentLightBox){currentLightBox.deactivate();currentLightBox=null}}function addLightboxMarkup(){bod=document.getElementsByTagName("body")[0];overlay=document.createElement("div");overlay.id="overlay";bod.appendChild(overlay)}function addLightboxMarkupToElement(e,b){overlay=document.createElement("div");overlay.id="element_overlay";var h,d,m,a;if(Prototype.Browser.IE){var f=Position.positionedOffset($(e));h=f[1];d=0}else{var f=Position.cumulativeOffset($(e));h=f[1];d=f[0]}a=e.getWidth();m=e.getHeight();if(b){var l=h+parseInt(b.getHeight());var c=m+parseInt(b.getHeight());h=l+"px";m=c+"px"}var g={top:parseInt(e.getStyle("borderTopWidth")),bottom:parseInt(e.getStyle("borderBottomWidth")),right:parseInt(e.getStyle("borderRightWidth")),left:parseInt(e.getStyle("borderLeftWidth"))};h+=g.top;m-=g.top+g.bottom;d+=g.left;a-=g.left+g.right;$(overlay).setStyle({top:h,left:d,height:m,width:a});e.appendChild(overlay)}function removeLightboxFromElement(b){var a=$(b).select("#element_overlay");if(a.length){a[0].remove()}}var Builder={NODEMAP:{AREA:"map",CAPTION:"table",COL:"table",COLGROUP:"table",LEGEND:"fieldset",OPTGROUP:"select",OPTION:"select",PARAM:"object",TBODY:"table",TD:"table",TFOOT:"table",TH:"table",THEAD:"table",TR:"table"},node:function(a){a=a.toUpperCase();var g=this.NODEMAP[a]||"div";var b=document.createElement(g);try{b.innerHTML="<"+a+"></"+a+">"}catch(f){}var d=b.firstChild||null;if(d&&(d.tagName.toUpperCase()!=a)){d=d.getElementsByTagName(a)[0]}if(!d){d=document.createElement(a)}if(!d){return}if(arguments[1]){if(this._isStringOrNumber(arguments[1])||(arguments[1] instanceof Array)||arguments[1].tagName){this._children(d,arguments[1])}else{var c=this._attributes(arguments[1]);if(c.length){try{b.innerHTML="<"+a+" "+c+"></"+a+">"}catch(f){}d=b.firstChild||null;if(!d){d=document.createElement(a);for(attr in arguments[1]){d[attr=="class"?"className":attr]=arguments[1][attr]}}if(d.tagName.toUpperCase()!=a){d=b.getElementsByTagName(a)[0]}}}}if(arguments[2]){this._children(d,arguments[2])}return d},_text:function(a){return document.createTextNode(a)},ATTR_MAP:{className:"class",htmlFor:"for"},_attributes:function(a){var b=[];for(attribute in a){b.push((attribute in this.ATTR_MAP?this.ATTR_MAP[attribute]:attribute)+'="'+a[attribute].toString().escapeHTML().gsub(/"/,"&quot;")+'"')}return b.join(" ")},_children:function(b,a){if(a.tagName){b.appendChild(a);return}if(typeof a=="object"){a.flatten().each(function(c){if(typeof c=="object"){b.appendChild(c)}else{if(Builder._isStringOrNumber(c)){b.appendChild(Builder._text(c))}}})}else{if(Builder._isStringOrNumber(a)){b.appendChild(Builder._text(a))}}},_isStringOrNumber:function(a){return(typeof a=="string"||typeof a=="number")},build:function(b){var a=this.node("div");$(a).update(b.strip());return a.down()},dump:function(b){if(typeof b!="object"&&typeof b!="function"){b=window}var a=("A ABBR ACRONYM ADDRESS APPLET AREA B BASE BASEFONT BDO BIG BLOCKQUOTE BODY BR BUTTON CAPTION CENTER CITE CODE COL COLGROUP DD DEL DFN DIR DIV DL DT EM FIELDSET FONT FORM FRAME FRAMESET H1 H2 H3 H4 H5 H6 HEAD HR HTML I IFRAME IMG INPUT INS ISINDEX KBD LABEL LEGEND LI LINK MAP MENU META NOFRAMES NOSCRIPT OBJECT OL OPTGROUP OPTION P PARAM PRE Q S SAMP SCRIPT SELECT SMALL SPAN STRIKE STRONG STYLE SUB SUP TABLE TBODY TD TEXTAREA TFOOT TH THEAD TITLE TR TT U UL VAR").split(/\s+/);a.each(function(c){b[c]=function(){return Builder.node.apply(Builder,[c].concat($A(arguments)))}})}};String.prototype.parseColor=function(){var a="#";if(this.slice(0,4)=="rgb("){var c=this.slice(4,this.length-1).split(",");var b=0;do{a+=parseInt(c[b]).toColorPart()}while(++b<3)}else{if(this.slice(0,1)=="#"){if(this.length==4){for(var b=1;b<4;b++){a+=(this.charAt(b)+this.charAt(b)).toLowerCase()}}if(this.length==7){a=this.toLowerCase()}}}return(a.length==7?a:(arguments[0]||this))};Element.collectTextNodes=function(a){return $A($(a).childNodes).collect(function(b){return(b.nodeType==3?b.nodeValue:(b.hasChildNodes()?Element.collectTextNodes(b):""))}).flatten().join("")};Element.collectTextNodesIgnoreClass=function(a,b){return $A($(a).childNodes).collect(function(c){return(c.nodeType==3?c.nodeValue:((c.hasChildNodes()&&!Element.hasClassName(c,b))?Element.collectTextNodesIgnoreClass(c,b):""))}).flatten().join("")};Element.setContentZoom=function(a,b){a=$(a);a.setStyle({fontSize:(b/100)+"em"});if(Prototype.Browser.WebKit){window.scrollBy(0,0)}return a};Element.getInlineOpacity=function(a){return $(a).style.opacity||""};Element.forceRerendering=function(a){try{a=$(a);var c=document.createTextNode(" ");a.appendChild(c);a.removeChild(c)}catch(b){}};var Effect={_elementDoesNotExistError:{name:"ElementDoesNotExistError",message:"The specified DOM element does not exist, but is required for this effect to operate"},Transitions:{linear:Prototype.K,sinoidal:function(a){return(-Math.cos(a*Math.PI)/2)+0.5},reverse:function(a){return 1-a},flicker:function(a){var a=((-Math.cos(a*Math.PI)/4)+0.75)+Math.random()/4;return a>1?1:a},wobble:function(a){return(-Math.cos(a*Math.PI*(9*a))/2)+0.5},pulse:function(b,a){a=a||5;return(((b%(1/a))*a).round()==0?((b*a*2)-(b*a*2).floor()):1-((b*a*2)-(b*a*2).floor()))},spring:function(a){return 1-(Math.cos(a*4.5*Math.PI)*Math.exp(-a*6))},none:function(a){return 0},full:function(a){return 1}},DefaultOptions:{duration:1,fps:100,sync:false,from:0,to:1,delay:0,queue:"parallel"},tagifyText:function(a){var b="position:relative";if(Prototype.Browser.IE){b+=";zoom:1"}a=$(a);$A(a.childNodes).each(function(c){if(c.nodeType==3){c.nodeValue.toArray().each(function(d){a.insertBefore(new Element("span",{style:b}).update(d==" "?String.fromCharCode(160):d),c)});Element.remove(c)}})},multiple:function(b,c){var e;if(((typeof b=="object")||Object.isFunction(b))&&(b.length)){e=b}else{e=$(b).childNodes}var a=Object.extend({speed:0.1,delay:0},arguments[2]||{});var d=a.delay;$A(e).each(function(g,f){new c(g,Object.extend(a,{delay:f*a.speed+d}))})},PAIRS:{slide:["SlideDown","SlideUp"],blind:["BlindDown","BlindUp"],appear:["Appear","Fade"]},toggle:function(b,c){b=$(b);c=(c||"appear").toLowerCase();var a=Object.extend({queue:{position:"end",scope:(b.id||"global"),limit:1}},arguments[2]||{});Effect[b.visible()?Effect.PAIRS[c][1]:Effect.PAIRS[c][0]](b,a)}};Effect.DefaultOptions.transition=Effect.Transitions.sinoidal;Effect.ScopedQueue=Class.create(Enumerable,{initialize:function(){this.effects=[];this.interval=null},_each:function(a){this.effects._each(a)},add:function(b){var c=new Date().getTime();var a=Object.isString(b.options.queue)?b.options.queue:b.options.queue.position;switch(a){case"front":this.effects.findAll(function(d){return d.state=="idle"}).each(function(d){d.startOn+=b.finishOn;d.finishOn+=b.finishOn});break;case"with-last":c=this.effects.pluck("startOn").max()||c;break;case"end":c=this.effects.pluck("finishOn").max()||c;break}b.startOn+=c;b.finishOn+=c;if(!b.options.queue.limit||(this.effects.length<b.options.queue.limit)){this.effects.push(b)}if(!this.interval){this.interval=setInterval(this.loop.bind(this),15)}},remove:function(a){this.effects=this.effects.reject(function(b){return b==a});if(this.effects.length==0){clearInterval(this.interval);this.interval=null}},loop:function(){var c=new Date().getTime();for(var b=0,a=this.effects.length;b<a;b++){this.effects[b]&&this.effects[b].loop(c)}}});Effect.Queues={instances:$H(),get:function(a){if(!Object.isString(a)){return a}return this.instances.get(a)||this.instances.set(a,new Effect.ScopedQueue())}};Effect.Queue=Effect.Queues.get("global");Effect.Base=Class.create({position:null,start:function(options){function codeForEvent(options,eventName){return((options[eventName+"Internal"]?"this.options."+eventName+"Internal(this);":"")+(options[eventName]?"this.options."+eventName+"(this);":""))}if(options&&options.transition===false){options.transition=Effect.Transitions.linear}this.options=Object.extend(Object.extend({},Effect.DefaultOptions),options||{});this.currentFrame=0;this.state="idle";this.startOn=this.options.delay*1000;this.finishOn=this.startOn+(this.options.duration*1000);this.fromToDelta=this.options.to-this.options.from;this.totalTime=this.finishOn-this.startOn;this.totalFrames=this.options.fps*this.options.duration;eval('this.render = function(pos){ if (this.state=="idle"){this.state="running";'+codeForEvent(this.options,"beforeSetup")+(this.setup?"this.setup();":"")+codeForEvent(this.options,"afterSetup")+'};if (this.state=="running"){pos=this.options.transition(pos)*'+this.fromToDelta+"+"+this.options.from+";this.position=pos;"+codeForEvent(this.options,"beforeUpdate")+(this.update?"this.update(pos);":"")+codeForEvent(this.options,"afterUpdate")+"}}");this.event("beforeStart");if(!this.options.sync){Effect.Queues.get(Object.isString(this.options.queue)?"global":this.options.queue.scope).add(this)}},loop:function(c){if(c>=this.startOn){if(c>=this.finishOn){this.render(1);this.cancel();this.event("beforeFinish");if(this.finish){this.finish()}this.event("afterFinish");return}var b=(c-this.startOn)/this.totalTime,a=(b*this.totalFrames).round();if(a>this.currentFrame){this.render(b);this.currentFrame=a}}},cancel:function(){if(!this.options.sync){Effect.Queues.get(Object.isString(this.options.queue)?"global":this.options.queue.scope).remove(this)}this.state="finished"},event:function(a){if(this.options[a+"Internal"]){this.options[a+"Internal"](this)}if(this.options[a]){this.options[a](this)}},inspect:function(){var a=$H();for(property in this){if(!Object.isFunction(this[property])){a.set(property,this[property])}}return"#<Effect:"+a.inspect()+",options:"+$H(this.options).inspect()+">"}});Effect.Parallel=Class.create(Effect.Base,{initialize:function(a){this.effects=a||[];this.start(arguments[1])},update:function(a){this.effects.invoke("render",a)},finish:function(a){this.effects.each(function(b){b.render(1);b.cancel();b.event("beforeFinish");if(b.finish){b.finish(a)}b.event("afterFinish")})}});Effect.Tween=Class.create(Effect.Base,{initialize:function(c,f,e){c=Object.isString(c)?$(c):c;var b=$A(arguments),d=b.last(),a=b.length==5?b[3]:null;this.method=Object.isFunction(d)?d.bind(c):Object.isFunction(c[d])?c[d].bind(c):function(g){c[d]=g};this.start(Object.extend({from:f,to:e},a||{}))},update:function(a){this.method(a)}});Effect.Event=Class.create(Effect.Base,{initialize:function(){this.start(Object.extend({duration:0},arguments[0]||{}))},update:Prototype.emptyFunction});Effect.Opacity=Class.create(Effect.Base,{initialize:function(b){this.element=$(b);if(!this.element){throw (Effect._elementDoesNotExistError)}if(Prototype.Browser.IE&&(!this.element.currentStyle.hasLayout)){this.element.setStyle({zoom:1})}var a=Object.extend({from:this.element.getOpacity()||0,to:1},arguments[1]||{});this.start(a)},update:function(a){this.element.setOpacity(a)}});Effect.Move=Class.create(Effect.Base,{initialize:function(b){this.element=$(b);if(!this.element){throw (Effect._elementDoesNotExistError)}var a=Object.extend({x:0,y:0,mode:"relative"},arguments[1]||{});this.start(a)},setup:function(){this.element.makePositioned();this.originalLeft=parseFloat(this.element.getStyle("left")||"0");this.originalTop=parseFloat(this.element.getStyle("top")||"0");if(this.options.mode=="absolute"){this.options.x=this.options.x-this.originalLeft;this.options.y=this.options.y-this.originalTop}},update:function(a){this.element.setStyle({left:(this.options.x*a+this.originalLeft).round()+"px",top:(this.options.y*a+this.originalTop).round()+"px"})}});Effect.MoveBy=function(b,a,c){return new Effect.Move(b,Object.extend({x:c,y:a},arguments[3]||{}))};Effect.Scale=Class.create(Effect.Base,{initialize:function(b,c){this.element=$(b);if(!this.element){throw (Effect._elementDoesNotExistError)}var a=Object.extend({scaleX:true,scaleY:true,scaleContent:true,scaleFromCenter:false,scaleMode:"box",scaleFrom:100,scaleTo:c},arguments[2]||{});this.start(a)},setup:function(){this.restoreAfterFinish=this.options.restoreAfterFinish||false;this.elementPositioning=this.element.getStyle("position");this.originalStyle={};["top","left","width","height","fontSize"].each(function(b){this.originalStyle[b]=this.element.style[b]}.bind(this));this.originalTop=this.element.offsetTop;this.originalLeft=this.element.offsetLeft;var a=this.element.getStyle("font-size")||"100%";["em","px","%","pt"].each(function(b){if(a.indexOf(b)>0){this.fontSize=parseFloat(a);this.fontSizeType=b}}.bind(this));this.factor=(this.options.scaleTo-this.options.scaleFrom)/100;this.dims=null;if(this.options.scaleMode=="box"){this.dims=[this.element.offsetHeight,this.element.offsetWidth]}if(/^content/.test(this.options.scaleMode)){this.dims=[this.element.scrollHeight,this.element.scrollWidth]}if(!this.dims){this.dims=[this.options.scaleMode.originalHeight,this.options.scaleMode.originalWidth]}},update:function(a){var b=(this.options.scaleFrom/100)+(this.factor*a);if(this.options.scaleContent&&this.fontSize){this.element.setStyle({fontSize:this.fontSize*b+this.fontSizeType})}this.setDimensions(this.dims[0]*b,this.dims[1]*b)},finish:function(a){if(this.restoreAfterFinish){this.element.setStyle(this.originalStyle)}},setDimensions:function(a,e){var f={};if(this.options.scaleX){f.width=e.round()+"px"}if(this.options.scaleY){f.height=a.round()+"px"}if(this.options.scaleFromCenter){var c=(a-this.dims[0])/2;var b=(e-this.dims[1])/2;if(this.elementPositioning=="absolute"){if(this.options.scaleY){f.top=this.originalTop-c+"px"}if(this.options.scaleX){f.left=this.originalLeft-b+"px"}}else{if(this.options.scaleY){f.top=-c+"px"}if(this.options.scaleX){f.left=-b+"px"}}}this.element.setStyle(f)}});Effect.Highlight=Class.create(Effect.Base,{initialize:function(b){this.element=$(b);if(!this.element){throw (Effect._elementDoesNotExistError)}var a=Object.extend({startcolor:"#ffff99"},arguments[1]||{});this.start(a)},setup:function(){if(this.element.getStyle("display")=="none"){this.cancel();return}this.oldStyle={};if(!this.options.keepBackgroundImage){this.oldStyle.backgroundImage=this.element.getStyle("background-image");this.element.setStyle({backgroundImage:"none"})}if(!this.options.endcolor){this.options.endcolor=this.element.getStyle("background-color").parseColor("#ffffff")}if(!this.options.restorecolor){this.options.restorecolor=this.element.getStyle("background-color")}this._base=$R(0,2).map(function(a){return parseInt(this.options.startcolor.slice(a*2+1,a*2+3),16)}.bind(this));this._delta=$R(0,2).map(function(a){return parseInt(this.options.endcolor.slice(a*2+1,a*2+3),16)-this._base[a]}.bind(this))},update:function(a){this.element.setStyle({backgroundColor:$R(0,2).inject("#",function(b,c,d){return b+((this._base[d]+(this._delta[d]*a)).round().toColorPart())}.bind(this))})},finish:function(){this.element.setStyle(Object.extend(this.oldStyle,{backgroundColor:this.options.restorecolor}))}});Effect.ScrollTo=function(d){var c=arguments[1]||{},b=document.viewport.getScrollOffsets(),e=$(d).cumulativeOffset(),a=(window.height||document.body.scrollHeight)-document.viewport.getHeight();if(c.offset){e[1]+=c.offset}return new Effect.Tween(null,b.top,e[1]>a?a:e[1],c,function(f){scrollTo(b.left,f.round())})};Effect.Fade=function(c){c=$(c);var a=c.getInlineOpacity();var b=Object.extend({from:c.getOpacity()||1,to:0,afterFinishInternal:function(d){if(d.options.to!=0){return}d.element.hide().setStyle({opacity:a})}},arguments[1]||{});return new Effect.Opacity(c,b)};Effect.Appear=function(b){b=$(b);var a=Object.extend({from:(b.getStyle("display")=="none"?0:b.getOpacity()||0),to:1,afterFinishInternal:function(c){c.element.forceRerendering()},beforeSetup:function(c){c.element.setOpacity(c.options.from).show()}},arguments[1]||{});return new Effect.Opacity(b,a)};Effect.Puff=function(b){b=$(b);var a={opacity:b.getInlineOpacity(),position:b.getStyle("position"),top:b.style.top,left:b.style.left,width:b.style.width,height:b.style.height};return new Effect.Parallel([new Effect.Scale(b,200,{sync:true,scaleFromCenter:true,scaleContent:true,restoreAfterFinish:true}),new Effect.Opacity(b,{sync:true,to:0})],Object.extend({duration:1,beforeSetupInternal:function(c){Position.absolutize(c.effects[0].element)},afterFinishInternal:function(c){c.effects[0].element.hide().setStyle(a)}},arguments[1]||{}))};Effect.BlindUp=function(a){a=$(a);a.makeClipping();return new Effect.Scale(a,0,Object.extend({scaleContent:false,scaleX:false,restoreAfterFinish:true,afterFinishInternal:function(b){b.element.hide().undoClipping()}},arguments[1]||{}))};Effect.BlindDown=function(b){b=$(b);var a=b.getDimensions();return new Effect.Scale(b,100,Object.extend({scaleContent:false,scaleX:false,scaleFrom:0,scaleMode:{originalHeight:a.height,originalWidth:a.width},restoreAfterFinish:true,afterSetup:function(c){c.element.makeClipping().setStyle({height:"0px"}).show()},afterFinishInternal:function(c){c.element.undoClipping()}},arguments[1]||{}))};Effect.SwitchOff=function(b){b=$(b);var a=b.getInlineOpacity();return new Effect.Appear(b,Object.extend({duration:0.4,from:0,transition:Effect.Transitions.flicker,afterFinishInternal:function(c){new Effect.Scale(c.element,1,{duration:0.3,scaleFromCenter:true,scaleX:false,scaleContent:false,restoreAfterFinish:true,beforeSetup:function(d){d.element.makePositioned().makeClipping()},afterFinishInternal:function(d){d.element.hide().undoClipping().undoPositioned().setStyle({opacity:a})}})}},arguments[1]||{}))};Effect.DropOut=function(b){b=$(b);var a={top:b.getStyle("top"),left:b.getStyle("left"),opacity:b.getInlineOpacity()};return new Effect.Parallel([new Effect.Move(b,{x:0,y:100,sync:true}),new Effect.Opacity(b,{sync:true,to:0})],Object.extend({duration:0.5,beforeSetup:function(c){c.effects[0].element.makePositioned()},afterFinishInternal:function(c){c.effects[0].element.hide().undoPositioned().setStyle(a)}},arguments[1]||{}))};Effect.Shake=function(d){d=$(d);var b=Object.extend({distance:20,duration:0.5},arguments[1]||{});var e=parseFloat(b.distance);var c=parseFloat(b.duration)/10;var a={top:d.getStyle("top"),left:d.getStyle("left")};return new Effect.Move(d,{x:e,y:0,duration:c,afterFinishInternal:function(f){new Effect.Move(f.element,{x:-e*2,y:0,duration:c*2,afterFinishInternal:function(g){new Effect.Move(g.element,{x:e*2,y:0,duration:c*2,afterFinishInternal:function(h){new Effect.Move(h.element,{x:-e*2,y:0,duration:c*2,afterFinishInternal:function(l){new Effect.Move(l.element,{x:e*2,y:0,duration:c*2,afterFinishInternal:function(m){new Effect.Move(m.element,{x:-e,y:0,duration:c,afterFinishInternal:function(n){n.element.undoPositioned().setStyle(a)}})}})}})}})}})}})};Effect.SlideDown=function(c){c=$(c).cleanWhitespace();var a=c.down().getStyle("bottom");var b=c.getDimensions();return new Effect.Scale(c,100,Object.extend({scaleContent:false,scaleX:false,scaleFrom:window.opera?0:1,scaleMode:{originalHeight:b.height,originalWidth:b.width},restoreAfterFinish:true,afterSetup:function(d){d.element.makePositioned();d.element.down().makePositioned();if(window.opera){d.element.setStyle({top:""})}d.element.makeClipping().setStyle({height:"0px"}).show()},afterUpdateInternal:function(d){d.element.down().setStyle({bottom:(d.dims[0]-d.element.clientHeight)+"px"})},afterFinishInternal:function(d){d.element.undoClipping().undoPositioned();d.element.down().undoPositioned().setStyle({bottom:a})}},arguments[1]||{}))};Effect.SlideUp=function(c){c=$(c).cleanWhitespace();var a=c.down().getStyle("bottom");var b=c.getDimensions();return new Effect.Scale(c,window.opera?0:1,Object.extend({scaleContent:false,scaleX:false,scaleMode:"box",scaleFrom:100,scaleMode:{originalHeight:b.height,originalWidth:b.width},restoreAfterFinish:true,afterSetup:function(d){d.element.makePositioned();d.element.down().makePositioned();if(window.opera){d.element.setStyle({top:""})}d.element.makeClipping().show()},afterUpdateInternal:function(d){d.element.down().setStyle({bottom:(d.dims[0]-d.element.clientHeight)+"px"})},afterFinishInternal:function(d){d.element.hide().undoClipping().undoPositioned();d.element.down().undoPositioned().setStyle({bottom:a})}},arguments[1]||{}))};Effect.Squish=function(a){return new Effect.Scale(a,window.opera?1:0,{restoreAfterFinish:true,beforeSetup:function(b){b.element.makeClipping()},afterFinishInternal:function(b){b.element.hide().undoClipping()}})};Effect.Grow=function(c){c=$(c);var b=Object.extend({direction:"center",moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.full},arguments[1]||{});var a={top:c.style.top,left:c.style.left,height:c.style.height,width:c.style.width,opacity:c.getInlineOpacity()};var g=c.getDimensions();var h,f;var e,d;switch(b.direction){case"top-left":h=f=e=d=0;break;case"top-right":h=g.width;f=d=0;e=-g.width;break;case"bottom-left":h=e=0;f=g.height;d=-g.height;break;case"bottom-right":h=g.width;f=g.height;e=-g.width;d=-g.height;break;case"center":h=g.width/2;f=g.height/2;e=-g.width/2;d=-g.height/2;break}return new Effect.Move(c,{x:h,y:f,duration:0.01,beforeSetup:function(l){l.element.hide().makeClipping().makePositioned()},afterFinishInternal:function(l){new Effect.Parallel([new Effect.Opacity(l.element,{sync:true,to:1,from:0,transition:b.opacityTransition}),new Effect.Move(l.element,{x:e,y:d,sync:true,transition:b.moveTransition}),new Effect.Scale(l.element,100,{scaleMode:{originalHeight:g.height,originalWidth:g.width},sync:true,scaleFrom:window.opera?1:0,transition:b.scaleTransition,restoreAfterFinish:true})],Object.extend({beforeSetup:function(m){m.effects[0].element.setStyle({height:"0px"}).show()},afterFinishInternal:function(m){m.effects[0].element.undoClipping().undoPositioned().setStyle(a)}},b))}})};Effect.Shrink=function(c){c=$(c);var b=Object.extend({direction:"center",moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.none},arguments[1]||{});var a={top:c.style.top,left:c.style.left,height:c.style.height,width:c.style.width,opacity:c.getInlineOpacity()};var f=c.getDimensions();var e,d;switch(b.direction){case"top-left":e=d=0;break;case"top-right":e=f.width;d=0;break;case"bottom-left":e=0;d=f.height;break;case"bottom-right":e=f.width;d=f.height;break;case"center":e=f.width/2;d=f.height/2;break}return new Effect.Parallel([new Effect.Opacity(c,{sync:true,to:0,from:1,transition:b.opacityTransition}),new Effect.Scale(c,window.opera?1:0,{sync:true,transition:b.scaleTransition,restoreAfterFinish:true}),new Effect.Move(c,{x:e,y:d,sync:true,transition:b.moveTransition})],Object.extend({beforeStartInternal:function(g){g.effects[0].element.makePositioned().makeClipping()},afterFinishInternal:function(g){g.effects[0].element.hide().undoClipping().undoPositioned().setStyle(a)}},b))};Effect.Pulsate=function(c){c=$(c);var b=arguments[1]||{};var a=c.getInlineOpacity();var e=b.transition||Effect.Transitions.sinoidal;var d=function(f){return e(1-Effect.Transitions.pulse(f,b.pulses))};d.bind(e);return new Effect.Opacity(c,Object.extend(Object.extend({duration:2,from:0,afterFinishInternal:function(f){f.element.setStyle({opacity:a})}},b),{transition:d}))};Effect.Fold=function(b){b=$(b);var a={top:b.style.top,left:b.style.left,width:b.style.width,height:b.style.height};b.makeClipping();return new Effect.Scale(b,5,Object.extend({scaleContent:false,scaleX:false,afterFinishInternal:function(c){new Effect.Scale(b,1,{scaleContent:false,scaleY:false,afterFinishInternal:function(d){d.element.hide().undoClipping().setStyle(a)}})}},arguments[1]||{}))};Effect.Morph=Class.create(Effect.Base,{initialize:function(c){this.element=$(c);if(!this.element){throw (Effect._elementDoesNotExistError)}var a=Object.extend({style:{}},arguments[1]||{});if(!Object.isString(a.style)){this.style=$H(a.style)}else{if(a.style.include(":")){this.style=a.style.parseStyle()}else{this.element.addClassName(a.style);this.style=$H(this.element.getStyles());this.element.removeClassName(a.style);var b=this.element.getStyles();this.style=this.style.reject(function(d){return d.value==b[d.key]});a.afterFinishInternal=function(d){d.element.addClassName(d.options.style);d.transforms.each(function(e){d.element.style[e.style]=""})}}}this.start(a)},setup:function(){function a(b){if(!b||["rgba(0, 0, 0, 0)","transparent"].include(b)){b="#ffffff"}b=b.parseColor();return $R(0,2).map(function(c){return parseInt(b.slice(c*2+1,c*2+3),16)})}this.transforms=this.style.map(function(g){var f=g[0],e=g[1],d=null;if(e.parseColor("#zzzzzz")!="#zzzzzz"){e=e.parseColor();d="color"}else{if(f=="opacity"){e=parseFloat(e);if(Prototype.Browser.IE&&(!this.element.currentStyle.hasLayout)){this.element.setStyle({zoom:1})}}else{if(Element.CSS_LENGTH.test(e)){var c=e.match(/^([\+\-]?[0-9\.]+)(.*)$/);e=parseFloat(c[1]);d=(c.length==3)?c[2]:null}}}var b=this.element.getStyle(f);return{style:f.camelize(),originalValue:d=="color"?a(b):parseFloat(b||0),targetValue:d=="color"?a(e):e,unit:d}}.bind(this)).reject(function(b){return((b.originalValue==b.targetValue)||(b.unit!="color"&&(isNaN(b.originalValue)||isNaN(b.targetValue))))})},update:function(a){var d={},b,c=this.transforms.length;while(c--){d[(b=this.transforms[c]).style]=b.unit=="color"?"#"+(Math.round(b.originalValue[0]+(b.targetValue[0]-b.originalValue[0])*a)).toColorPart()+(Math.round(b.originalValue[1]+(b.targetValue[1]-b.originalValue[1])*a)).toColorPart()+(Math.round(b.originalValue[2]+(b.targetValue[2]-b.originalValue[2])*a)).toColorPart():(b.originalValue+(b.targetValue-b.originalValue)*a).toFixed(3)+(b.unit===null?"":b.unit)}this.element.setStyle(d,true)}});Effect.Transform=Class.create({initialize:function(a){this.tracks=[];this.options=arguments[1]||{};this.addTracks(a)},addTracks:function(a){a.each(function(b){b=$H(b);var c=b.values().first();this.tracks.push($H({ids:b.keys().first(),effect:Effect.Morph,options:{style:c}}))}.bind(this));return this},play:function(){return new Effect.Parallel(this.tracks.map(function(a){var d=a.get("ids"),c=a.get("effect"),b=a.get("options");var e=[$(d)||$$(d)].flatten();return e.map(function(f){return new c(f,Object.extend({sync:true},b))})}).flatten(),this.options)}});Element.CSS_PROPERTIES=$w("backgroundColor backgroundPosition borderBottomColor borderBottomStyle borderBottomWidth borderLeftColor borderLeftStyle borderLeftWidth borderRightColor borderRightStyle borderRightWidth borderSpacing borderTopColor borderTopStyle borderTopWidth bottom clip color fontSize fontWeight height left letterSpacing lineHeight marginBottom marginLeft marginRight marginTop markerOffset maxHeight maxWidth minHeight minWidth opacity outlineColor outlineOffset outlineWidth paddingBottom paddingLeft paddingRight paddingTop right textIndent top width wordSpacing zIndex");Element.CSS_LENGTH=/^(([\+\-]?[0-9\.]+)(em|ex|px|in|cm|mm|pt|pc|\%))|0$/;String.__parseStyleElement=document.createElement("div");String.prototype.parseStyle=function(){var b,a=$H();if(Prototype.Browser.WebKit){b=new Element("div",{style:this}).style}else{String.__parseStyleElement.innerHTML='<div style="'+this+'"></div>';b=String.__parseStyleElement.childNodes[0].style}Element.CSS_PROPERTIES.each(function(c){if(b[c]){a.set(c,b[c])}});if(Prototype.Browser.IE&&this.include("opacity")){a.set("opacity",this.match(/opacity:\s*((?:0|1)?(?:\.\d*)?)/)[1])}return a};if(document.defaultView&&document.defaultView.getComputedStyle){Element.getStyles=function(b){var a=document.defaultView.getComputedStyle($(b),null);return Element.CSS_PROPERTIES.inject({},function(c,d){c[d]=a[d];return c})}}else{Element.getStyles=function(b){b=$(b);var a=b.currentStyle,c;c=Element.CSS_PROPERTIES.inject({},function(e,d){e.set(d,a[d]);return e});if(!c.opacity){c.set("opacity",b.getOpacity())}return c}}Effect.Methods={morph:function(a,b){a=$(a);new Effect.Morph(a,Object.extend({style:b},arguments[2]||{}));return a},visualEffect:function(c,e,b){c=$(c);var d=e.dasherize().camelize(),a=d.charAt(0).toUpperCase()+d.substring(1);new Effect[a](c,b);return c},highlight:function(b,a){b=$(b);new Effect.Highlight(b,a);return b}};$w("fade appear grow shrink fold blindUp blindDown slideUp slideDown pulsate shake puff squish switchOff dropOut").each(function(a){Effect.Methods[a]=function(c,b){c=$(c);Effect[a.charAt(0).toUpperCase()+a.substring(1)](c,b);return c}});$w("getInlineOpacity forceRerendering setContentZoom collectTextNodes collectTextNodesIgnoreClass getStyles").each(function(a){Effect.Methods[a]=Element[a]});Element.addMethods(Effect.Methods);if(Object.isUndefined(Effect)){throw ("dragdrop.js requires including script.aculo.us' effects.js library")}var Droppables={drops:[],remove:function(a){this.drops=this.drops.reject(function(b){return b.element==$(a)})},add:function(b){b=$(b);var a=Object.extend({greedy:true,hoverclass:null,tree:false},arguments[1]||{});if(a.containment){a._containers=[];var c=a.containment;if(Object.isArray(c)){c.each(function(d){a._containers.push($(d))})}else{a._containers.push($(c))}}if(a.accept){a.accept=[a.accept].flatten()}Element.makePositioned(b);a.element=b;this.drops.push(a)},findDeepestChild:function(a){deepest=a[0];for(i=1;i<a.length;++i){if(Element.isParent(a[i].element,deepest.element)){deepest=a[i]}}return deepest},isContained:function(b,a){var c;if(a.tree){c=b.treeNode}else{c=b.parentNode}return a._containers.detect(function(d){return c==d})},isAffected:function(a,c,b){return(b.element&&(b.element!=c)&&((!b._containers)||this.isContained(c,b))&&((!b.accept)||(Element.classNames(c).detect(function(d){return b.accept.include(d)})))&&Position.within(b.element,a[0],a[1]))},deactivate:function(a){if(a.hoverclass){Element.removeClassName(a.element,a.hoverclass)}if(a.onOut){a.onOut(a.element)}this.last_active=null},activate:function(a){if(a.hoverclass){Element.addClassName(a.element,a.hoverclass)}this.last_active=a},show:function(a,c){if(!this.drops.length){return}var b,d=[];$A(this.drops).each(function(e){if(Droppables.isAffected(a,c,e)){d.push(e)}});if(d.length>0){b=Droppables.findDeepestChild(d)}if(this.last_active&&this.last_active!=b){this.deactivate(this.last_active)}if(b){Position.within(b.element,a[0],a[1]);if(b.onHover){b.onHover(c,b.element,Position.overlap(b.overlap,b.element))}if(b!=this.last_active){Droppables.activate(b)}}},fire:function(b,a){if(!this.last_active){return}Position.prepare();Position.includeScrollOffsets=true;if(this.isAffected([Event.pointerX(b),Event.pointerY(b)],a,this.last_active)){if(this.last_active.onDrop){this.last_active.onDrop(a,this.last_active.element,b);return true}}},reset:function(){if(this.last_active){this.deactivate(this.last_active)}}};var Draggables={drags:[],observers:[],register:function(a){if(this.drags.length==0){this.eventMouseUp=this.endDrag.bindAsEventListener(this);this.eventMouseMove=this.updateDrag.bindAsEventListener(this);this.eventKeypress=this.keyPress.bindAsEventListener(this);Event.observe(document,"mouseup",this.eventMouseUp);Event.observe(document,"mousemove",this.eventMouseMove);Event.observe(document,"keypress",this.eventKeypress)}this.drags.push(a)},unregister:function(a){this.drags=this.drags.reject(function(b){return b==a});if(this.drags.length==0){Event.stopObserving(document,"mouseup",this.eventMouseUp);Event.stopObserving(document,"mousemove",this.eventMouseMove);Event.stopObserving(document,"keypress",this.eventKeypress)}},activate:function(a){if(a.options.delay){this._timeout=setTimeout(function(){Draggables._timeout=null;window.focus();Draggables.activeDraggable=a}.bind(this),a.options.delay)}else{window.focus();this.activeDraggable=a}},deactivate:function(){this.activeDraggable=null},updateDrag:function(a){if(!this.activeDraggable){return}var b=[Event.pointerX(a),Event.pointerY(a)];if(this._lastPointer&&(this._lastPointer.inspect()==b.inspect())){return}this._lastPointer=b;this.activeDraggable.updateDrag(a,b)},endDrag:function(a){if(this._timeout){clearTimeout(this._timeout);this._timeout=null}if(!this.activeDraggable){return}this._lastPointer=null;this.activeDraggable.endDrag(a);this.activeDraggable=null},keyPress:function(a){if(this.activeDraggable){this.activeDraggable.keyPress(a)}},addObserver:function(a){this.observers.push(a);this._cacheObserverCallbacks()},removeObserver:function(a){this.observers=this.observers.reject(function(b){return b.element==a});this._cacheObserverCallbacks()},notify:function(b,a,c){if(this[b+"Count"]>0){this.observers.each(function(d){if(d[b]){d[b](b,a,c)}})}if(a.options[b]){a.options[b](a,c)}},_cacheObserverCallbacks:function(){["onStart","onEnd","onDrag"].each(function(a){Draggables[a+"Count"]=Draggables.observers.select(function(b){return b[a]}).length})}};var Draggable=Class.create({initialize:function(b){var c={handle:false,reverteffect:function(f,e,d){var g=Math.sqrt(Math.abs(e^2)+Math.abs(d^2))*0.02;new Effect.Move(f,{x:-d,y:-e,duration:g,queue:{scope:"_draggable",position:"end"}})},endeffect:function(e){var d=Object.isNumber(e._opacity)?e._opacity:1;new Effect.Opacity(e,{duration:0.2,from:0.7,to:d,queue:{scope:"_draggable",position:"end"},afterFinish:function(){Draggable._dragging[e]=false}})},zindex:1000,revert:false,quiet:false,scroll:false,scrollSensitivity:20,scrollSpeed:15,snap:false,delay:0};if(!arguments[1]||Object.isUndefined(arguments[1].endeffect)){Object.extend(c,{starteffect:function(d){d._opacity=Element.getOpacity(d);Draggable._dragging[d]=true;new Effect.Opacity(d,{duration:0.2,from:d._opacity,to:0.7})}})}var a=Object.extend(c,arguments[1]||{});this.element=$(b);if(a.handle&&Object.isString(a.handle)){this.handle=this.element.down("."+a.handle,0)}if(!this.handle){this.handle=$(a.handle)}if(!this.handle){this.handle=this.element}if(a.scroll&&!a.scroll.scrollTo&&!a.scroll.outerHTML){a.scroll=$(a.scroll);this._isScrollChild=Element.childOf(this.element,a.scroll)}Element.makePositioned(this.element);this.options=a;this.dragging=false;this.eventMouseDown=this.initDrag.bindAsEventListener(this);Event.observe(this.handle,"mousedown",this.eventMouseDown);Draggables.register(this)},destroy:function(){Event.stopObserving(this.handle,"mousedown",this.eventMouseDown);Draggables.unregister(this)},currentDelta:function(){return([parseInt(Element.getStyle(this.element,"left")||"0"),parseInt(Element.getStyle(this.element,"top")||"0")])},initDrag:function(a){if(!Object.isUndefined(Draggable._dragging[this.element])&&Draggable._dragging[this.element]){return}if(Event.isLeftClick(a)){var c=Event.element(a);if((tag_name=c.tagName.toUpperCase())&&(tag_name=="INPUT"||tag_name=="SELECT"||tag_name=="OPTION"||tag_name=="BUTTON"||tag_name=="TEXTAREA")){return}var b=[Event.pointerX(a),Event.pointerY(a)];var d=Position.cumulativeOffset(this.element);this.offset=[0,1].map(function(e){return(b[e]-d[e])});Draggables.activate(this);Event.stop(a)}},startDrag:function(b){this.dragging=true;if(!this.delta){this.delta=this.currentDelta()}if(this.options.zindex){this.originalZ=parseInt(Element.getStyle(this.element,"z-index")||0);this.element.style.zIndex=this.options.zindex}if(this.options.ghosting){this._clone=this.element.cloneNode(true);this.element._originallyAbsolute=(this.element.getStyle("position")=="absolute");if(!this.element._originallyAbsolute){Position.absolutize(this.element)}this.element.parentNode.insertBefore(this._clone,this.element)}if(this.options.scroll){if(this.options.scroll==window){var a=this._getWindowScroll(this.options.scroll);this.originalScrollLeft=a.left;this.originalScrollTop=a.top}else{this.originalScrollLeft=this.options.scroll.scrollLeft;this.originalScrollTop=this.options.scroll.scrollTop}}Draggables.notify("onStart",this,b);if(this.options.starteffect){this.options.starteffect(this.element)}},updateDrag:function(event,pointer){if(!this.dragging){this.startDrag(event)}if(!this.options.quiet){Position.prepare();Position.includeScrollOffsets=true;Droppables.show(pointer,this.element)}Draggables.notify("onDrag",this,event);this.draw(pointer);if(this.options.change){this.options.change(this)}if(this.options.scroll){this.stopScrolling();var p;if(this.options.scroll==window){with(this._getWindowScroll(this.options.scroll)){p=[left,top,left+width,top+height]}}else{p=Position.page(this.options.scroll);p[0]+=this.options.scroll.scrollLeft+Position.deltaX;p[1]+=this.options.scroll.scrollTop+Position.deltaY;p.push(p[0]+this.options.scroll.offsetWidth);p.push(p[1]+this.options.scroll.offsetHeight)}var speed=[0,0];if(pointer[0]<(p[0]+this.options.scrollSensitivity)){speed[0]=pointer[0]-(p[0]+this.options.scrollSensitivity)}if(pointer[1]<(p[1]+this.options.scrollSensitivity)){speed[1]=pointer[1]-(p[1]+this.options.scrollSensitivity)}if(pointer[0]>(p[2]-this.options.scrollSensitivity)){speed[0]=pointer[0]-(p[2]-this.options.scrollSensitivity)}if(pointer[1]>(p[3]-this.options.scrollSensitivity)){speed[1]=pointer[1]-(p[3]-this.options.scrollSensitivity)}this.startScrolling(speed)}if(Prototype.Browser.WebKit){window.scrollBy(0,0)}Event.stop(event)},finishDrag:function(b,f){this.dragging=false;if(this.options.quiet){Position.prepare();Position.includeScrollOffsets=true;var e=[Event.pointerX(b),Event.pointerY(b)];Droppables.show(e,this.element)}if(this.options.ghosting){if(!this.element._originallyAbsolute){Position.relativize(this.element)}delete this.element._originallyAbsolute;Element.remove(this._clone);this._clone=null}var g=false;if(f){g=Droppables.fire(b,this.element);if(!g){g=false}}if(g&&this.options.onDropped){this.options.onDropped(this.element)}Draggables.notify("onEnd",this,b);var a=this.options.revert;if(a&&Object.isFunction(a)){a=a(this.element)}var c=this.currentDelta();if(a&&this.options.reverteffect){if(g==0||a!="failure"){this.options.reverteffect(this.element,c[1]-this.delta[1],c[0]-this.delta[0])}}else{this.delta=c}if(this.options.zindex){this.element.style.zIndex=this.originalZ}if(this.options.endeffect){this.options.endeffect(this.element)}Draggables.deactivate(this);Droppables.reset()},keyPress:function(a){if(a.keyCode!=Event.KEY_ESC){return}this.finishDrag(a,false);Event.stop(a)},endDrag:function(a){if(!this.dragging){return}this.stopScrolling();this.finishDrag(a,true);Event.stop(a)},draw:function(a){var g=Position.cumulativeOffset(this.element);if(this.options.ghosting){var c=Position.realOffset(this.element);g[0]+=c[0]-Position.deltaX;g[1]+=c[1]-Position.deltaY}var f=this.currentDelta();g[0]-=f[0];g[1]-=f[1];if(this.options.scroll&&(this.options.scroll!=window&&this._isScrollChild)){g[0]-=this.options.scroll.scrollLeft-this.originalScrollLeft;g[1]-=this.options.scroll.scrollTop-this.originalScrollTop}var e=[0,1].map(function(d){return(a[d]-g[d]-this.offset[d])}.bind(this));if(this.options.snap){if(Object.isFunction(this.options.snap)){e=this.options.snap(e[0],e[1],this)}else{if(Object.isArray(this.options.snap)){e=e.map(function(d,h){return(d/this.options.snap[h]).round()*this.options.snap[h]}.bind(this))}else{e=e.map(function(d){return(d/this.options.snap).round()*this.options.snap}.bind(this))}}}var b=this.element.style;if((!this.options.constraint)||(this.options.constraint=="horizontal")){b.left=e[0]+"px"}if((!this.options.constraint)||(this.options.constraint=="vertical")){b.top=e[1]+"px"}if(b.visibility=="hidden"){b.visibility=""}},stopScrolling:function(){if(this.scrollInterval){clearInterval(this.scrollInterval);this.scrollInterval=null;Draggables._lastScrollPointer=null}},startScrolling:function(a){if(!(a[0]||a[1])){return}this.scrollSpeed=[a[0]*this.options.scrollSpeed,a[1]*this.options.scrollSpeed];this.lastScrolled=new Date();this.scrollInterval=setInterval(this.scroll.bind(this),10)},scroll:function(){var current=new Date();var delta=current-this.lastScrolled;this.lastScrolled=current;if(this.options.scroll==window){with(this._getWindowScroll(this.options.scroll)){if(this.scrollSpeed[0]||this.scrollSpeed[1]){var d=delta/1000;this.options.scroll.scrollTo(left+d*this.scrollSpeed[0],top+d*this.scrollSpeed[1])}}}else{this.options.scroll.scrollLeft+=this.scrollSpeed[0]*delta/1000;this.options.scroll.scrollTop+=this.scrollSpeed[1]*delta/1000}Position.prepare();Position.includeScrollOffsets=true;Droppables.show(Draggables._lastPointer,this.element);Draggables.notify("onDrag",this);if(this._isScrollChild){Draggables._lastScrollPointer=Draggables._lastScrollPointer||$A(Draggables._lastPointer);Draggables._lastScrollPointer[0]+=this.scrollSpeed[0]*delta/1000;Draggables._lastScrollPointer[1]+=this.scrollSpeed[1]*delta/1000;if(Draggables._lastScrollPointer[0]<0){Draggables._lastScrollPointer[0]=0}if(Draggables._lastScrollPointer[1]<0){Draggables._lastScrollPointer[1]=0}this.draw(Draggables._lastScrollPointer)}if(this.options.change){this.options.change(this)}},_getWindowScroll:function(w){var T,L,W,H;with(w.document){if(w.document.documentElement&&documentElement.scrollTop){T=documentElement.scrollTop;L=documentElement.scrollLeft}else{if(w.document.body){T=body.scrollTop;L=body.scrollLeft}}if(w.innerWidth){W=w.innerWidth;H=w.innerHeight}else{if(w.document.documentElement&&documentElement.clientWidth){W=documentElement.clientWidth;H=documentElement.clientHeight}else{W=body.offsetWidth;H=body.offsetHeight}}}return{top:T,left:L,width:W,height:H}}});Draggable._dragging={};var SortableObserver=Class.create({initialize:function(b,a){this.element=$(b);this.observer=a;this.lastValue=Sortable.serialize(this.element)},onStart:function(){this.lastValue=Sortable.serialize(this.element)},onEnd:function(){Sortable.unmark();if(this.lastValue!=Sortable.serialize(this.element)){this.observer(this.element)}}});var Sortable={SERIALIZE_RULE:/^[^_\-](?:[A-Za-z0-9\-\_]*)[_](.*)$/,sortables:{},_findRootElement:function(a){while(a.tagName.toUpperCase()!="BODY"){if(a.id&&Sortable.sortables[a.id]){return a}a=a.parentNode}},options:function(a){a=Sortable._findRootElement($(a));if(!a){return}return Sortable.sortables[a.id]},destroy:function(a){var b=Sortable.options(a);if(b){Draggables.removeObserver(b.element);b.droppables.each(function(c){Droppables.remove(c)});b.draggables.invoke("destroy");delete Sortable.sortables[b.element.id]}},create:function(c){c=$(c);var b=Object.extend({element:c,tag:"li",dropOnEmpty:false,tree:false,treeTag:"ul",overlap:"vertical",constraint:"vertical",containment:c,handle:false,only:false,delay:0,hoverclass:null,ghosting:false,quiet:false,scroll:false,scrollSensitivity:20,scrollSpeed:15,format:this.SERIALIZE_RULE,elements:false,handles:false,onChange:Prototype.emptyFunction,onUpdate:Prototype.emptyFunction},arguments[1]||{});this.destroy(c);var a={revert:true,quiet:b.quiet,scroll:b.scroll,scrollSpeed:b.scrollSpeed,scrollSensitivity:b.scrollSensitivity,delay:b.delay,ghosting:b.ghosting,constraint:b.constraint,handle:b.handle};if(b.starteffect){a.starteffect=b.starteffect}if(b.reverteffect){a.reverteffect=b.reverteffect}else{if(b.ghosting){a.reverteffect=function(f){f.style.top=0;f.style.left=0}}}if(b.endeffect){a.endeffect=b.endeffect}if(b.zindex){a.zindex=b.zindex}var d={overlap:b.overlap,containment:b.containment,tree:b.tree,hoverclass:b.hoverclass,onHover:Sortable.onHover};var e={onHover:Sortable.onEmptyHover,overlap:b.overlap,containment:b.containment,hoverclass:b.hoverclass};Element.cleanWhitespace(c);b.draggables=[];b.droppables=[];if(b.dropOnEmpty||b.tree){Droppables.add(c,e);b.droppables.push(c)}(b.elements||this.findElements(c,b)||[]).each(function(h,f){var g=b.handles?$(b.handles[f]):(b.handle?$(h).select("."+b.handle)[0]:h);b.draggables.push(new Draggable(h,Object.extend(a,{handle:g})));Droppables.add(h,d);if(b.tree){h.treeNode=c}b.droppables.push(h)});if(b.tree){(Sortable.findTreeElements(c,b)||[]).each(function(f){Droppables.add(f,e);f.treeNode=c;b.droppables.push(f)})}this.sortables[c.id]=b;Draggables.addObserver(new SortableObserver(c,b.onUpdate))},findElements:function(b,a){return Element.findChildren(b,a.only,a.tree?true:false,a.tag)},findTreeElements:function(b,a){return Element.findChildren(b,a.only,a.tree?true:false,a.treeTag)},onHover:function(e,d,a){if(Element.isParent(d,e)){return}if(a>0.33&&a<0.66&&Sortable.options(d).tree){return}else{if(a>0.5){Sortable.mark(d,"before");if(d.previousSibling!=e){var b=e.parentNode;e.style.visibility="hidden";d.parentNode.insertBefore(e,d);if(d.parentNode!=b){Sortable.options(b).onChange(e)}Sortable.options(d.parentNode).onChange(e)}}else{Sortable.mark(d,"after");var c=d.nextSibling||null;if(c!=e){var b=e.parentNode;e.style.visibility="hidden";d.parentNode.insertBefore(e,c);if(d.parentNode!=b){Sortable.options(b).onChange(e)}Sortable.options(d.parentNode).onChange(e)}}}},onEmptyHover:function(e,g,h){var l=e.parentNode;var a=Sortable.options(g);if(!Element.isParent(g,e)){var f;var c=Sortable.findElements(g,{tag:a.tag,only:a.only});var b=null;if(c){var d=Element.offsetSize(g,a.overlap)*(1-h);for(f=0;f<c.length;f+=1){if(d-Element.offsetSize(c[f],a.overlap)>=0){d-=Element.offsetSize(c[f],a.overlap)}else{if(d-(Element.offsetSize(c[f],a.overlap)/2)>=0){b=f+1<c.length?c[f+1]:null;break}else{b=c[f];break}}}}g.insertBefore(e,b);Sortable.options(l).onChange(e);a.onChange(e)}},unmark:function(){if(Sortable._marker){Sortable._marker.hide()}},mark:function(b,a){var d=Sortable.options(b.parentNode);if(d&&!d.ghosting){return}if(!Sortable._marker){Sortable._marker=($("dropmarker")||Element.extend(document.createElement("DIV"))).hide().addClassName("dropmarker").setStyle({position:"absolute"});document.getElementsByTagName("body").item(0).appendChild(Sortable._marker)}var c=Position.cumulativeOffset(b);Sortable._marker.setStyle({left:c[0]+"px",top:c[1]+"px"});if(a=="after"){if(d.overlap=="horizontal"){Sortable._marker.setStyle({left:(c[0]+b.clientWidth)+"px"})}else{Sortable._marker.setStyle({top:(c[1]+b.clientHeight)+"px"})}}Sortable._marker.show()},_tree:function(e,b,f){var d=Sortable.findElements(e,b)||[];for(var c=0;c<d.length;++c){var a=d[c].id.match(b.format);if(!a){continue}var g={id:encodeURIComponent(a?a[1]:null),element:e,parent:f,children:[],position:f.children.length,container:$(d[c]).down(b.treeTag)};if(g.container){this._tree(g.container,b,g)}f.children.push(g)}return f},tree:function(d){d=$(d);var c=this.options(d);var b=Object.extend({tag:c.tag,treeTag:c.treeTag,only:c.only,name:d.id,format:c.format},arguments[1]||{});var a={id:null,parent:null,children:[],container:d,position:0};return Sortable._tree(d,b,a)},_constructIndex:function(b){var a="";do{if(b.id){a="["+b.position+"]"+a}}while((b=b.parent)!=null);return a},sequence:function(b){b=$(b);var a=Object.extend(this.options(b),arguments[1]||{});return $(this.findElements(b,a)||[]).map(function(c){return c.id.match(a.format)?c.id.match(a.format)[1]:""})},setSequence:function(b,c){b=$(b);var a=Object.extend(this.options(b),arguments[2]||{});var d={};this.findElements(b,a).each(function(e){if(e.id.match(a.format)){d[e.id.match(a.format)[1]]=[e,e.parentNode]}e.parentNode.removeChild(e)});c.each(function(e){var f=d[e];if(f){f[1].appendChild(f[0]);delete d[e]}})},serialize:function(c){c=$(c);var b=Object.extend(Sortable.options(c),arguments[1]||{});var a=encodeURIComponent((arguments[1]&&arguments[1].name)?arguments[1].name:c.id);if(b.tree){return Sortable.tree(c,arguments[1]).children.map(function(d){return[a+Sortable._constructIndex(d)+"[id]="+encodeURIComponent(d.id)].concat(d.children.map(arguments.callee))}).flatten().join("&")}else{return Sortable.sequence(c,arguments[1]).map(function(d){return a+"[]="+encodeURIComponent(d)}).join("&")}}};Element.isParent=function(b,a){if(!b.parentNode||b==a){return false}if(b.parentNode==a){return true}return Element.isParent(b.parentNode,a)};Element.findChildren=function(d,b,a,c){if(!d.hasChildNodes()){return null}c=c.toUpperCase();if(b){b=[b].flatten()}var e=[];$A(d.childNodes).each(function(g){if(g.tagName&&g.tagName.toUpperCase()==c&&(!b||(Element.classNames(g).detect(function(h){return b.include(h)})))){e.push(g)}if(a){var f=Element.findChildren(g,b,a,c);if(f){e.push(f)}}});return(e.length>0?e.flatten():[])};Element.offsetSize=function(a,b){return a["offset"+((b=="vertical"||b=="height")?"Height":"Width")]};if(typeof Effect=="undefined"){throw ("controls.js requires including script.aculo.us' effects.js library")}var Autocompleter={};Autocompleter.Base=Class.create({baseInitialize:function(b,c,a){b=$(b);this.element=b;this.update=$(c);this.hasFocus=false;this.changed=false;this.active=false;this.index=0;this.entryCount=0;this.oldElementValue=this.element.value;if(this.setOptions){this.setOptions(a)}else{this.options=a||{}}this.options.paramName=this.options.paramName||this.element.name;this.options.tokens=this.options.tokens||[];this.options.frequency=this.options.frequency||0.4;this.options.minChars=this.options.minChars||1;this.options.onShow=this.options.onShow||function(d,e){if(!e.style.position||e.style.position=="absolute"){e.style.position="absolute";Position.clone(d,e,{setHeight:false,offsetTop:d.offsetHeight})}Effect.Appear(e,{duration:0.15})};this.options.onHide=this.options.onHide||function(d,e){new Effect.Fade(e,{duration:0.15})};if(typeof(this.options.tokens)=="string"){this.options.tokens=new Array(this.options.tokens)}if(!this.options.tokens.include("\n")){this.options.tokens.push("\n")}this.observer=null;this.element.setAttribute("autocomplete","off");Element.hide(this.update);Event.observe(this.element,"blur",this.onBlur.bindAsEventListener(this));Event.observe(this.element,"keypress",this.onKeyPress.bindAsEventListener(this))},show:function(){if(Element.getStyle(this.update,"display")=="none"){this.options.onShow(this.element,this.update)}if(!this.iefix&&(Prototype.Browser.IE)&&(Element.getStyle(this.update,"position")=="absolute")){new Insertion.After(this.update,'<iframe id="'+this.update.id+'_iefix" style="display:none;position:absolute;filter:progid:DXImageTransform.Microsoft.Alpha(opacity=0);" src="javascript:false;" frameborder="0" scrolling="no"></iframe>');this.iefix=$(this.update.id+"_iefix")}if(this.iefix){setTimeout(this.fixIEOverlapping.bind(this),50)}},fixIEOverlapping:function(){Position.clone(this.update,this.iefix,{setTop:(!this.update.style.height)});this.iefix.style.zIndex=1;this.update.style.zIndex=2;Element.show(this.iefix)},hide:function(){this.stopIndicator();if(Element.getStyle(this.update,"display")!="none"){this.options.onHide(this.element,this.update)}if(this.iefix){Element.hide(this.iefix)}},startIndicator:function(){if(this.options.indicator){Element.show(this.options.indicator)}},stopIndicator:function(){if(this.options.indicator){Element.hide(this.options.indicator)}},onKeyPress:function(a){if(this.active){switch(a.keyCode){case Event.KEY_TAB:case Event.KEY_RETURN:this.selectEntry();Event.stop(a);case Event.KEY_ESC:this.hide();this.active=false;Event.stop(a);return;case Event.KEY_LEFT:case Event.KEY_RIGHT:return;case Event.KEY_UP:this.markPrevious();this.render();if(Prototype.Browser.WebKit){Event.stop(a)}return;case Event.KEY_DOWN:this.markNext();this.render();if(Prototype.Browser.WebKit){Event.stop(a)}return}}else{if(a.keyCode==Event.KEY_TAB||a.keyCode==Event.KEY_RETURN||(Prototype.Browser.WebKit>0&&a.keyCode==0)){return}}this.changed=true;this.hasFocus=true;if(this.observer){clearTimeout(this.observer)}this.observer=setTimeout(this.onObserverEvent.bind(this),this.options.frequency*1000)},activate:function(){this.changed=false;this.hasFocus=true;this.getUpdatedChoices()},onHover:function(b){var a=Event.findElement(b,"LI");if(this.index!=a.autocompleteIndex){this.index=a.autocompleteIndex;this.render()}Event.stop(b)},onClick:function(b){var a=Event.findElement(b,"LI");this.index=a.autocompleteIndex;this.selectEntry();this.hide()},onBlur:function(a){setTimeout(this.hide.bind(this),250);this.hasFocus=false;this.active=false},render:function(){if(this.entryCount>0){for(var a=0;a<this.entryCount;a++){this.index==a?Element.addClassName(this.getEntry(a),"selected"):Element.removeClassName(this.getEntry(a),"selected")}if(this.hasFocus){this.show();this.active=true}}else{this.active=false;this.hide()}},markPrevious:function(){if(this.index>0){this.index--}else{this.index=this.entryCount-1}this.getEntry(this.index).scrollIntoView(true)},markNext:function(){if(this.index<this.entryCount-1){this.index++}else{this.index=0}this.getEntry(this.index).scrollIntoView(false)},getEntry:function(a){return this.update.firstChild.childNodes[a]},getCurrentEntry:function(){return this.getEntry(this.index)},selectEntry:function(){this.active=false;this.updateElement(this.getCurrentEntry())},updateElement:function(f){if(this.options.updateElement){this.options.updateElement(f);return}var d="";if(this.options.select){var a=$(f).select("."+this.options.select)||[];if(a.length>0){d=Element.collectTextNodes(a[0],this.options.select)}}else{d=Element.collectTextNodesIgnoreClass(f,"informal")}var c=this.getTokenBounds();if(c[0]!=-1){var e=this.element.value.substr(0,c[0]);var b=this.element.value.substr(c[0]).match(/^\s+/);if(b){e+=b[0]}this.element.value=e+d+this.element.value.substr(c[1])}else{this.element.value=d}this.oldElementValue=this.element.value;this.element.focus();if(this.options.afterUpdateElement){this.options.afterUpdateElement(this.element,f)}},updateChoices:function(c){if(!this.changed&&this.hasFocus){this.update.innerHTML=c;Element.cleanWhitespace(this.update);Element.cleanWhitespace(this.update.down());if(this.update.firstChild&&this.update.down().childNodes){this.entryCount=this.update.down().childNodes.length;for(var a=0;a<this.entryCount;a++){var b=this.getEntry(a);b.autocompleteIndex=a;this.addObservers(b)}}else{this.entryCount=0}this.stopIndicator();this.index=0;if(this.entryCount==1&&this.options.autoSelect){this.selectEntry();this.hide()}else{this.render()}}},addObservers:function(a){Event.observe(a,"mouseover",this.onHover.bindAsEventListener(this));Event.observe(a,"click",this.onClick.bindAsEventListener(this))},onObserverEvent:function(){this.changed=false;this.tokenBounds=null;if(this.getToken().length>=this.options.minChars){this.getUpdatedChoices()}else{this.active=false;this.hide()}this.oldElementValue=this.element.value},getToken:function(){var a=this.getTokenBounds();return this.element.value.substring(a[0],a[1]).strip()},getTokenBounds:function(){if(null!=this.tokenBounds){return this.tokenBounds}var e=this.element.value;if(e.strip().empty()){return[-1,0]}var f=arguments.callee.getFirstDifferencePos(e,this.oldElementValue);var h=(f==this.oldElementValue.length?1:0);var d=-1,c=e.length;var g;for(var b=0,a=this.options.tokens.length;b<a;++b){g=e.lastIndexOf(this.options.tokens[b],f+h-1);if(g>d){d=g}g=e.indexOf(this.options.tokens[b],f+h);if(-1!=g&&g<c){c=g}}return(this.tokenBounds=[d+1,c])}});Autocompleter.Base.prototype.getTokenBounds.getFirstDifferencePos=function(c,a){var d=Math.min(c.length,a.length);for(var b=0;b<d;++b){if(c[b]!=a[b]){return b}}return d};Ajax.Autocompleter=Class.create(Autocompleter.Base,{initialize:function(c,d,b,a){this.baseInitialize(c,d,a);this.options.asynchronous=true;this.options.onComplete=this.onComplete.bind(this);this.options.defaultParams=this.options.parameters||null;this.url=b},getUpdatedChoices:function(){this.startIndicator();var a=encodeURIComponent(this.options.paramName)+"="+encodeURIComponent(this.getToken());this.options.parameters=this.options.callback?this.options.callback(this.element,a):a;if(this.options.defaultParams){this.options.parameters+="&"+this.options.defaultParams}new Ajax.Request(this.url,this.options)},onComplete:function(a){this.updateChoices(a.responseText)}});Autocompleter.Local=Class.create(Autocompleter.Base,{initialize:function(b,d,c,a){this.baseInitialize(b,d,a);this.options.array=c},getUpdatedChoices:function(){this.updateChoices(this.options.selector(this))},setOptions:function(a){this.options=Object.extend({choices:10,partialSearch:true,partialChars:2,ignoreCase:true,fullSearch:false,selector:function(b){var d=[];var c=[];var h=b.getToken();var g=0;for(var e=0;e<b.options.array.length&&d.length<b.options.choices;e++){var f=b.options.array[e];var l=b.options.ignoreCase?f.toLowerCase().indexOf(h.toLowerCase()):f.indexOf(h);while(l!=-1){if(l==0&&f.length!=h.length){d.push("<li><strong>"+f.substr(0,h.length)+"</strong>"+f.substr(h.length)+"</li>");break}else{if(h.length>=b.options.partialChars&&b.options.partialSearch&&l!=-1){if(b.options.fullSearch||/\s/.test(f.substr(l-1,1))){c.push("<li>"+f.substr(0,l)+"<strong>"+f.substr(l,h.length)+"</strong>"+f.substr(l+h.length)+"</li>");break}}}l=b.options.ignoreCase?f.toLowerCase().indexOf(h.toLowerCase(),l+1):f.indexOf(h,l+1)}}if(c.length){d=d.concat(c.slice(0,b.options.choices-d.length))}return"<ul>"+d.join("")+"</ul>"}},a||{})}});Field.scrollFreeActivate=function(a){setTimeout(function(){Field.activate(a)},1)};Ajax.InPlaceEditor=Class.create({initialize:function(c,b,a){this.url=b;this.element=c=$(c);this.prepareOptions();this._controls={};arguments.callee.dealWithDeprecatedOptions(a);Object.extend(this.options,a||{});if(!this.options.formId&&this.element.id){this.options.formId=this.element.id+"-inplaceeditor";if($(this.options.formId)){this.options.formId=""}}if(this.options.externalControl){this.options.externalControl=$(this.options.externalControl)}if(!this.options.externalControl){this.options.externalControlOnly=false}this._originalBackground=this.element.getStyle("background-color")||"transparent";this.element.title=this.options.clickToEditText;this._boundCancelHandler=this.handleFormCancellation.bind(this);this._boundComplete=(this.options.onComplete||Prototype.emptyFunction).bind(this);this._boundFailureHandler=this.handleAJAXFailure.bind(this);this._boundSubmitHandler=this.handleFormSubmission.bind(this);this._boundWrapperHandler=this.wrapUp.bind(this);this.registerListeners()},checkForEscapeOrReturn:function(a){if(!this._editing||a.ctrlKey||a.altKey||a.shiftKey){return}if(Event.KEY_ESC==a.keyCode){this.handleFormCancellation(a)}else{if(Event.KEY_RETURN==a.keyCode){this.handleFormSubmission(a)}}},createControl:function(g,c,b){var e=this.options[g+"Control"];var f=this.options[g+"Text"];if("button"==e){var a=document.createElement("input");a.type="submit";a.value=f;a.className="editor_"+g+"_button";if("cancel"==g){a.onclick=this._boundCancelHandler}this._form.appendChild(a);this._controls[g]=a}else{if("link"==e){var d=document.createElement("a");d.href="#";d.appendChild(document.createTextNode(f));d.onclick="cancel"==g?this._boundCancelHandler:this._boundSubmitHandler;d.className="editor_"+g+"_link";if(b){d.className+=" "+b}this._form.appendChild(d);this._controls[g]=d}}},createEditField:function(){var c=(this.options.loadTextURL?this.options.loadingText:this.getText());var b;if(1>=this.options.rows&&!/\r|\n/.test(this.getText())){b=document.createElement("input");b.type="text";var a=this.options.size||this.options.cols||0;if(0<a){b.size=a}}else{b=document.createElement("textarea");b.rows=(1>=this.options.rows?this.options.autoRows:this.options.rows);b.cols=this.options.cols||40}b.name=this.options.paramName;b.value=c;b.className="editor_field";if(this.options.submitOnBlur){b.onblur=this._boundSubmitHandler}this._controls.editor=b;if(this.options.loadTextURL){this.loadExternalText()}this._form.appendChild(this._controls.editor)},createForm:function(){var b=this;function a(d,e){var c=b.options["text"+d+"Controls"];if(!c||e===false){return}b._form.appendChild(document.createTextNode(c))}this._form=$(document.createElement("form"));this._form.id=this.options.formId;this._form.addClassName(this.options.formClassName);this._form.onsubmit=this._boundSubmitHandler;this.createEditField();if("textarea"==this._controls.editor.tagName.toLowerCase()){this._form.appendChild(document.createElement("br"))}if(this.options.onFormCustomization){this.options.onFormCustomization(this,this._form)}a("Before",this.options.okControl||this.options.cancelControl);this.createControl("ok",this._boundSubmitHandler);a("Between",this.options.okControl&&this.options.cancelControl);this.createControl("cancel",this._boundCancelHandler,"editor_cancel");a("After",this.options.okControl||this.options.cancelControl)},destroy:function(){if(this._oldInnerHTML){this.element.innerHTML=this._oldInnerHTML}this.leaveEditMode();this.unregisterListeners()},enterEditMode:function(a){if(this._saving||this._editing){return}this._editing=true;this.triggerCallback("onEnterEditMode");if(this.options.externalControl){this.options.externalControl.hide()}this.element.hide();this.createForm();this.element.parentNode.insertBefore(this._form,this.element);if(!this.options.loadTextURL){this.postProcessEditField()}if(a){Event.stop(a)}},enterHover:function(a){if(this.options.hoverClassName){this.element.addClassName(this.options.hoverClassName)}if(this._saving){return}this.triggerCallback("onEnterHover")},getText:function(){return this.element.innerHTML},handleAJAXFailure:function(a){this.triggerCallback("onFailure",a);if(this._oldInnerHTML){this.element.innerHTML=this._oldInnerHTML;this._oldInnerHTML=null}},handleFormCancellation:function(a){this.wrapUp();if(a){Event.stop(a)}},handleFormSubmission:function(d){var b=this._form;var c=$F(this._controls.editor);this.prepareSubmission();var f=this.options.callback(b,c)||"";if(Object.isString(f)){f=f.toQueryParams()}f.editorId=this.element.id;if(this.options.htmlResponse){var a=Object.extend({evalScripts:true},this.options.ajaxOptions);Object.extend(a,{parameters:f,onComplete:this._boundWrapperHandler,onFailure:this._boundFailureHandler});new Ajax.Updater({success:this.element},this.url,a)}else{var a=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(a,{parameters:f,onComplete:this._boundWrapperHandler,onFailure:this._boundFailureHandler});new Ajax.Request(this.url,a)}if(d){Event.stop(d)}},leaveEditMode:function(){this.element.removeClassName(this.options.savingClassName);this.removeForm();this.leaveHover();this.element.style.backgroundColor=this._originalBackground;this.element.show();if(this.options.externalControl){this.options.externalControl.show()}this._saving=false;this._editing=false;this._oldInnerHTML=null;this.triggerCallback("onLeaveEditMode")},leaveHover:function(a){if(this.options.hoverClassName){this.element.removeClassName(this.options.hoverClassName)}if(this._saving){return}this.triggerCallback("onLeaveHover")},loadExternalText:function(){this._form.addClassName(this.options.loadingClassName);this._controls.editor.disabled=true;var a=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(a,{parameters:"editorId="+encodeURIComponent(this.element.id),onComplete:Prototype.emptyFunction,onSuccess:function(c){this._form.removeClassName(this.options.loadingClassName);var b=c.responseText;if(this.options.stripLoadedTextTags){b=b.stripTags()}this._controls.editor.value=b;this._controls.editor.disabled=false;this.postProcessEditField()}.bind(this),onFailure:this._boundFailureHandler});new Ajax.Request(this.options.loadTextURL,a)},postProcessEditField:function(){var a=this.options.fieldPostCreation;if(a){$(this._controls.editor)["focus"==a?"focus":"activate"]()}},prepareOptions:function(){this.options=Object.clone(Ajax.InPlaceEditor.DefaultOptions);Object.extend(this.options,Ajax.InPlaceEditor.DefaultCallbacks);[this._extraDefaultOptions].flatten().compact().each(function(a){Object.extend(this.options,a)}.bind(this))},prepareSubmission:function(){this._saving=true;this.removeForm();this.leaveHover();this.showSaving()},registerListeners:function(){this._listeners={};var a;$H(Ajax.InPlaceEditor.Listeners).each(function(b){a=this[b.value].bind(this);this._listeners[b.key]=a;if(!this.options.externalControlOnly){this.element.observe(b.key,a)}if(this.options.externalControl){this.options.externalControl.observe(b.key,a)}}.bind(this))},removeForm:function(){if(!this._form){return}this._form.remove();this._form=null;this._controls={}},showSaving:function(){this._oldInnerHTML=this.element.innerHTML;this.element.innerHTML=this.options.savingText;this.element.addClassName(this.options.savingClassName);this.element.style.backgroundColor=this._originalBackground;this.element.show()},triggerCallback:function(b,a){if("function"==typeof this.options[b]){this.options[b](this,a)}},unregisterListeners:function(){$H(this._listeners).each(function(a){if(!this.options.externalControlOnly){this.element.stopObserving(a.key,a.value)}if(this.options.externalControl){this.options.externalControl.stopObserving(a.key,a.value)}}.bind(this))},wrapUp:function(a){this.leaveEditMode();this._boundComplete(a,this.element)}});Object.extend(Ajax.InPlaceEditor.prototype,{dispose:Ajax.InPlaceEditor.prototype.destroy});Ajax.InPlaceCollectionEditor=Class.create(Ajax.InPlaceEditor,{initialize:function($super,c,b,a){this._extraDefaultOptions=Ajax.InPlaceCollectionEditor.DefaultOptions;$super(c,b,a)},createEditField:function(){var a=document.createElement("select");a.name=this.options.paramName;a.size=1;this._controls.editor=a;this._collection=this.options.collection||[];if(this.options.loadCollectionURL){this.loadCollection()}else{this.checkForExternalText()}this._form.appendChild(this._controls.editor)},loadCollection:function(){this._form.addClassName(this.options.loadingClassName);this.showLoadingText(this.options.loadingCollectionText);var options=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(options,{parameters:"editorId="+encodeURIComponent(this.element.id),onComplete:Prototype.emptyFunction,onSuccess:function(transport){var js=transport.responseText.strip();if(!/^\[.*\]$/.test(js)){throw"Server returned an invalid collection representation."}this._collection=eval(js);this.checkForExternalText()}.bind(this),onFailure:this.onFailure});new Ajax.Request(this.options.loadCollectionURL,options)},showLoadingText:function(b){this._controls.editor.disabled=true;var a=this._controls.editor.firstChild;if(!a){a=document.createElement("option");a.value="";this._controls.editor.appendChild(a);a.selected=true}a.update((b||"").stripScripts().stripTags())},checkForExternalText:function(){this._text=this.getText();if(this.options.loadTextURL){this.loadExternalText()}else{this.buildOptionList()}},loadExternalText:function(){this.showLoadingText(this.options.loadingText);var a=Object.extend({method:"get"},this.options.ajaxOptions);Object.extend(a,{parameters:"editorId="+encodeURIComponent(this.element.id),onComplete:Prototype.emptyFunction,onSuccess:function(b){this._text=b.responseText.strip();this.buildOptionList()}.bind(this),onFailure:this.onFailure});new Ajax.Request(this.options.loadTextURL,a)},buildOptionList:function(){this._form.removeClassName(this.options.loadingClassName);this._collection=this._collection.map(function(d){return 2===d.length?d:[d,d].flatten()});var b=("value" in this.options)?this.options.value:this._text;var a=this._collection.any(function(d){return d[0]==b}.bind(this));this._controls.editor.update("");var c;this._collection.each(function(e,d){c=document.createElement("option");c.value=e[0];c.selected=a?e[0]==b:0==d;c.appendChild(document.createTextNode(e[1]));this._controls.editor.appendChild(c)}.bind(this));this._controls.editor.disabled=false;Field.scrollFreeActivate(this._controls.editor)}});Ajax.InPlaceEditor.prototype.initialize.dealWithDeprecatedOptions=function(a){if(!a){return}function b(c,d){if(c in a||d===undefined){return}a[c]=d}b("cancelControl",(a.cancelLink?"link":(a.cancelButton?"button":a.cancelLink==a.cancelButton==false?false:undefined)));b("okControl",(a.okLink?"link":(a.okButton?"button":a.okLink==a.okButton==false?false:undefined)));b("highlightColor",a.highlightcolor);b("highlightEndColor",a.highlightendcolor)};Object.extend(Ajax.InPlaceEditor,{DefaultOptions:{ajaxOptions:{},autoRows:3,cancelControl:"link",cancelText:"cancel",clickToEditText:"Click to edit",externalControl:null,externalControlOnly:false,fieldPostCreation:"activate",formClassName:"inplaceeditor-form",formId:null,highlightColor:"#ffff99",highlightEndColor:"#ffffff",hoverClassName:"",htmlResponse:true,loadingClassName:"inplaceeditor-loading",loadingText:"Loading...",okControl:"button",okText:"ok",paramName:"value",rows:1,savingClassName:"inplaceeditor-saving",savingText:"Saving...",size:0,stripLoadedTextTags:false,submitOnBlur:false,textAfterControls:"",textBeforeControls:"",textBetweenControls:""},DefaultCallbacks:{callback:function(a){return Form.serialize(a)},onComplete:function(b,a){new Effect.Highlight(a,{startcolor:this.options.highlightColor,keepBackgroundImage:true})},onEnterEditMode:null,onEnterHover:function(a){a.element.style.backgroundColor=a.options.highlightColor;if(a._effect){a._effect.cancel()}},onFailure:function(b,a){alert("Error communication with the server: "+b.responseText.stripTags())},onFormCustomization:null,onLeaveEditMode:null,onLeaveHover:function(a){a._effect=new Effect.Highlight(a.element,{startcolor:a.options.highlightColor,endcolor:a.options.highlightEndColor,restorecolor:a._originalBackground,keepBackgroundImage:true})}},Listeners:{click:"enterEditMode",keydown:"checkForEscapeOrReturn",mouseover:"enterHover",mouseout:"leaveHover"}});Ajax.InPlaceCollectionEditor.DefaultOptions={loadingCollectionText:"Loading options..."};Form.Element.DelayedObserver=Class.create({initialize:function(b,a,c){this.delay=a||0.5;this.element=$(b);this.callback=c;this.timer=null;this.lastValue=$F(this.element);Event.observe(this.element,"keyup",this.delayedListener.bindAsEventListener(this))},delayedListener:function(a){if(this.lastValue==$F(this.element)){return}if(this.timer){clearTimeout(this.timer)}this.timer=setTimeout(this.onTimerEvent.bind(this),this.delay*1000);this.lastValue=$F(this.element)},onTimerEvent:function(){this.timer=null;this.callback(this.element,$F(this.element))}});if(!Control){var Control={}}Control.Slider=Class.create({initialize:function(d,a,b){var c=this;if(Object.isArray(d)){this.handles=d.collect(function(f){return $(f)})}else{this.handles=[$(d)]}this.track=$(a);this.options=b||{};this.axis=this.options.axis||"horizontal";this.increment=this.options.increment||1;this.step=parseInt(this.options.step||"1");this.range=this.options.range||$R(0,1);this.value=0;this.values=this.handles.map(function(){return 0});this.spans=this.options.spans?this.options.spans.map(function(e){return $(e)}):false;this.options.startSpan=$(this.options.startSpan||null);this.options.endSpan=$(this.options.endSpan||null);this.restricted=this.options.restricted||false;this.maximum=this.options.maximum||this.range.end;this.minimum=this.options.minimum||this.range.start;this.alignX=parseInt(this.options.alignX||"0");this.alignY=parseInt(this.options.alignY||"0");this.trackLength=this.maximumOffset()-this.minimumOffset();this.handleLength=this.isVertical()?(this.handles[0].offsetHeight!=0?this.handles[0].offsetHeight:this.handles[0].style.height.replace(/px$/,"")):(this.handles[0].offsetWidth!=0?this.handles[0].offsetWidth:this.handles[0].style.width.replace(/px$/,""));this.active=false;this.dragging=false;this.disabled=false;if(this.options.disabled){this.setDisabled()}this.allowedValues=this.options.values?this.options.values.sortBy(Prototype.K):false;if(this.allowedValues){this.minimum=this.allowedValues.min();this.maximum=this.allowedValues.max()}this.eventMouseDown=this.startDrag.bindAsEventListener(this);this.eventMouseUp=this.endDrag.bindAsEventListener(this);this.eventMouseMove=this.update.bindAsEventListener(this);this.handles.each(function(f,e){e=c.handles.length-1-e;c.setValue(parseFloat((Object.isArray(c.options.sliderValue)?c.options.sliderValue[e]:c.options.sliderValue)||c.range.start),e);f.makePositioned().observe("mousedown",c.eventMouseDown)});this.track.observe("mousedown",this.eventMouseDown);document.observe("mouseup",this.eventMouseUp);document.observe("mousemove",this.eventMouseMove);this.initialized=true},dispose:function(){var a=this;Event.stopObserving(this.track,"mousedown",this.eventMouseDown);Event.stopObserving(document,"mouseup",this.eventMouseUp);Event.stopObserving(document,"mousemove",this.eventMouseMove);this.handles.each(function(b){Event.stopObserving(b,"mousedown",a.eventMouseDown)})},setDisabled:function(){this.disabled=true},setEnabled:function(){this.disabled=false},getNearestValue:function(a){if(this.allowedValues){if(a>=this.allowedValues.max()){return(this.allowedValues.max())}if(a<=this.allowedValues.min()){return(this.allowedValues.min())}var c=Math.abs(this.allowedValues[0]-a);var b=this.allowedValues[0];this.allowedValues.each(function(d){var e=Math.abs(d-a);if(e<=c){b=d;c=e}});return b}if(a>this.range.end){return this.range.end}if(a<this.range.start){return this.range.start}return a},setValue:function(b,a){if(!this.active){this.activeHandleIdx=a||0;this.activeHandle=this.handles[this.activeHandleIdx];this.updateStyles()}a=a||this.activeHandleIdx||0;if(this.initialized&&this.restricted){if((a>0)&&(b<this.values[a-1])){b=this.values[a-1]}if((a<(this.handles.length-1))&&(b>this.values[a+1])){b=this.values[a+1]}}b=this.getNearestValue(b);this.values[a]=b;this.value=this.values[0];this.handles[a].style[this.isVertical()?"top":"left"]=this.translateToPx(b);this.drawSpans();if(!this.dragging||!this.event){this.updateFinished()}},setValueBy:function(b,a){this.setValue(this.values[a||this.activeHandleIdx||0]+b,a||this.activeHandleIdx||0)},translateToPx:function(a){return Math.round(((this.trackLength-this.handleLength)/(this.range.end-this.range.start))*(a-this.range.start))+"px"},translateToValue:function(a){return((a/(this.trackLength-this.handleLength)*(this.range.end-this.range.start))+this.range.start)},getRange:function(b){var a=this.values.sortBy(Prototype.K);b=b||0;return $R(a[b],a[b+1])},minimumOffset:function(){return(this.isVertical()?this.alignY:this.alignX)},maximumOffset:function(){return(this.isVertical()?(this.track.offsetHeight!=0?this.track.offsetHeight:this.track.style.height.replace(/px$/,""))-this.alignY:(this.track.offsetWidth!=0?this.track.offsetWidth:this.track.style.width.replace(/px$/,""))-this.alignX)},isVertical:function(){return(this.axis=="vertical")},drawSpans:function(){var a=this;if(this.spans){$R(0,this.spans.length-1).each(function(b){a.setSpan(a.spans[b],a.getRange(b))})}if(this.options.startSpan){this.setSpan(this.options.startSpan,$R(0,this.values.length>1?this.getRange(0).min():this.value))}if(this.options.endSpan){this.setSpan(this.options.endSpan,$R(this.values.length>1?this.getRange(this.spans.length-1).max():this.value,this.maximum))}},setSpan:function(b,a){if(this.isVertical()){b.style.top=this.translateToPx(a.start);b.style.height=this.translateToPx(a.end-a.start+this.range.start)}else{b.style.left=this.translateToPx(a.start);b.style.width=this.translateToPx(a.end-a.start+this.range.start)}},updateStyles:function(){this.handles.each(function(a){Element.removeClassName(a,"selected")});Element.addClassName(this.activeHandle,"selected")},startDrag:function(c){if(Event.isLeftClick(c)){if(!this.disabled){this.active=true;var d=Event.element(c);var e=[Event.pointerX(c),Event.pointerY(c)];var a=d;if(a==this.track){var b=Position.cumulativeOffset(this.track);this.event=c;this.setValue(this.translateToValue((this.isVertical()?e[1]-b[1]:e[0]-b[0])-(this.handleLength/2)));var b=Position.cumulativeOffset(this.activeHandle);this.offsetX=(e[0]-b[0]);this.offsetY=(e[1]-b[1])}else{while((this.handles.indexOf(d)==-1)&&d.parentNode){d=d.parentNode}if(this.handles.indexOf(d)!=-1){this.activeHandle=d;this.activeHandleIdx=this.handles.indexOf(this.activeHandle);this.updateStyles();var b=Position.cumulativeOffset(this.activeHandle);this.offsetX=(e[0]-b[0]);this.offsetY=(e[1]-b[1])}}}Event.stop(c)}},update:function(a){if(this.active){if(!this.dragging){this.dragging=true}this.draw(a);if(Prototype.Browser.WebKit){window.scrollBy(0,0)}Event.stop(a)}},draw:function(b){var c=[Event.pointerX(b),Event.pointerY(b)];var a=Position.cumulativeOffset(this.track);c[0]-=this.offsetX+a[0];c[1]-=this.offsetY+a[1];this.event=b;this.setValue(this.translateToValue(this.isVertical()?c[1]:c[0]));if(this.initialized&&this.options.onSlide){this.options.onSlide(this.values.length>1?this.values:this.value,this)}},endDrag:function(a){if(this.active&&this.dragging){this.finishDrag(a,true);Event.stop(a)}this.active=false;this.dragging=false},finishDrag:function(a,b){this.active=false;this.dragging=false;this.updateFinished()},updateFinished:function(){if(this.initialized&&this.options.onChange){this.options.onChange(this.values.length>1?this.values:this.value,this)}this.event=null}});var Shadower={shadow:function(d){if(Modernizr.boxshadow){d.addClassName("css_boxshadow");return}d=$(d);var n=Object.extend({distance:8,angle:130,opacity:0.7,nestedShadows:4,color:"#000000"},arguments[1]||{});this.options=n;var a=Element.getStyle(d,"position");var h=d.parentNode;if(!d.shadowZIndex){if(a!="absolute"&&a!="fixed"){var g=this.idSafeClone(d);g.id=null;h.insertBefore(g,d);Position.absolutize(d);Position.clone(g,d);d.style.margin="0";g.style.visibility="hidden";a="absolute"}d.shadowZIndex=new Number(Element.getStyle(d,"zIndex")?Element.getStyle(d,"zIndex"):1);d.style.zIndex=d.shadowZIndex+n.nestedShadows}if(arguments[2]){this.deshadow(d)}if(!d.shadows){d.shadows=new Array(n.nestedShadows);for(var e=0;e<n.nestedShadows;e++){var m=new Element("div",{className:"shadow_class"});Element.hide(m);m.appendChild(document.createTextNode(" "));if(h){h.appendChild(m)}m.style.position=a;m.style.backgroundColor=n.color;Element.setOpacity(m,n.opacity/n.nestedShadows);m.style.zIndex=d.shadowZIndex+e;d.shadows[e]=m}}var l=this.getLegendHeight(d);Position.prepare();var c=Position.positionedOffset(d);var f=-Math.cos(-n.angle*Math.PI/180)*n.distance;var b=-Math.sin(-n.angle*Math.PI/180)*n.distance;d.shadows.each(function(p,o){p.style.top=Math.ceil(c[1]+f+o+(l/2))+"px";p.style.left=(c[0]+b+o)+"px";p.style.width=(d.offsetWidth-(2*o))+"px";p.style.height=(d.offsetHeight-(2*o)-(l/2))+"px";Element.show(p)})},showShadows:function(d){if(!d.shadows){return}var b=this.options;var a=this.getLegendHeight(d);Position.prepare();var e=Position.positionedOffset(d);var c=-Math.cos(-b.angle*Math.PI/180)*b.distance;var f=-Math.sin(-b.angle*Math.PI/180)*b.distance;if(d.shadowZIndex&&d.getStyle("zIndex")&&d.getStyle("zIndex")<=d.shadowZIndex){d.setStyle({zIndex:d.shadowZIndex+20})}d.shadows.each(function(h,g){h.style.top=Math.ceil(e[1]+c+g+(a/2))+"px";h.style.left=(e[0]+f+g)+"px";h.style.width=(d.offsetWidth-(2*g))+"px";h.style.height=(d.offsetHeight-(2*g)-(a/2))+"px";Element.show(h)})},idSafeClone:function(b){var c=b.cloneNode(false);if(c.hasAttribute&&c.hasAttribute("id")){c.removeAttribute("id")}var a=$A(b.childNodes).collect(this.idSafeClone.bind(this));a.each(function(d){c.appendChild(d)});return c},getLegendHeight:function(a){if(a.nodeName.toLowerCase()=="fieldset"){var b;$A(a.childNodes).each(function(c){if(c.nodeName.toLowerCase()=="legend"){b=c;throw $break}});if(b){return Element.getDimensions(b).height}}return 0},deshadow:function(a){if(Modernizr.boxshadow){a.removeClassName("css_boxshadow");return}a=$(a);if(a.shadows){a.shadows.each(Element.remove);a.shadows=null}},shadowWithClass:function(a,b){$$("."+a).each(function(c){this.shadow(c,b)}.bind(this))}};if((typeof Prototype=="undefined")||(typeof Element=="undefined")||(typeof Element.Methods=="undefined")||parseFloat(Prototype.Version.split(".")[0]+"."+Prototype.Version.split(".")[1])<1.5){throw ("Shadower requires the Prototype JavaScript framework >= 1.5.0")}Effect.Corner=Class.create();Object.extend(Object.extend(Effect.Corner.prototype,Effect.Base.prototype),{hex2:function(a){var a=parseInt(a).toString(16);return(a.length<2)?"0"+a:a},gpc:function(b){for(;b&&b.nodeName.toLowerCase()!="html";b=b.parentNode){var a=Element.getStyle(b,"backgroundColor");if(a.indexOf("rgb")>=0){rgb=a.match(/\d+/g);return"#"+this.hex2(rgb[0])+this.hex2(rgb[1])+this.hex2(rgb[2])}if(a&&a!="transparent"){return a}}return"#ffffff"},getW:function(a){switch(this.fx){case"round":return Math.round(this.width*(1-Math.cos(Math.asin(a/this.width))));case"cool":return Math.round(this.width*(1+Math.cos(Math.asin(a/this.width))));case"sharp":return Math.round(this.width*(1-Math.cos(Math.acos(a/this.width))));case"bite":return Math.round(this.width*(Math.cos(Math.asin((this.width-a-1)/this.width))));case"slide":return Math.round(this.width*(Math.atan2(a,this.width/a)));case"jut":return Math.round(this.width*(Math.atan2(this.width,(this.width-a-1))));case"curl":return Math.round(this.width*(Math.atan(a)));case"tear":return Math.round(this.width*(Math.cos(a)));case"wicked":return Math.round(this.width*(Math.tan(a)));case"long":return Math.round(this.width*(Math.sqrt(a)));case"sculpt":return Math.round(this.width*(Math.log((this.width-a-1),this.width)));case"dog":return(a&1)?(a+1):this.width;case"dog2":return(a&2)?(a+1):this.width;case"dog3":return(a&3)?(a+1):this.width;case"fray":return(a%2)*this.width;case"notch":return this.width;case"bevel":return a+1}},initialize:function(b,n){b=$(b);n=(n||"").toLowerCase();var u=/keep/.test(n);var l=((n.match(/cc:(#[0-9a-f]+)/)||[])[1]);var a=((n.match(/sc:(#[0-9a-f]+)/)||[])[1]);this.width=parseInt((n.match(/(\d+)px/)||[])[1])||10;var p=/round|bevel|notch|bite|cool|sharp|slide|jut|curl|tear|fray|wicked|sculpt|long|dog3|dog2|dog/;this.fx=((n.match(p)||["round"])[0]);var c={T:0,B:1};var h={TL:/top|tl/.test(n),TR:/top|tr/.test(n),BL:/bottom|bl/.test(n),BR:/bottom|br/.test(n)};if(!h.TL&&!h.TR&&!h.BL&&!h.BR){h={TL:1,TR:1,BL:1,BR:1}}var r=document.createElement("div");r.style.overflow="hidden";r.style.height="1px";r.style.backgroundColor=a||"transparent";r.style.borderStyle="solid";var x={T:parseInt(Element.getStyle(b,"paddingTop"))||0,R:parseInt(Element.getStyle(b,"paddingRight"))||0,B:parseInt(Element.getStyle(b,"paddingBottom"))||0,L:parseInt(Element.getStyle(b,"paddingLeft"))||0};if(/MSIE/.test(navigator.userAgent)){b.style.zoom=1}if(!u){b.style.border="none"}r.style.borderColor=l||this.gpc(b.parentNode);var q=Element.getHeight(b);for(var s in c){var g=c[s];r.style.borderStyle="none "+(h[s+"R"]?"solid":"none")+" none "+(h[s+"L"]?"solid":"none");var y=document.createElement("div");var m=y.style;g?b.appendChild(y):b.insertBefore(y,b.firstChild);if(g&&q!="auto"){if(Element.getStyle(b,"position")=="static"){b.style.position="relative"}m.position="absolute";m.bottom=m.left=m.padding=m.margin="0";if(/MSIE/.test(navigator.userAgent)){m.setExpression("width","this.parentNode.offsetWidth")}else{m.width="100%"}}else{m.margin=!g?"-"+x.T+"px -"+x.R+"px "+(x.T-this.width)+"px -"+x.L+"px":(x.B-this.width)+"px -"+x.R+"px -"+x.B+"px -"+x.L+"px"}for(var t=0;t<this.width;t++){var f=Math.max(0,this.getW(t));var v=r.cloneNode(false);v.style.borderWidth="0 "+(h[s+"R"]?f:0)+"px 0 "+(h[s+"L"]?f:0)+"px";g?y.appendChild(v):y.insertBefore(v,y.firstChild)}}}});Carousel=Class.create(Abstract,{initialize:function(a,d,b,c){this.scrolling=false;this.scroller=$(a);this.slides=d;this.controls=b;this.options=Object.extend({duration:1,auto:false,frequency:3,visibleSlides:1,controlClassName:"carousel-control",jumperClassName:"carousel-jumper",disabledClassName:"carousel-disabled",selectedClassName:"carousel-selected",circular:false,wheel:true,effect:"scroll",transition:"sinoidal"},c||{});if(this.options.effect=="fade"){this.options.circular=true}this.slides.each(function(f,g){f._index=g});if(this.controls){this.controls.invoke("observe","click",this.click.bind(this))}if(this.options.wheel){this.scroller.observe("mousewheel",this.wheel.bindAsEventListener(this)).observe("DOMMouseScroll",this.wheel.bindAsEventListener(this))}if(this.options.auto){this.start()}if(this.options.initial){var e=this.slides.indexOf($(this.options.initial));if(e>(this.options.visibleSlides-1)&&this.options.visibleSlides>1){if(e>this.slides.length-(this.options.visibleSlides+1)){e=this.slides.length-this.options.visibleSlides}}this.moveTo(this.slides[e])}},refreshSlides:function(b){this.slides=b;this.slides.each(function(c,d){c._index=d});if(this.current){var a=this.slides.find(function(c){return(c.id==this.current.id)}.bind(this))}if(a){this.moveTo(a)}else{this.first()}},click:function(event){this.stop();var element=event.findElement("a");if(!element.hasClassName(this.options.disabledClassName)){if(element.hasClassName(this.options.controlClassName)){eval("this."+element.rel+"()")}else{if(element.hasClassName(this.options.jumperClassName)){this.moveTo(element.rel);if(this.options.selectedClassName){this.controls.invoke("removeClassName",this.options.selectedClassName);element.addClassName(this.options.selectedClassName)}}}}this.deactivateControls();event.stop()},moveTo:function(c){if(this.options.beforeMove&&(typeof this.options.beforeMove=="function")){this.options.beforeMove()}this.previous=this.current?this.current:this.slides[0];this.current=$(c);if(!this.current){return}var d=this.scroller.cumulativeOffset();var b=this.current.cumulativeOffset();var a=this.current.previous();if(a.hasClassName("separator")){b=a.cumulativeOffset()}if(this.scrolling){this.scrolling.cancel()}switch(this.options.effect){case"fade":this.scrolling=new Effect.Opacity(this.scroller,{from:1,to:0,duration:this.options.duration,afterFinish:(function(){this.scroller.scrollLeft=b[0]-d[0];this.scroller.scrollTop=b[1]-d[1];new Effect.Opacity(this.scroller,{from:0,to:1,duration:this.options.duration,afterFinish:(function(){if(this.controls){this.activateControls()}if(this.options.afterMove&&(typeof this.options.afterMove=="function")){this.options.afterMove()}}).bind(this)})}).bind(this)});break;case"scroll":default:var e;switch(this.options.transition){case"spring":e=Effect.Transitions.spring;break;case"sinoidal":default:e=Effect.Transitions.sinoidal;break}this.scrolling=new Effect.SmoothScroll(this.scroller,{duration:this.options.duration,x:(b[0]-d[0]),y:(b[1]-d[1]),transition:e,afterFinish:(function(){if(this.controls){this.activateControls()}if(this.options.afterMove&&(typeof this.options.afterMove=="function")){this.options.afterMove()}this.scrolling=false}).bind(this)});break}return false},prev:function(){if(this.current){var a=this.current._index;var b=(a==0)?(this.options.circular?this.slides.length-1:0):a-1}else{var b=(this.options.circular?this.slides.length-1:0)}if(b==(this.slides.length-1)&&this.options.circular&&this.options.effect!="fade"){this.scroller.scrollLeft=(this.slides.length-1)*this.slides.first().getWidth();this.scroller.scrollTop=(this.slides.length-1)*this.slides.first().getHeight();b=this.slides.length-2}this.moveTo(this.slides[b])},next:function(){if(this.current){var b=this.current._index;var a=(this.slides.length-1==b)?(this.options.circular?0:b):b+1}else{var a=1}if(a==0&&this.options.circular&&this.options.effect!="fade"){this.scroller.scrollLeft=0;this.scroller.scrollTop=0;a=1}if(a>this.slides.length-(this.options.visibleSlides+1)){a=this.slides.length-this.options.visibleSlides}if(!this.slides[a]||!this.slides[a].visible()){a++}this.moveTo(this.slides[a])},first:function(){this.moveTo(this.slides[0])},last:function(){this.moveTo(this.slides[this.slides.length-1])},toggle:function(){if(this.previous){this.moveTo(this.slides[this.previous._index])}else{return false}},stop:function(){if(this.timer){clearTimeout(this.timer)}},start:function(){this.periodicallyUpdate()},pause:function(){this.stop();this.activateControls()},resume:function(a){if(a){var b=a.relatedTarget||a.toElement;if(!b||(!this.slides.include(b)&&!this.slides.any(function(c){return b.descendantOf(c)}))){this.start()}}else{this.start()}},periodicallyUpdate:function(){if(this.timer!=null){clearTimeout(this.timer);this.next()}this.timer=setTimeout(this.periodicallyUpdate.bind(this),this.options.frequency*1000)},wheel:function(a){a.cancelBubble=true;a.stop();var b=0;if(!a){a=window.event}if(a.wheelDelta){b=a.wheelDelta/120}else{if(a.detail){b=-a.detail/3}}if(!this.scrolling){this.deactivateControls();if(b>0){this.prev()}else{this.next()}}return Math.round(b)},deactivateControls:function(){this.controls.invoke("addClassName",this.options.disabledClassName)},activateControls:function(){this.controls.invoke("removeClassName",this.options.disabledClassName)}});Effect.SmoothScroll=Class.create();Object.extend(Object.extend(Effect.SmoothScroll.prototype,Effect.Base.prototype),{initialize:function(b){this.element=$(b);var a=Object.extend({x:0,y:0,mode:"absolute"},arguments[1]||{});this.start(a)},setup:function(){if(this.options.continuous&&!this.element._ext){this.element.cleanWhitespace();this.element._ext=true;this.element.appendChild(this.element.firstChild)}this.originalLeft=this.element.scrollLeft;this.originalTop=this.element.scrollTop;if(this.options.mode=="absolute"){this.options.x-=this.originalLeft;this.options.y-=this.originalTop}},update:function(a){this.element.scrollLeft=this.options.x*a+this.originalLeft;this.element.scrollTop=this.options.y*a+this.originalTop}});var webFXTreeConfig={rootIcon:"/images/foldericon.png",openRootIcon:"/images/openfoldericon.png",folderIcon:"/images/foldericon.png",openFolderIcon:"/images/openfoldericon.png",fileIcon:"/images/foldericon.png",iIcon:"/images/I.png",lIcon:"/images/L.png",lMinusIcon:"/images/Lminus.png",lPlusIcon:"/images/Lplus.png",lMinusIconActive:"/images/Lminus-active.png",lPlusIconActive:"/images/Lplus-active.png",tIcon:"/images/T.png",tMinusIcon:"/images/Tminus.png",tPlusIcon:"/images/Tplus.png",tMinusIconActive:"/images/Tminus-active.png",tPlusIconActive:"/images/Tplus-active.png",blankIcon:"/images/blank.png",defaultText:"Tree Item",defaultAction:function(a){},defaultBehavior:"classic",zipRegexp:new RegExp(/\.zip$/),usePersistence:false};Event.observe(document,"ajaxplorer:boot_loaded",function(){var a=window.ajxpResourcesFolder;webFXTreeConfig.rootIcon=a+"/images/foldericon.png";webFXTreeConfig.openRootIcon=a+"/images/openfoldericon.png";webFXTreeConfig.folderIcon=a+"/images/foldericon.png";webFXTreeConfig.openFolderIcon=a+"/images/openfoldericon.png";webFXTreeConfig.fileIcon=a+"/images/foldericon.png";webFXTreeConfig.iIcon=a+"/images/I.png";webFXTreeConfig.lIcon=a+"/images/L.png";webFXTreeConfig.lMinusIcon=a+"/images/Lminus.png";webFXTreeConfig.lPlusIcon=a+"/images/Lplus.png";webFXTreeConfig.lMinusIconActive=a+"/images/Lminus-active.png";webFXTreeConfig.lPlusIconActive=a+"/images/Lplus-active.png";webFXTreeConfig.tIcon=a+"/images/T.png";webFXTreeConfig.tMinusIcon=a+"/images/Tminus.png";webFXTreeConfig.tPlusIcon=a+"/images/Tplus.png";webFXTreeConfig.tMinusIconActive=a+"/images/Tminus-active.png";webFXTreeConfig.tPlusIconActive=a+"/images/Tplus-active.png";webFXTreeConfig.blankIcon=a+"/images/blank.png"});var webFXTreeHandler={idCounter:0,idPrefix:"webfx-tree-object-",all:{},behavior:null,selected:null,contextMenu:null,onSelect:null,getId:function(){return this.idPrefix+this.idCounter++},toggle:function(a){this.all[a.id.replace("-plus","")].toggle()},select:function(a){this.all[a.id.replace("-icon","")].select()},hasFocus:false,focus:function(a){if(this.all[a.id.replace("-anchor","")]){this.all[a.id.replace("-anchor","")].focus()}},blur:function(a){if(this.all[a.id.replace("-anchor","")]){this.all[a.id.replace("-anchor","")].blur()}},setFocus:function(a){this.hasFocus=a},keydown:function(b,a){return this.all[b.id].keydown(a.keyCode)},linkKeyPress:function(b,a){if(!this.hasFocus||a.keyCode==9){return false}return true},cookies:new WebFXCookie(),insertHTMLBeforeEnd:function(a,c){if(!a){return}if(a&&a.insertAdjacentHTML){a.insertAdjacentHTML("BeforeEnd",c);return}var d;var b=a.ownerDocument.createRange();b.selectNodeContents(a);b.collapse(false);d=b.createContextualFragment(c);a.appendChild(d)}};function WebFXCookie(){if(document.cookie.length){this.cookies=" "+document.cookie}}WebFXCookie.prototype.setCookie=function(a,b){document.cookie=a+"="+escape(b)};WebFXCookie.prototype.getCookie=function(c){if(this.cookies){var d=this.cookies.indexOf(" "+c+"=");if(d==-1){return null}var a=this.cookies.indexOf(";",d);if(a==-1){a=this.cookies.length}a-=d;var b=this.cookies.substr(d,a);return unescape(b.substr(b.indexOf("=")+1,b.length-b.indexOf("=")+1))}else{return null}};function WebFXTreeAbstractNode(b,a){this.childNodes=[];this.id=webFXTreeHandler.getId();this.text=b||webFXTreeConfig.defaultText;this.action=a||null;this.url="/";this._last=false;webFXTreeHandler.all[this.id]=this}WebFXTreeAbstractNode.prototype.add=function(e,a){e.parentNode=this;var c=e.parentNode.url;if(e.parentNode.inZip){e.inZip=true}else{if(webFXTreeConfig.zipRegexp.test(e.text)!==false){e.inZip=true}}if(!e.action&&e.parentNode.action){e.action=e.parentNode.action}this.childNodes[this.childNodes.length]=e;var b=this;if(this.childNodes.length>=2){this.childNodes[this.childNodes.length-2]._last=false}while(b.parentNode){b=b.parentNode}if(b.rendered){if(this.childNodes.length>=2){$(this.childNodes[this.childNodes.length-2].id+"-plus").src=((this.childNodes[this.childNodes.length-2].folder)?((this.childNodes[this.childNodes.length-2].open)?webFXTreeConfig.tMinusIcon:webFXTreeConfig.tPlusIcon):webFXTreeConfig.tIcon);this.childNodes[this.childNodes.length-2].plusIcon=webFXTreeConfig.tPlusIcon;this.childNodes[this.childNodes.length-2].minusIcon=webFXTreeConfig.tMinusIcon;this.childNodes[this.childNodes.length-2]._last=false}this._last=true;var f=this;while(f.parentNode){for(var d=0;d<f.parentNode.childNodes.length;d++){if(f.id==f.parentNode.childNodes[d].id){break}}if(d==f.parentNode.childNodes.length-1){f.parentNode._last=true}else{f.parentNode._last=false}f=f.parentNode}$(this.id+"-cont").insert(e.toString());$(e.id).ajxpNode=e.ajxpNode;if(!e.inZip){AjxpDroppables.add(e.id)}if(webFXTreeHandler.contextMenu){Event.observe(e.id+"-anchor","contextmenu",function(g){this.select();this.action();Event.stop(g)}.bind(e));webFXTreeHandler.contextMenu.addElements("#"+e.id+"-anchor")}Event.observe(e.id+"-anchor","click",function(g){this.select();this.action();Event.stop(g)}.bind(e));if((!this.folder)&&(!this.openIcon)){this.icon=webFXTreeConfig.folderIcon;this.openIcon=webFXTreeConfig.openFolderIcon}if(!this.folder){this.folder=true;this.collapse(true)}if(!a){this.indent()}if(this.ajxpNode&&this.ajxpNode.fake){if(this.parentNode){this.parentNode.expand()}this.expand()}}return e};WebFXTreeAbstractNode.prototype.updateLabel=function(a){$(this.id+"-label").update(a)};WebFXTreeAbstractNode.prototype.toggle=function(){if(this.folder){if(this.open){this.collapse()}else{this.expand()}}};WebFXTreeAbstractNode.prototype.select=function(){if($(this.id+"-anchor")){$(this.id+"-anchor").focus()}};WebFXTreeAbstractNode.prototype.deSelect=function(){if($(this.id+"-anchor")){$(this.id+"-anchor").className=""}webFXTreeHandler.selected=null;if($(this.id)){$(this.id).className="webfx-tree-item"}};WebFXTreeAbstractNode.prototype.focus=function(){if((webFXTreeHandler.selected)&&(webFXTreeHandler.selected!=this)){webFXTreeHandler.selected.deSelect()}webFXTreeHandler.selected=this;if((this.openIcon)&&(webFXTreeHandler.behavior!="classic")){$(this.id+"-icon").src=this.openIcon}if($(this.id+"-anchor")){$(this.id+"-anchor").focus()}$(this.id).className="webfx-tree-item selected-webfx-tree-item";if(webFXTreeHandler.onSelect){webFXTreeHandler.onSelect(this)}};WebFXTreeAbstractNode.prototype.blur=function(){if(!$(this.id)){return}if((this.openIcon)&&(webFXTreeHandler.behavior!="classic")){$(this.id+"-icon").src=this.icon}if(webFXTreeHandler.selected==this){$(this.id).className="webfx-tree-item selected-webfx-tree-item-inactive"}else{$(this.id).className="webfx-tree-item"}if(Prototype.Browser.IE){if($(this.id+"-anchor")){$(this.id+"-anchor").blur()}}};WebFXTreeAbstractNode.prototype.doExpand=function(){if(webFXTreeHandler.behavior=="classic"&&$(this.id+"-icon")){$(this.id+"-icon").src=this.openIcon}if(this.childNodes.length&&$(this.id+"-cont")){$(this.id+"-cont").style.display="block"}this.open=true;if(webFXTreeConfig.usePersistence){webFXTreeHandler.cookies.setCookie(this.id.substr(18,this.id.length-18),"1")}};WebFXTreeAbstractNode.prototype.doCollapse=function(){if(webFXTreeHandler.behavior=="classic"){$(this.id+"-icon").src=this.icon}if(this.childNodes.length){$(this.id+"-cont").style.display="none"}this.open=false;if(webFXTreeConfig.usePersistence){webFXTreeHandler.cookies.setCookie(this.id.substr(18,this.id.length-18),"0")}};WebFXTreeAbstractNode.prototype.expandAll=function(){this.expandChildren();if((this.folder)&&(!this.open)){this.expand()}};WebFXTreeAbstractNode.prototype.expandChildren=function(){for(var a=0;a<this.childNodes.length;a++){this.childNodes[a].expandAll()}};WebFXTreeAbstractNode.prototype.collapseAll=function(){this.collapseChildren();if((this.folder)&&(this.open)){this.collapse(true)}};WebFXTreeAbstractNode.prototype.collapseChildren=function(){for(var a=0;a<this.childNodes.length;a++){this.childNodes[a].collapseAll()}};WebFXTreeAbstractNode.prototype.indent=function(c,a,e,h,b){if(c==null){c=-2}var f=0;for(var d=this.childNodes.length-1;d>=0;d--){f=this.childNodes[d].indent(c+1,a,e,h);if(f){return}}if(a){if((h>=this._level)&&($(this.id+"-plus"))){if(this.folder){$(this.id+"-plus").src=(this.open)?webFXTreeConfig.lMinusIcon:webFXTreeConfig.lPlusIcon;this.plusIcon=webFXTreeConfig.lPlusIcon;this.minusIcon=webFXTreeConfig.lMinusIcon}else{if(b){$(this.id+"-plus").src=webFXTreeConfig.lIcon}}return 1}}var g=$(this.id+"-indent-"+c);if(g){if((g._last)||((a)&&(e))){g.src=webFXTreeConfig.blankIcon}else{g.src=webFXTreeConfig.iIcon}}return 0};function WebFXTree(c,a,d,e,b){this.base=WebFXTreeAbstractNode;this.base(c,a);this.icon=e||webFXTreeConfig.rootIcon;this.openIcon=b||webFXTreeConfig.openRootIcon;if(webFXTreeConfig.usePersistence){this.open=(webFXTreeHandler.cookies.getCookie(this.id.substr(18,this.id.length-18))=="0")?false:true}else{this.open=true}this.folder=true;this.rendered=false;this.onSelect=null;if(!webFXTreeHandler.behavior){webFXTreeHandler.behavior=d||webFXTreeConfig.defaultBehavior}}WebFXTree.prototype=new WebFXTreeAbstractNode;WebFXTree.prototype.setBehavior=function(a){webFXTreeHandler.behavior=a};WebFXTree.prototype.getBehavior=function(a){return webFXTreeHandler.behavior};WebFXTree.prototype.getSelected=function(){if(webFXTreeHandler.selected){return webFXTreeHandler.selected}else{return null}};WebFXTree.prototype.remove=function(){};WebFXTree.prototype.expand=function(){this.doExpand()};WebFXTree.prototype.collapse=function(a){if(!a){this.focus()}this.doCollapse()};WebFXTree.prototype.getFirst=function(){return null};WebFXTree.prototype.getLast=function(){return null};WebFXTree.prototype.getNextSibling=function(){return null};WebFXTree.prototype.getPreviousSibling=function(){return null};WebFXTree.prototype.keydown=function(b){if(!webFXTreeHandler.hasFocus){return true}if(b==9){return false}if(b==39){if(!this.open){this.expand()}else{if(this.childNodes.length){this.childNodes[0].select()}}return false}if(b==37){this.collapse();return false}if((b==40)&&(this.open)&&(this.childNodes.length)){this.childNodes[0].select();var a=this.childNodes[0];if(WebFXtimer){clearTimeout(WebFXtimer)}WebFXtimer=window.setTimeout(a.action.bind(a),1000);return false}return true};WebFXTree.prototype.toString=function(){var b='<div style="padding-top:2px; padding-left:2px;"  id="'+this.id+'" ondblclick="webFXTreeHandler.toggle(this);" class="webfx-tree-item" onkeydown="return webFXTreeHandler.keydown(this, event)"><img id="'+this.id+'-icon" class="webfx-tree-icon" src="'+((webFXTreeHandler.behavior=="classic"&&this.open)?this.openIcon:this.icon)+'" onclick="webFXTreeHandler.select(this);"><a href="/" id="'+this.id+'-anchor" onkeydown="return webFXTreeHandler.linkKeyPress(this, event);"  onfocus="webFXTreeHandler.focus(this);" onblur="webFXTreeHandler.blur(this);"'+(this.target?' target="'+this.target+'"':"")+'><span id="'+this.id+'-label">'+this.text+'</span></a></div><div id="'+this.id+'-cont" class="webfx-tree-container" style="display: '+((this.open)?"block":"none")+';">';var c=[];for(var a=0;a<this.childNodes.length;a++){c[a]=this.childNodes[a].toString(a,this.childNodes.length)}this.rendered=true;return b+c.join("")+"</div>"};function WebFXTreeItem(d,a,c,e,b){this.base=WebFXTreeAbstractNode;this.base(d,a);if(webFXTreeConfig.usePersistence){this.open=(webFXTreeHandler.cookies.getCookie(this.id.substr(18,this.id.length-18))=="1")?true:false}else{this.open=false}if(e){this.icon=e}if(b){this.openIcon=b}if(c){c.add(this)}}WebFXTreeItem.prototype=new WebFXTreeAbstractNode;WebFXTreeItem.prototype.updateIcon=function(a){this.icon=this.openIcon=a;if($(this.id+"-icon")){$(this.id+"-icon").src=a}};WebFXTreeItem.prototype.remove=function(){if(!$(this.id+"-plus")){return}var b=$(this.id+"-plus").src;var a=this.parentNode;var c=this.getPreviousSibling(true);var f=this.getNextSibling(true);var e=this.parentNode.folder;var d=((f)&&(f.parentNode)&&(f.parentNode.id==a.id))?false:true;this._remove();Droppables.remove($(this.id));if(webFXTreeHandler.contextMenu){webFXTreeHandler.contextMenu.removeElements("#"+this.id)}if(a.childNodes.length==0){$(a.id+"-cont").style.display="none";a.doCollapse();a.folder=false;a.open=false}if(!f||d){a.indent(null,true,d,this._level,a.childNodes.length)}if((c==a)&&!(a.childNodes.length)){c.folder=false;c.open=false;if($(c.id+"-plus")){b=$(c.id+"-plus").src;b=b.replace("minus","").replace("plus","");$(c.id+"-plus").src=b;$(c.id+"-icon").src=(webFXTreeHandler.all[c.id].icon?webFXTreeHandler.all[c.id].icon:webFXTreeConfig.fileIcon)}}if($(c.id+"-plus")){if(a==c.parentNode){b=b.replace("minus","").replace("plus","");$(c.id+"-plus").src=b}}};WebFXTreeItem.prototype._remove=function(){for(var c=this.childNodes.length-1;c>=0;c--){this.childNodes[c]._remove()}for(var c=0;c<this.parentNode.childNodes.length;c++){if(this==this.parentNode.childNodes[c]){for(var a=c;a<this.parentNode.childNodes.length;a++){this.parentNode.childNodes[a]=this.parentNode.childNodes[a+1]}this.parentNode.childNodes.length-=1;if(c+1==this.parentNode.childNodes.length){this.parentNode._last=true}break}}delete (webFXTreeHandler.all[this.id]);var b=$(this.id);if(b){b.parentNode.removeChild(b)}b=$(this.id+"-cont");if(b){b.parentNode.removeChild(b)}};WebFXTreeItem.prototype.expand=function(){this.doExpand();if($(this.id+"-plus")){$(this.id+"-plus").src=this.minusIcon}};WebFXTreeItem.prototype.collapse=function(a){if(!a){this.focus()}this.doCollapse();if($(this.id+"-plus")){$(this.id+"-plus").src=this.plusIcon}};WebFXTreeItem.prototype.getFirst=function(){return this.childNodes[0]};WebFXTreeItem.prototype.getLast=function(){if(this.childNodes[this.childNodes.length-1].open){return this.childNodes[this.childNodes.length-1].getLast()}else{return this.childNodes[this.childNodes.length-1]}};WebFXTreeItem.prototype.getNextSibling=function(){for(var a=0;a<this.parentNode.childNodes.length;a++){if(this==this.parentNode.childNodes[a]){break}}if(++a==this.parentNode.childNodes.length){return this.parentNode.getNextSibling()}else{return this.parentNode.childNodes[a]}};WebFXTreeItem.prototype.getPreviousSibling=function(a){for(var c=0;c<this.parentNode.childNodes.length;c++){if(this==this.parentNode.childNodes[c]){break}}if(c==0){return this.parentNode}else{if((this.parentNode.childNodes[--c].open)||(a&&this.parentNode.childNodes[c].folder)){return this.parentNode.childNodes[c].getLast()}else{return this.parentNode.childNodes[c]}}};WebFXTreeItem.prototype.getCurrentPlusIcon=function(){return((this.folder)?((this.open)?((this.parentNode._last)?"lMinusIcon":"tMinusIcon"):((this.parentNode._last)?"lPlusIcon":"tPlusIcon")):((this.parentNode._last)?"lIcon":"tIcon"))};var WebFXtimer;WebFXTreeItem.prototype.keydown=function(c){if(!webFXTreeHandler.hasFocus){return true}else{if(c==9){return false}}if((c==39)&&(this.folder)){if(!this.open){this.expand()}else{this.getFirst().select()}return false}else{if(c==37){if(this.open){this.collapse()}else{this.parentNode.select()}return false}else{if(c==40){if(this.open){this.getFirst().select();var a=this.getFirst();if(WebFXtimer){clearTimeout(WebFXtimer)}WebFXtimer=window.setTimeout(a.action.bind(a),1000)}else{var b=this.getNextSibling();if(b){b.select();if(WebFXtimer){clearTimeout(WebFXtimer)}WebFXtimer=window.setTimeout(b.action.bind(b),1000)}}return false}else{if(c==38){var b=this.getPreviousSibling();b.select();if(WebFXtimer){clearTimeout(WebFXtimer)}WebFXtimer=window.setTimeout(b.action.bind(b),1000);return false}}}}return true};WebFXTreeItem.prototype.toString=function(c,h){var g=this.parentNode;var a="";if(c+1==h){this.parentNode._last=true}var d=0;while(g.parentNode){g=g.parentNode;a='<img id="'+this.id+"-indent-"+d+'" src="'+((g._last)?webFXTreeConfig.blankIcon:webFXTreeConfig.iIcon)+'" width="19" height="20">'+a;d++}this._level=d;if(this.childNodes.length){this.folder=1}else{this.open=false}if((this.folder)||(webFXTreeHandler.behavior!="classic")){if(!this.icon){this.icon=webFXTreeConfig.folderIcon}if(!this.openIcon){this.openIcon=webFXTreeConfig.openFolderIcon}}else{if(!this.icon){this.icon=webFXTreeConfig.fileIcon}}var b=this.text.replace(/</g,"&lt;").replace(/>/g,"&gt;");var e='<div id="'+this.id+'" ondblclick="webFXTreeHandler.toggle(this);" class="webfx-tree-item" onkeydown="return webFXTreeHandler.keydown(this, event)">'+a+'<img  width="19" height="20" id="'+this.id+'-plus" src="'+((this.folder)?((this.open)?((this.parentNode._last)?webFXTreeConfig.lMinusIcon:webFXTreeConfig.tMinusIcon):((this.parentNode._last)?webFXTreeConfig.lPlusIcon:webFXTreeConfig.tPlusIcon)):((this.parentNode._last)?webFXTreeConfig.lIcon:webFXTreeConfig.tIcon))+'" onclick="webFXTreeHandler.toggle(this);"><a href="'+this.url+'" id="'+this.id+'-anchor" onkeydown="return webFXTreeHandler.linkKeyPress(this, event);" onfocus="webFXTreeHandler.focus(this);" onblur="webFXTreeHandler.blur(this);"'+(this.target?' target="'+this.target+'"':"")+'><img id="'+this.id+'-icon" class="webfx-tree-icon" src="'+((webFXTreeHandler.behavior=="classic"&&this.open)?this.openIcon:this.icon)+'"><span id="'+this.id+'-label">'+b+'</span></a></div><div id="'+this.id+'-cont" class="webfx-tree-container" style="display: '+((this.open)?"block":"none")+';">';var f=[];for(var d=0;d<this.childNodes.length;d++){f[d]=this.childNodes[d].toString(d,this.childNodes.length)}this.plusIcon=((this.parentNode._last)?webFXTreeConfig.lPlusIcon:webFXTreeConfig.tPlusIcon);this.minusIcon=((this.parentNode._last)?webFXTreeConfig.lMinusIcon:webFXTreeConfig.tMinusIcon);return e+f.join("")+"</div>"};webFXTreeConfig.loadingText="Loading...";function AJXPTree(c,a,e){this.WebFXTree=WebFXTree;this.loaded=true;this.ajxpNode=c;var d=c.getIcon();if(d.indexOf(ajxpResourcesFolder+"/")!=0){d=resolveImageSource(d,"/images/mimes/ICON_SIZE",16)}var b=c.getMetadata().get("openicon");if(b){if(b.indexOf(ajxpResourcesFolder+"/")!=0){b=resolveImageSource(b,"/images/mimes/ICON_SIZE",16)}}else{b=d}this.WebFXTree(c.getLabel(),a,"explorer",d,b);this.loading=false;this.loaded=false;this.errorText="";if(e){this.filter=e}this._loadingItem=new WebFXTreeItem(webFXTreeConfig.loadingText);if(this.open){this.ajxpNode.load()}else{this.add(this._loadingItem)}}AJXPTree.prototype=new WebFXTree;AJXPTree.prototype._webfxtree_expand=WebFXTree.prototype.expand;AJXPTree.prototype.expand=function(){if(!this.ajxpNode.fake){this.ajxpNode.load()}this._webfxtree_expand()};AJXPTree.prototype.setAjxpRootNode=function(b){this.ajxpNode=b;var a=function(){this.open=false;while(this.childNodes.length>0){this.childNodes[this.childNodes.length-1].remove()}this.loaded=false};this.ajxpNode.observe("force_clear",a.bind(this));this.ajxpNode.observe("node_replaced",a.bind(this));this.attachListeners(this,b)};AJXPTree.prototype.attachListeners=function(a,b){b.observe("child_added",function(e){if(b.getMetadata().get("paginationData")){var d=b.getMetadata().get("paginationData");if(!this.paginated){this.paginated=true;if(d.get("dirsCount")!="0"){this.updateLabel(this.text+" ("+MessageHash[d.get("overflowMessage")]+")")}}return}else{if(this.paginated){this.paginated=false;this.updateLabel(this.text)}}var f=b.findChildByPath(e);if(f){var c=_ajxpNodeToTree(f,this);if(c){this.attachListeners(c,f)}}}.bind(a));b.observe("node_replaced",function(c){if(a.updateIcon){a.updateIcon(resolveImageSource(b.getIcon(),"/images/mimes/ICON_SIZE",16))}if(a.updateLabel){a.updateLabel(b.getLabel())}}.bind(a));b.observeOnce("node_removed",function(c){a.remove()});b.observe("loading",function(){}.bind(a));b.observe("loaded",function(){this._loadingItem.remove();if(this.childNodes.length){this._webfxtree_expand()}}.bind(a))};function AJXPTreeItem(e,a,c){this.WebFXTreeItem=WebFXTreeItem;this.ajxpNode=e;var d=e.getIcon();if(d.indexOf(ajxpResourcesFolder+"/")!=0){d=resolveImageSource(d,"/images/mimes/ICON_SIZE",16)}var b=e.getMetadata().get("openicon");if(b){if(b.indexOf(ajxpResourcesFolder+"/")!=0){b=resolveImageSource(b,"/images/mimes/ICON_SIZE",16)}}else{b=d}this.folder=true;this.WebFXTreeItem(e.getLabel(),a,c,d,(b?b:resolveImageSource("folder_open.png","/images/mimes/ICON_SIZE",16)));this.loading=false;this.loaded=false;this.errorText="";this._loadingItem=new WebFXTreeItem(webFXTreeConfig.loadingText);if(this.open){this.ajxpNode.load()}else{this.add(this._loadingItem)}webFXTreeHandler.all[this.id]=this}AJXPTreeItem.prototype=new WebFXTreeItem;AJXPTreeItem.prototype._webfxtree_expand=WebFXTreeItem.prototype.expand;AJXPTreeItem.prototype.expand=function(){this.ajxpNode.load();this._webfxtree_expand()};AJXPTreeItem.prototype.attachListeners=AJXPTree.prototype.attachListeners;function _ajxpNodeToTree(c,a){if(a.filter&&!a.filter(c)){return false}var b=new AJXPTreeItem(c,null,a);if(c.isLoaded()){b.loaded=true}b.filename=c.getPath();if(a.filter){b.filter=a.filter}c.getChildren().each(function(e){var d=_ajxpNodeToTree(e,b);if(d){if(b.filter){d.filter=b.filter}b.add(d,false)}});return b}Class.create("User",{id:undefined,activeRepository:undefined,read:false,write:false,crossRepositoryCopy:false,preferences:undefined,repositories:undefined,crossRepositories:undefined,repoIcons:undefined,repoSearchEngines:undefined,isAdmin:false,initialize:function(b,a){this.id=b;this.preferences=new Hash();this.repositories=new Hash();this.crossRepositories=new Hash();this.repoIcon=new Hash();this.repoSearchEngines=new Hash();if(a){this.loadFromXml(a)}},setActiveRepository:function(c,b,a){this.activeRepository=c;this.read=(b=="1"?true:false);this.write=(a=="1"?true:false);if(this.repositories.get(c)){this.crossRepositoryCopy=this.repositories.get(c).allowCrossRepositoryCopy}if(this.crossRepositories.get(c)){this.crossRepositories.unset(c)}},getActiveRepository:function(){return this.activeRepository},canRead:function(){return this.read},canWrite:function(){return this.write},canCrossRepositoryCopy:function(){return this.crossRepositoryCopy},getPreference:function(a,b){var c=this.preferences.get(a);if(b&&c){try{return c.evalJSON()}catch(d){alert("Error parsing JSON in preferences. You should contact system admin and clear user preferences.")}}return c},getRepositoriesList:function(){return this.repositories},setPreference:function(b,c,a){if(a){c=c.toJSON()}this.preferences.set(b,c)},setRepositoriesList:function(a){this.repositories=a;this.crossRepositories=new Hash();this.repositories.each(function(b){if(b.value.allowCrossRepositoryCopy){this.crossRepositories.set(b.key,b.value)}}.bind(this))},hasCrossRepositories:function(){return(this.crossRepositories.size())},getCrossRepositories:function(){return this.crossRepositories},getRepositoryIcon:function(a){return this.repoIcon.get(a)},getRepoSearchEngine:function(a){return this.repoSearchEngines.get(a)},savePreference:function(a){if(!this.preferences.get(a)){return}var b=new Connexion();b.addParameter("get_action","save_user_pref");b.addParameter("pref_name_"+0,a);b.addParameter("pref_value_"+0,this.preferences.get(a));b.sendAsync()},savePreferences:function(f,c,a,e){var d=new Connexion();d.addParameter("get_action","save_user_pref");var b=0;this.preferences.each(function(g){d.addParameter("pref_name_"+b,g.key);d.addParameter("pref_value_"+b,g.value);b++});if(f&&c){d.addParameter("pref_name_"+b,"password");d.addParameter("pref_value_"+b,c);d.addParameter("crt",f);d.addParameter("pass_seed",a)}d.onComplete=e;d.sendAsync()},loadFromXml:function(f){var d=new Hash();for(var b=0;b<f.length;b++){if(f[b].nodeName=="active_repo"){var g=f[b]}else{if(f[b].nodeName=="repositories"){for(j=0;j<f[b].childNodes.length;j++){var l=f[b].childNodes[j];if(l.nodeName=="repo"){var e=new Repository(l.getAttribute("id"),l);d.set(l.getAttribute("id"),e)}}this.setRepositoriesList(d)}else{if(f[b].nodeName=="preferences"){for(j=0;j<f[b].childNodes.length;j++){var a=f[b].childNodes[j];if(a.nodeName=="pref"){var h=a.getAttribute("value");if(!h&&a.firstChild){h=a.firstChild.nodeValue}this.setPreference(a.getAttribute("name"),h)}}}else{if(f[b].nodeName=="special_rights"){var c=f[b].getAttribute("is_admin");if(c&&c=="1"){this.isAdmin=true}}}}}}if(g){this.setActiveRepository(g.getAttribute("id"),g.getAttribute("read"),g.getAttribute("write"))}}});Class.create("ResourcesManager",{initialize:function(){this.mainFormContainerId="all_forms";this.resources={};this.loaded=false},addJSResource:function(b,a){if(!this.resources.js){this.resources.js=[]}this.resources.js.push({fileName:b,className:a})},addCSSResource:function(a){if(!this.resources.css){this.resources.css=[]}this.resources.css.push(a)},addGuiForm:function(a,b){if(!this.resources.forms){this.resources.forms={}}this.resources.forms[a]=b},addDependency:function(a){if(!this.resources.dependencies){this.resources.dependencies=[]}this.resources.dependencies.push(a)},hasDependencies:function(){return(this.resources.dependencies||false)},load:function(a){if(this.loaded){return}if(this.hasDependencies()){this.resources.dependencies.each(function(b){if(a[b]){a[b].load(a)}}.bind(this))}if(this.resources.forms){$H(this.resources.forms).each(function(b){this.loadGuiForm(b.key,b.value)}.bind(this))}if(this.resources.js){this.resources.js.each(function(b){this.loadJSResource(b.fileName,b.className)}.bind(this))}if(this.resources.css){this.resources.css.each(function(b){this.loadCSSResource(b)}.bind(this))}this.loaded=true},loadJSResource:function(fileName,className){try{eval("window.testTemporaryObject = "+className);delete (window.testTemporaryObject)}catch(e){if(typeof(className)!="function"||typeof(className.prototype)!="object"){var conn=new Connexion();conn._libUrl=false;if(ajxpBootstrap.parameters.get("SERVER_PREFIX_URI")){conn._libUrl=ajxpBootstrap.parameters.get("SERVER_PREFIX_URI")}conn.loadLibrary(fileName)}}},loadCSSResource:function(c){var b=$$("head")[0];var a=new Element("link",{type:"text/css",rel:"stylesheet",href:c,media:"screen"});b.insert(a)},loadGuiForm:function(a,b){if(!$(this.mainFormContainerId).select('[id="'+a+'"]').length){b.evalScripts();$(this.mainFormContainerId).insert(b.stripScripts())}},loadFromXmlNode:function(b){if(b.nodeName=="resources"){for(var a=0;a<b.childNodes.length;a++){if(b.childNodes[a].nodeName=="js"){this.addJSResource(b.childNodes[a].getAttribute("file"),b.childNodes[a].getAttribute("className"))}else{if(b.childNodes[a].nodeName=="css"){this.addCSSResource(b.childNodes[a].getAttribute("file"))}else{if(b.childNodes[a].nodeName=="img_library"){addImageLibrary(b.childNodes[a].getAttribute("alias"),b.childNodes[a].getAttribute("path"))}}}}}else{if(b.nodeName=="dependencies"){for(var a=0;a<b.childNodes.length;a++){if(b.childNodes[a].nodeName=="pluginResources"){this.addDependency(b.childNodes[a].getAttribute("pluginName"))}}}else{if(b.nodeName=="clientForm"){this.addGuiForm(b.getAttribute("id"),b.firstChild.nodeValue)}}}},loadAutoLoadResources:function(a){var b=XPathSelectNodes(a,'//client_settings/resources/js[@autoload="true"]');if(b.length){b.each(function(d){this.loadJSResource(d.getAttribute("file"),d.getAttribute("className"))}.bind(this))}var c=XPathSelectNodes(a,"//client_settings/resources/img_library");c.each(function(d){addImageLibrary(d.getAttribute("alias"),d.getAttribute("path"))}.bind(this))}});Class.create("RemoteNodeProvider",{__implements:"IAjxpNodeProvider",initialize:function(){},initProvider:function(a){this.properties=a},loadNode:function(d,a,b){var c=new Connexion();c.addParameter("get_action","ls");c.addParameter("options","al");var e=d.getPath();if(d.getMetadata().get("paginationData")){e+="%23"+d.getMetadata().get("paginationData").get("current")}c.addParameter("dir",e);if(this.properties){$H(this.properties).each(function(f){c.addParameter(f.key,f.value)})}c.onComplete=function(g){try{this.parseNodes(d,g,a,b)}catch(f){if(ajaxplorer){ajaxplorer.displayMessage("ERROR","Loading error :"+f.message)}else{alert("Loading error :"+f.message)}}}.bind(this);c.sendAsync()},parseNodes:function(g,d,l,h){if(!d.responseXML||!d.responseXML.documentElement){return}var c=d.responseXML.documentElement;var b=c.childNodes;var e=this.parseAjxpNode(c);g.replaceBy(e);var n=XPathSelectSingleNode(c,"error|message");if(n){if(n.nodeName=="message"){type=n.getAttribute("type")}if(type=="ERROR"){g.notify("error",n.firstChild.nodeValue+"(Source:"+g.getPath()+")")}}var m=XPathSelectSingleNode(c,"pagination");if(m){var a=new Hash();$A(m.attributes).each(function(o){a.set(o.nodeName,o.nodeValue)}.bind(this));g.getMetadata().set("paginationData",a)}else{if(g.getMetadata().get("paginationData")){g.getMetadata().unset("paginationData")}}var f=XPathSelectSingleNode(c,"client_configs");if(f){g.getMetadata().set("client_configs",f)}var b=XPathSelectNodes(c,"tree");b.each(function(o){var p=this.parseAjxpNode(o);g.addChild(p);if(h){h(p)}}.bind(this));if(l){l(g)}},parseAjxpNode:function(d){var e=new AjxpNode(d.getAttribute("filename"),(d.getAttribute("is_file")=="1"||d.getAttribute("is_file")=="true"),d.getAttribute("text"),d.getAttribute("icon"));var a=["filename","is_file","text","icon"];var c=new Hash();for(var b=0;b<d.attributes.length;b++){c.set(d.attributes[b].nodeName,d.attributes[b].nodeValue);if(Prototype.Browser.IE&&d.attributes[b].nodeName=="ID"){c.set("ajxp_sql_"+d.attributes[b].nodeName,d.attributes[b].nodeValue)}}e.setMetadata(c);return e}});Class.create("Repository",{id:undefined,label:"No Repository",icon:"",accessType:"",resourcesManager:undefined,allowCrossRepositoryCopy:false,initialize:function(b,a){if(MessageHash){this.label=MessageHash[391]}this.id=b;this.icon=ajxpResourcesFolder+"/images/actions/16/network-wired.png";this.resourcesManager=new ResourcesManager();if(a){this.loadFromXml(a)}},getId:function(){return this.id},getLabel:function(){return this.label},setLabel:function(a){this.label=a},getIcon:function(){return this.icon},setIcon:function(a){this.icon=a},getAccessType:function(){return this.accessType},setAccessType:function(a){this.accessType=a},loadResources:function(){this.resourcesManager.load()},loadFromXml:function(e){if(e.getAttribute("allowCrossRepositoryCopy")&&e.getAttribute("allowCrossRepositoryCopy")=="true"){this.allowCrossRepositoryCopy=true}if(e.getAttribute("access_type")){this.setAccessType(e.getAttribute("access_type"))}for(var c=0;c<e.childNodes.length;c++){var b=e.childNodes[c];if(b.nodeName=="label"){this.setLabel(b.firstChild.nodeValue)}else{if(b.nodeName=="client_settings"){this.setIcon(b.getAttribute("icon"));for(var a=0;a<b.childNodes.length;a++){var d=b.childNodes[a];if(d.nodeName=="resources"){this.resourcesManager.loadFromXmlNode(d)}}}}}}});var timerClearObserver={onEnd:function(){if(WebFXtimer){clearTimeout(WebFXtimer)}}};document.observe("ajaxplorer:loaded",function(){Draggables.addObserver(timerClearObserver);Draggables.addObserver({onDrag:function(a,b,c){if(b.updateCtrlKey){b.updateCtrlKey(c)}}})});var AllAjxpDraggables=$A([]);var AllAjxpDroppables=$A([]);Event.observe(window,"unload",function(){Draggables.removeObserver(timerClearObserver);AllAjxpDraggables.each(function(a){a.destroy()});AllAjxpDroppables.each(function(a){Droppables.remove(a)})});Class.create("AjxpDraggable",Draggable,{initialize:function($super,d,c,b,a){d=$(d);d.addClassName("ajxp_draggable");$super(d,c);this.options.reverteffect=function(g,f,e){new Effect.Move(g,{x:-e,y:-f,duration:0,queue:{scope:"_draggable",position:"end"}})};this.options.delay=200;this.component=b;this.componentType=a;AllAjxpDraggables.push(this)},destroy:function(){Event.stopObserving(this.handle,"mousedown",this.eventMouseDown);this.element.removeClassName("ajxp_draggable");this.element=null;Draggables.unregister(this)},initDrag:function(a){if(!Object.isUndefined(Draggable._dragging[this.element])&&Draggable._dragging[this.element]){return}if(Event.isLeftClick(a)){var c=Event.element(a);if((tag_name=c.tagName.toUpperCase())&&(tag_name=="INPUT"||tag_name=="SELECT"||tag_name=="OPTION"||tag_name=="BUTTON"||tag_name=="TEXTAREA")){return}var b=[Event.pointerX(a),Event.pointerY(a)];var d=Position.cumulativeOffset(this.element);this.offset=[0,1].map(function(e){return Math.min(15,(b[e]-d[e]))});Draggables.activate(this);Event.stop(a)}},startDrag:function(a){if(!this.delta){this.delta=this.currentDelta()}this.dragging=true;this._draggingMultiple=false;if(this.options.zindex){this.originalZ=parseInt(Element.getStyle(this.element,"z-index")||0);this.element.setStyle({zIndex:this.options.zindex})}if(this.options.ghosting){var g=ajaxplorer.getUserSelection();if(g.isEmpty()&&this.component.findSelectableParent){this.component.findSelectableParent(this.element,true)}var b=g.getSelectedNodes();this._draggingMultiple=true;this._clone=new Element("div");$(this._clone).addClassName("ajxp_draggable");$(this._clone).addClassName("multiple_selection_draggable");this._clone.setAttribute("user_selection","true");$("ajxp_desktop").insert(this._clone);this.original=this.element;this.element=this._clone;var f=Math.min(b.length,5);var h=0;for(var d=0;d<f;d++){var l=b[d].getLabel()+(d<f-1?",<br>":"");h=Math.max(h,testStringWidth(l));this._clone.insert(l)}if(f<b.length){this._clone.insert(",<br> "+(b.length-f)+" "+MessageHash[334]+"...")}this.element.setStyle({height:"auto",width:h+"px"});Position.absolutize(this._clone);var e=10000;if(this.element.getStyle("zIndex")){e=this.element.getStyle("zIndex")+100}this.element.setStyle({zIndex:e})}if(this.options.scroll){if(this.options.scroll==window){var c=this._getWindowScroll(this.options.scroll);this.originalScrollLeft=c.left;this.originalScrollTop=c.top}else{this.originalScrollLeft=this.options.scroll.scrollLeft;this.originalScrollTop=this.options.scroll.scrollTop}}Draggables.notify("onStart",this,a);if(this.options.starteffect){this.options.starteffect(this.element)}this.dndAction=ajaxplorer.getActionBar().getDefaultAction("dragndrop");this.ctrlDndAction=ajaxplorer.getActionBar().getDefaultAction("ctrldragndrop")},finishDrag:function(c,g){this.dragging=false;if(this.options.quiet){Position.prepare();var f=[Event.pointerX(c),Event.pointerY(c)];Droppables.show(f,this.element)}var h=false;if(g){h=Droppables.fire(c,this.element);if(!h){h=false}}if(h&&this.options.onDropped){this.options.onDropped(this.element)}Draggables.notify("onEnd",this,c);var b=this.options.revert;if(b&&typeof b=="function"){b=b(this.element)}var e=this.currentDelta();if(b&&this.options.reverteffect){if(h==0||b!="failure"){if(!this._draggingMultiple){this.options.reverteffect(this.element,e[1]-this.delta[1],e[0]-this.delta[0])}}}else{this.delta=e}if(this.options.zindex){this.element.setStyle({zIndex:this.originalZ})}if(this.options.endeffect){this.options.endeffect(this.element)}if(this._draggingMultiple){var a=this.element;this.element=this.original;Element.remove(a)}Draggables.deactivate(this);Droppables.reset()},updateCtrlKey:function(a){if(!a){return}var b=a.ctrlKey;if(this.ctrlDndAction&&(b||(this.dndAction.deny))){this.addCopyClass()}else{this.removeCopyClass()}},addCopyClass:function(){$(this.element).addClassName("selection_ctrl_key")},removeCopyClass:function(){$(this.element).removeClassName("selection_ctrl_key")}});var AjxpDroppables={options:{hoverclass:"droppableZone",accept:"ajxp_draggable",onDrop:function(a,e,d){if(!(a.ajxpNode||a.getAttribute("user_selection"))||!e.ajxpNode){return}var c=e.ajxpNode.getPath();var b;if(a.ajxpNode){var b=a.ajxpNode.getPath()}if(WebFXtimer){clearTimeout(WebFXtimer)}var f=null;if(e.id&&webFXTreeHandler.all[e.id]){f=e.id}ajaxplorer.actionBar.applyDragMove(b,c,f,d.ctrlKey)},onHover:function(b,d,c){if(WebFXtimer){clearTimeout(WebFXtimer)}if(d.id&&webFXTreeHandler.all[d.id]){var a="javascript:";WebFXtimer=window.setTimeout(function(){var e=webFXTreeHandler.all[d.id];if(e&&e.folder&&!e.open){e.expand()}},500)}},onOut:function(a){if(WebFXtimer){clearTimeout(WebFXtimer)}}},add:function(a){Droppables.add(a,this.options);AllAjxpDroppables.push($(a))}};Class.create("AjxpSortable",SortableTable,{initialize:function($super,c,b,a){$super(c,b,a);this.addSortType("NumberK",this.replace8a8);this.addSortType("NumberKo",this.replace8oa8);this.addSortType("MyDate",null,false,this.sortTimes);this.addSortType("CellSorterValue",null,false,this.cellSorterValue);this.addSortType("StringDirFile",this.toUpperCase,false,this.splitDirsAndFiles.bind(this))},setPaginationBehaviour:function(a,b,c,f){this.paginationLoaderFunc=a;this.columnsDefs=b;var e=-1;for(var d=0;d<b.length;d++){if(b[d]["field_name"]==c){e=d;break}}this.sortColumn=e;this.descending=(f=="desc");this.updateHeaderArrows()},headerOnclick:function(d){var c=Event.findElement(d,"div.header_cell");var b=c.cellIndex;if(this.paginationLoaderFunc){var f=$H({});if(this.sortColumn!=b){this.descending=this.defaultDescending}else{this.descending=!this.descending}var a=this.columnsDefs[b];f.set("order_column",a.field_name||b);f.set("order_direction",(this.descending?"desc":"asc"));this.paginationLoaderFunc(f)}else{this.sort(b)}},replace8a8:function(d){d=d.toUpperCase();var c="____";var a=d.replace(/(([0-9]*\.)?[0-9]+([eE][-+]?[0-9]+)?)(.*)/,"$1"+c+"$4").split(c);var b=Number(a[0]).valueOf();if(a[1]){var e=a[1].replace(/\s*([KMGB])\s*/,"$1");if(e=="K"){b*=1024}else{if(e=="M"){b*=1024*1024}else{if(e=="G"){b*=1024*1024*1024}else{if(e=="T"){b*=1024*1024*1024*1024}}}}}return b},replace8oa8:function(d){d=d.toUpperCase();if(d=="-"){return 0}var c="____";var a=d.replace(/(([0-9]*\.)?[0-9]+([eE][-+]?[0-9]+)?)(.*)/,"$1"+c+"$4").split(c);var b=Number(a[0]).valueOf();if(a[1]){var e=a[1].replace(/\s*(KO|MO|GO|T|KB|MB|GB)\s*/,"$1");if(e=="KO"||e=="KB"){b*=1024}else{if(e=="MO"||e=="MB"){b*=1024*1024}else{if(e=="GO"||e=="GB"){b*=1024*1024*1024}else{if(e=="T"){b*=1024*1024*1024*1024}}}}}return b},replaceDate:function(c){var a=c.split(" ");var e=a[0].split("/");var f=new Date(0);f.setFullYear(e[2]);f.setDate(e[0]);f.setMonth(e[1]-1);var b=a[1].split(":");f.setHours(b[0]);f.setMinutes(b[1]);return f.getTime()},splitDirsAndFiles:function(a,d){var b;var e=a.cells[d];if(typeof e.innerText!="undefined"){b=e.innerText}else{b=this.getInnerText(e)}if(b[0]==" "){b=b.substr(1,(b.length-1))}if(a.getAttribute("is_file")=="0"||a.getAttribute("is_file")=="false"){b="000"+b}return b.toUpperCase()},cellSorterValue:function(a,c){var b=a.select("td");if(b[c]&&b[c].readAttribute("sorter_value")){return b[c].readAttribute("sorter_value")}},sortTimes:function(a,b){if(a.ajxp_modiftime){return a.ajxp_modiftime}}});Class.create("AjxpTabulator",AjxpPane,{initialize:function($super,e,d){$super(e);this.tabulatorData=d.tabInfos;var b=new Element("table",{cellpadding:0,cellspacing:0,border:0,width:"100%",style:"height:24px;"});$(this.htmlElement).insert({top:b});var a=new Element("tBody");var c=new Element("tr");b.update(a);a.update(c);this.tabulatorData.each(function(f){var g=new Element("td").addClassName("toggleHeader");g.addClassName("panelHeader");g.update('<img width="16" height="16" align="absmiddle" src="'+resolveImageSource(f.icon,"/images/actions/ICON_SIZE",16)+'"><span ajxp_message_id="'+f.label+'">'+MessageHash[f.label]+"</a>");g.observe("click",function(){this.switchTabulator(f.id)}.bind(this));c.insert(g);f.headerElement=g;disableTextSelection(g);this.selectedTabInfo=f}.bind(this));if(d.defaultTabId){this.switchTabulator(d.defaultTabId)}},switchTabulator:function(b){var a;this.tabulatorData.each(function(c){var d=this.getAndSetAjxpObject(c);if(c.id==b){c.headerElement.removeClassName("toggleInactive");c.headerElement.select("img")[0].show();if(d){a=d}this.selectedTabInfo=c}else{c.headerElement.addClassName("toggleInactive");c.headerElement.select("img")[0].hide();if(d){d.showElement(false)}}}.bind(this));if(a){a.showElement(true);a.resize()}},resize:function(){if(!this.selectedTabInfo){return}var a=this.getAndSetAjxpObject(this.selectedTabInfo);if(a){a.resize()}},getAndSetAjxpObject:function(a){var b=a.ajxpObject||null;if($(a.element).ajxpPaneObject&&(!b||b!=$(a.element).ajxpPaneObject)){b=a.ajxpObject=$(a.element).ajxpPaneObject}return b}});Class.create("RepositorySelect",{__implements:"IAjxpWidget",_defaultString:"No Repository",_defaultIcon:"network-wired.png",initialize:function(a){this.element=a;this.element.ajxpPaneObject=this;this.show=true;this.createGui();document.observe("ajaxplorer:repository_list_refreshed",function(b){this.refreshRepositoriesMenu(b.memo.list,b.memo.active)}.bind(this))},createGui:function(){if(MessageHash){this._defaultString=MessageHash[391]}this.icon=new Element("img",{id:"repo_icon",src:resolveImageSource(this._defaultIcon,"/images/actions/ICON_SIZE",16),width:16,height:16,align:"absmiddle"});this.label=new Element("input",{type:"text",name:"repo_path",value:this._defaultString,id:"repo_path"});this.currentRepositoryLabel=new Element("div",{id:"repository_form"});this.currentRepositoryLabel.insert(this.icon);this.currentRepositoryLabel.insert(this.label);this.element.insert(this.currentRepositoryLabel);this.button=simpleButton("repository_goto","inlineBarButton",200,200,ajxpResourcesFolder+"/images/arrow_down.png",16,"inline_hover",null,true);this.button.setStyle({marginRight:"7px"});this.button.select("img")[0].setStyle({height:6,width:10,marginLeft:1,marginRight:1,marginTop:8});this.element.insert(this.button)},refreshRepositoriesMenu:function(a,e){this.button.addClassName("disabled");var d=$A([]);var b=$A([]);if(a&&a.size()){a.each(function(m){var f=m.value;var g=m.key;var l=(g==e?true:false);var h={name:f.getLabel(),alt:f.getLabel(),image:f.getIcon(),className:"edit",disabled:l,callback:function(n){this.onRepoSelect(""+g)}.bind(this)};if(f.getAccessType()=="ajxp_shared"||f.getAccessType()=="ajxp_conf"){b.push(h)}else{d.push(h)}if(g==e){this.label.setValue(f.getLabel());this.icon.src=f.getIcon()}}.bind(this))}else{this.label.setValue(this._defaultString);this.icon.src=resolveImageSource(this._defaultIcon,"/images/actions/ICON_SIZE",16)}var c=function(h,g){var f=h.name.toLowerCase();var l=g.name.toLowerCase();return((f<l)?-1:((f>l)?1:0))};d.sort(c);if(b.length){b.sort(c);d.push({separator:true});d=d.concat(b)}if(this.repoMenu){this.repoMenu.options.menuItems=d;this.repoMenu.refreshList()}else{this.repoMenu=new Proto.Menu({className:"menu rootDirChooser",mouseClick:"left",anchor:this.button,createAnchor:false,anchorContainer:$("dir_chooser"),anchorSrc:ajxpResourcesFolder+"/images/arrow_down.png",anchorTitle:MessageHash[200],topOffset:2,leftOffset:-127,menuTitle:MessageHash[200],menuItems:d,fade:true,zIndex:1500});this.notify("createMenu")}if(d.length){this.button.removeClassName("disabled")}},onRepoSelect:function(a){ajaxplorer.triggerRepositoryChange(a)},resize:function(){var a=this.element.getOffsetParent();if(a.getWidth()<this.currentRepositoryLabel.getWidth()*3.5){this.showElement(false)}else{this.showElement(true)}},showElement:function(a){this.show=a;if(a){this.currentRepositoryLabel.show();if(this.repoMenu){this.repoMenu.options.leftOffset=-127}}else{this.currentRepositoryLabel.hide();if(this.repoMenu){this.repoMenu.options.leftOffset=0}}if(!this.repoMenu){this.observeOnce("createMenu",function(){this.showElement(this.show)}.bind(this))}},getActualWidth:function(){if(this.currentRepositoryLabel.visible()){return this.element.getWidth()}else{return this.button.getWidth()+10}}});Class.create("LocationBar",{__implements:["IAjxpWidget","IFocusable"],_defaultGotoIcon:"media-playback-start.png",_reloadGotoIcon:"reload.png",_modified:false,_beforeModified:"",initialize:function(b,a){this.element=b;this.element.ajxpPaneObject=this;this.realPath="/";this.createGui();this.options=a||{};document.observe("ajaxplorer:user_logged",this.resize.bind(this))},createGui:function(){this.parentButton=simpleButton("goto_parent","inlineBarButtonRight",24,24,"goto_parent.png",16,"inline_hover",function(){ajaxplorer.actionBar.fireAction("up_dir")});this.element.insert(this.parentButton);var a=new Element("div",{id:"location_form"});this.initCurrentPath();this.element.insert(a);a.insert(this.currentPath);var b=this.currentPath.getDimensions();this.currentPath.hide();this.label=new Element("div").update("/test");this.label.setStyle({marginTop:1,fontSize:"11px",height:(Prototype.Browser.IE?"18px":"15px"),fontFamily:"Trebuchet MS,sans-serif,Nimbus Sans L",zIndex:10000,backgroundColor:"white",whiteSpace:"nowrap",overflow:"hidden"});a.insert(this.label);this.label.observe("click",function(){this.label.hide();this.currentPath.show();this.currentPath.focus()}.bind(this));this.gotoButton=simpleButton("location_goto","inlineBarButton",104,104,this._reloadGotoIcon,16,"inline_hover",this.submitPath.bind(this));this.element.insert(this.gotoButton);this.bmButton=simpleButton("bookmarks_goto","inlineBarButtonLeft",145,145,"bookmark_menu.png",16,"inline_hover");this.element.insert(this.bmButton);this.initBookmarksBar()},initCurrentPath:function(){this.currentPath=new Element("input",{id:"current_path",type:"text",value:"/"});var a={afterUpdateElement:function(c,b){if(this.currentPath.value!=this.realPath){this.setModified(true);this.submitPath()}}.bind(this)};this.autoComp=new AjxpAutocompleter(this.currentPath,"autocomplete_choices",null,a);this.currentPath.observe("keydown",function(b){if(b.keyCode==9){return false}if(!this._modified&&(this._beforeModified!=this.currentPath.getValue())){this.setModified(true)}if(b.keyCode==13){if(this.autoComp.active){return}this.submitPath();Event.stop(b)}}.bind(this));this.currentPath.observe("focus",function(b){ajaxplorer.disableShortcuts();this.hasFocus=true;this.currentPath.select();return false}.bind(this));this.currentPath.observe("blur",function(b){this.currentPath.hide();this.label.show();if(!currentLightBox){ajaxplorer.enableShortcuts();this.hasFocus=false}}.bind(this));document.observe("ajaxplorer:context_changed",function(b){window.setTimeout(function(){this.updateLocationBar(b.memo)}.bind(this),0)}.bind(this))},initBookmarksBar:function(){this.bookmarkBar=new BookmarksBar(this.bmButton)},submitPath:function(){if(!this._modified){ajaxplorer.actionBar.fireAction("refresh")}else{var a=this.currentPath.value.stripScripts();if(a==""){return false}var b=new AjxpNode(a,false);var d=a.split("##");if(d.length==2){var c=new Hash();c.set("new_page",d[1]);a=d[0];b=new AjxpNode(a);b.getMetadata().set("paginationData",c)}if(!ajaxplorer.pathExists(a)){modal.displayMessage("ERROR","Cannot find : "+a);this.currentPath.setValue(this._beforeModified)}else{ajaxplorer.actionBar.fireDefaultAction("dir",b)}}return false},updateLocationBar:function(a){if(Object.isString(a)){a=new AjxpNode(a)}var b=a.getPath();if(a.getMetadata().get("paginationData")){b+="##"+a.getMetadata().get("paginationData").get("current")}this.realPath=b;this.currentLabel=this.realPath;if(getBaseName(b)!=a.getLabel()){this.currentLabel=getRepName(b)+"/"+a.getLabel()}this.label.update(this.currentLabel);this.currentPath.value=this.realPath;this.setModified(false)},setModified:function(a){this._modified=a;this.gotoButton.setSrc(resolveImageSource((a?this._defaultGotoIcon:this._reloadGotoIcon),"/images/actions/ICON_SIZE",16));this._beforeModified=this.currentPath.getValue()},resize:function(){if(this.options.flexTo){var a=$(this.options.flexTo).getWidth();var c=0;this.element.siblings().each(function(d){if(d.ajxpPaneObject&&d.ajxpPaneObject.getActualWidth){c+=d.ajxpPaneObject.getActualWidth()}else{c+=d.getWidth()}});if(!this.buttonsWidth){this.buttonsWidth=this.gotoButton.getWidth()+this.parentButton.getWidth()+this.bmButton.getWidth()+20}var b=Math.min((a-c-this.buttonsWidth),320);if(b<5){this.element.hide()}else{this.element.show();this.currentPath.setStyle({width:b+"px"});this.label.setStyle({width:b+"px"})}}},showElement:function(a){},setFocusBehaviour:function(){},focus:function(){this.label.hide();this.currentPath.show();this.currentPath.focus();this.hasFocus=true},blur:function(){this.currentPath.blur();this.currentPath.hide();this.label.show();this.hasFocus=false}});Class.create("UserWidget",{__implements:["IAjxpWidget"],initialize:function(a){this.element=a;this.element.ajxpPaneObject=this;this.element.observe("mouseover",function(){this.element.select("div").invoke("setStyle",{borderColor:"#bbbbbb"})}.bind(this));this.element.observe("mouseout",function(){var b=this.element.select("div");if(!b.length){return}if(b[0].hasClassName("inline_hover_light")){return}b.invoke("setStyle",{borderColor:"#dddddd"})}.bind(this));document.observe("ajaxplorer:user_logged",this.updateGui.bind(this));document.observe("ajaxplorer:actions_loaded",this.updateActions.bind(this));if(Prototype.Browser.IE){document.observe("ajaxplorer:actions_refreshed",this.updateActions.bind(this))}},updateGui:function(){var a="";var b=ajaxplorer.user;this.element.update(a)},updateActions:function(){var a=$A();var b=ajaxplorer.actionBar.getActionsForAjxpWidget("UserWidget",this.element.id).each(function(c){a.push({name:c.getKeyedText(),alt:c.options.title,image:resolveImageSource(c.options.src,"/images/actions/ICON_SIZE",16),callback:function(d){this.apply()}.bind(c)})});if(this.menu){this.menu.options.menuItems=a;this.menu.refreshList()}else{this.menu=new Proto.Menu({className:"menu rootDirChooser rightAlignMenu",mouseClick:"left",position:"bottom right",anchor:this.element,createAnchor:false,topOffset:2,leftOffset:-5,menuTitle:MessageHash[200],menuItems:a,fade:true,zIndex:1500,beforeShow:function(c){this.element.select("div").invoke("addClassName","inline_hover_light");this.element.select("div").invoke("setStyle",{borderColor:"#bbbbbb"})}.bind(this),beforeHide:function(c){this.element.select("div").invoke("removeClassName","inline_hover_light");this.element.select("div").invoke("setStyle",{borderColor:"#dddddd"})}.bind(this),beforeSelect:function(c){this.element.select("div").invoke("removeClassName","inline_hover_light");this.element.select("div").invoke("setStyle",{borderColor:"#dddddd"})}.bind(this)});this.notify("createMenu")}},resize:function(){},showElement:function(a){this.element.select(".user_widget_label").invoke((a?"show":"hide"))}});Class.create("AjxpAutocompleter",Autocompleter.Base,{initialize:function(c,d,b,a){if(Object.isString(d)&&!$(d)){document.getElementsByTagName("body")[0].appendChild(new Element("div",{id:d,className:"autocomplete",style:"position:absolute; display:none;"}))}this.baseInitialize(c,d,a);this.options.asynchronous=true;this.options.onComplete=this.onComplete.bind(this);this.options.defaultParams=this.options.parameters||null;this.url=ajxpServerAccessPath+"&get_action=ls&options=dz";this.options.paramName="dir";this.options.minChars=1},getUpdatedChoices:function(){this.startIndicator();var b=this.getToken();var a=encodeURIComponent(this.options.paramName)+"="+encodeURIComponent(b.substring(0,b.lastIndexOf("/")+1));this.options.parameters=this.options.callback?this.options.callback(this.element,a):a;if(this.options.defaultParams){this.options.parameters+="&"+this.options.defaultParams}new Ajax.Request(this.url,this.options)},onComplete:function(e){var g=e.responseXML;var c=this.getToken();var b=new Array();if(g==null||g.documentElement==null){this.updateChoices("");return}var o=g.documentElement;var h=o.childNodes;var d=h.length;for(var f=0;f<d;f++){if(h[f].tagName=="tree"){var p=getBaseName(h[f].getAttribute("filename"));var n=(c.lastIndexOf("/")<c.length-1);if(!n){b[b.length]=p}else{var a=c.substring(c.lastIndexOf("/")+1,c.length);if(p.indexOf(a)==0){b[b.length]=p}}}}if(!b.length){this.updateChoices("");return}var m="<ul>";b.each(function(l){value=c.substring(0,c.lastIndexOf("/")+1);m+="<li>"+value+l+"</li>"});m+="</ul>";this.updateChoices(m)}});Class.create("TreeSelector",{initialize:function(b,a){this.htmlElement=b;this.options=Object.extend({filterSelectorId:'select[id="external_repository"]',targetField:'input[name="dest"]',targetNode:'input[name="dest_node"]',treeContainer:".treeCopyContainer"},a||{})},load:function(a){if(webFXTreeHandler&&webFXTreeHandler.selected){this.__initialWebFXSelection=webFXTreeHandler.selected}this.filterSelector=this.htmlElement.select(this.options.filterSelectorId)[0];var c=this.targetField=this.htmlElement.select(this.options.targetField)[0];var b=this.targetNode=this.htmlElement.select(this.options.targetNode)[0];this.treeContainer=this.htmlElement.select(this.options.treeContainer)[0];this.filterSelector.hide();this._nodeActionCallback=function(d){c.value=this.ajxpNode.getPath();b.value=this.ajxpNode.getPath();this.select()};this._nodeFilter=function(d){return(!d.isLeaf())};if(!a){a=new AjxpNode("/",false,MessageHash[373],"folder.png")}this.treeCopy=new AJXPTree(a,this._nodeActionCallback,this._nodeFilter);this.treeContainer.update(this.treeCopy.toString());$(this.treeCopy.id).observe("click",function(d){this.action();Event.stop(d)}.bind(this.treeCopy));this.treeCopy.focus();this.treeCopy.setAjxpRootNode(a)},unload:function(){if(this.__initialWebFXSelection){this.__initialWebFXSelection.select()}this.treeCopy.remove()},getSelectedNode:function(){return this.targetNode.getValue()},getSelectedLabel:function(){return this.target.getValue()},setFilterShow:function(a){if(a){this.filterSelector.show()}else{this.filterSelector.hide()}},getFilterActive:function(a){if(!this.filterSelector.visible()){return false}if(a&&this.filterSelector.getValue()==a){return false}return true},appendFilterValue:function(b,d,a){var c=new Element("option",{value:b}).update(d);var e;if(a=="top"){e={top:c}}else{e=c}this.filterSelector.insert(e)},setFilterSelectedIndex:function(a){this.filterSelector.selectedIndex=a},setFilterChangeCallback:function(a){this.filterSelector.observe("change",a.bind(this))},resetAjxpRootNode:function(a){this.treeCopy.ajxpNode.clear();this.treeCopy.setAjxpRootNode(a);this.treeCopy.ajxpNode.load()}});Class.create("SliderInput",{initialize:function(c,a){this.input=$(c);this.options=Object.extend({format:"",axis:"vertical",onChange:Prototype.emptyFunction,onSlide:Prototype.emptyFunction,topOffset:2,leftOffset:3,range:$R(0,1),alignY:6},a||{});var b=this.options.onSlide;this.options.onSlide=function(d){this.input.value=d;b(d);this.delay()}.bind(this);if(this.options.sliderValue){this.input.value=this.options.sliderValue}this.buildGui()},buildGui:function(){this.holder=new Element("div",{className:"slider-pane"});this.trackerTop=new Element("div",{className:"slider-tracker-top",style:"width:10px;height:2px;font-size:1px;"}).update("");this.tracker=new Element("div",{className:"slider-tracker",style:"width:10px;height:90px;"});this.cursor=new Element("div",{className:"slider-handle"});this.holder.insert(this.trackerTop);this.holder.insert(this.tracker);this.tracker.insert(this.cursor);this.holder.hide();$$("body")[0].insert(this.holder);this.slider=new Control.Slider(this.cursor,this.tracker,this.options);if(this.input.getAttribute("type")&&this.input.getAttribute("type")=="image"){this.input.observe("click",this.show.bind(this))}else{this.input.observe("focus",this.show.bind(this))}document.observe("click",function(b){var a=Event.findElement(b);if(!a.descendantOf(this.holder)&&a!=this.input){this.hide()}}.bind(this))},setValue:function(a){if(this.slider){this.slider.setValue(a)}if(this.input){this.input.value=a}},show:function(){var a=this.computeAnchorPosition(this.input);this.holder.setStyle(a);this.slider.setValue(parseFloat(this.input.value));this.holder.show();this.delay()},hide:function(){this.holder.hide();if(this.timer){window.clearTimeout(this.timer)}try{this.input.blur()}catch(a){}},delay:function(){if(this.timer){window.clearTimeout(this.timer)}this.timer=window.setTimeout(this.hide.bind(this),3000)},computeAnchorPosition:function(b){var e=Position.cumulativeOffset($(b));var d=b.cumulativeScrollOffset();var a=e[1]+b.getHeight()+this.options.topOffset-d[1];var c=e[0]+this.options.leftOffset-d[0];return{top:a,left:c}}});Class.create("Action",{__DEFAULT_ICON_PATH:"/images/actions/ICON_SIZE",initialize:function(){this.options=Object.extend({name:"",src:"",text:"",title:"",text_id:"",title_id:"",hasAccessKey:false,accessKey:"",subMenu:false,subMenuUpdateImage:false,subMenuUpdateTitle:false,callbackCode:"",callbackDialogNode:null,callback:Prototype.emptyFunction,prepareModal:false,listeners:[],formId:undefined,formCode:undefined},arguments[0]||{});this.context=Object.extend({selection:true,dir:false,allowedMimes:$A([]),root:true,inZip:true,recycle:false,behaviour:"hidden",actionBar:false,actionBarGroup:"default",contextMenu:false,ajxpWidgets:null,infoPanel:false},arguments[1]||{});this.selectionContext=Object.extend({dir:false,file:true,recycle:false,behaviour:"disabled",allowedMimes:$A([]),unique:true,multipleOnly:false},arguments[2]||{});this.rightsContext=Object.extend({noUser:true,userLogged:true,guestLogged:false,read:true,write:false,adminOnly:false},arguments[3]||{});this.subMenuItems=Object.extend({staticItems:null,dynamicItems:null,dynamicBuilderCode:null},arguments[4]||{});this.elements=new Array();this.contextHidden=false;this.deny=false;if(this.context.subMenu){if(!this.options.actionBar){alert("Warning, wrong action definition. Cannot use a subMenu if not displayed in the actionBar!")}}},setManager:function(a){this.manager=a;if(this.options.subMenu){if(this.subMenuItems.staticItems){this.buildSubmenuStaticItems()}if(this.subMenuItems.dynamicItems||this.subMenuItems.dynamicBuilderCode){this.prepareSubmenuDynamicBuilder()}}if(this.options.listeners.init){try{window.listenerContext=this;if(Object.isString(this.options.listeners.init)){this.options.listeners.init.evalScripts()}else{this.options.listeners.init()}}catch(b){alert(b)}}},apply:function(){if(this.deny){return}if(this.options.prepareModal){modal.prepareHeader(this.options.title,resolveImageSource(this.options.src,this.__DEFAULT_ICON_PATH,16))}window.actionArguments=$A([]);if(arguments[0]){window.actionArguments=$A(arguments[0])}if(this.options.callbackCode){try{this.options.callbackCode.evalScripts()}catch(h){ajaxplorer.displayMessage("ERROR",h.message)}}else{if(this.options.callbackDialogNode){var d=this.options.callbackDialogNode;var l=d.getAttribute("dialogOpenForm");var c=(d.getAttribute("dialogOkButtonOnly")==="true")?true:false;var g=(d.getAttribute("dialogSkipButtons")==="true")?true:false;var n=null;var p=null;var b=null;var m=XPathSelectSingleNode(d,"dialogOnOpen");if(m&&m.firstChild){var n=new Function("oForm",m.firstChild.nodeValue)}var o=XPathSelectSingleNode(d,"dialogOnComplete");if(o&&o.firstChild){var f=o.firstChild.nodeValue;if(o.getAttribute("hideDialog")==="true"){f+="hideLightBox(true);"}var p=new Function("oForm",f)}var a=XPathSelectSingleNode(d,"dialogOnCancel");if(a&&a.firstChild){var b=new Function("oForm",o.firstChild.nodeValue)}this.options.callback=function(){modal.showDialogForm("Dialog",l,n,p,b,c,g)};this.options.callback();this.options.callbackDialogNode=null}else{if(this.options.callback){this.options.callback()}}}if(this.options.subMenu&&arguments[0]&&arguments[0][0]){this.notify("submenu_active",arguments[0][0])}window.actionArguments=null},fireContextChange:function(){if(arguments.length<4){return}var b=arguments[0];var d=arguments[1];var c=arguments[2];var e=arguments[3];var g=arguments[4];var a=arguments[5]||"";if(this.options.listeners.contextChange){window.listenerContext=this;this.options.listeners.contextChange.evalScripts()}var f=this.rightsContext;if(!f.noUser&&!b){return this.hideForContext()}if((f.userLogged=="only"&&d==null)||(f.guestLogged&&f.guestLogged=="hidden"&d!=null&&d.id=="guest")){return this.hideForContext()}if(f.userLogged=="hidden"&&d!=null&&!(d.id=="guest"&&f.guestLogged&&f.guestLogged=="show")){return this.hideForContext()}if(f.adminOnly&&(d==null||!d.isAdmin)){return this.hideForContext()}if(f.read&&d!=null&&!d.canRead()){return this.hideForContext()}if(f.write&&d!=null&&!d.canWrite()){return this.hideForContext()}if(this.context.allowedMimes.length){if(!this.context.allowedMimes.indexOf(a)==-1){return this.hideForContext()}}if(this.context.recycle){if(this.context.recycle=="only"&&!c){return this.hideForContext()}if(this.context.recycle=="hidden"&&c){return this.hideForContext()}}if(!this.context.inZip&&e){return this.hideForContext()}if(!this.context.root&&g){return this.hideForContext()}this.showForContext()},fireSelectionChange:function(){if(this.options.listeners.selectionChange){window.listenerContext=this;this.options.listeners.selectionChange.evalScripts()}if(arguments.length<1||this.contextHidden||!this.context.selection){return}var c=arguments[0];var f=false;if(c!=null){f=!c.isEmpty();var g=c.isUnique();var e=c.hasFile();var d=c.hasDir();var a=c.isRecycle()}var b=this.selectionContext;if(b.allowedMimes.size()){if(b.behaviour=="hidden"){this.hide()}else{this.disable()}}if(b.unique&&!g){return this.disable()}if((b.file||b.dir)&&!e&&!d){return this.disable()}if((b.dir&&!b.file&&e)||(!b.dir&&b.file&&d)){return this.disable()}if(!b.recycle&&a){return this.disable()}if((b.allowedMimes.size()&&c&&!c.hasMime(b.allowedMimes))&&!(b.dir&&d)){if(b.behaviour=="hidden"){return this.hide()}else{return this.disable()}}this.show();this.enable()},createFromXML:function(l){this.options.name=l.getAttribute("name");for(var e=0;e<l.childNodes.length;e++){var b=l.childNodes[e];var g=$H({dir:"dirDefault",file:"fileDefault",dragndrop:"dragndropDefault",ctrldragndrop:"ctrlDragndropDefault",expire:"expireDefault"});g.each(function(n){if(l.getAttribute(n.value)&&l.getAttribute(n.value)=="true"){if(!this.defaults){this.defaults={}}this.defaults[n.key]=true}}.bind(this));if(b.nodeName=="processing"){for(var d=0;d<b.childNodes.length;d++){var f=b.childNodes[d];if(f.nodeName=="clientForm"){this.options.formId=f.getAttribute("id");this.options.formCode=f.firstChild.nodeValue;this.insertForm()}else{if(f.nodeName=="clientCallback"){if(f.getAttribute("prepareModal")&&f.getAttribute("prepareModal")=="true"){this.options.prepareModal=true}if(f.getAttribute("dialogOpenForm")){this.options.callbackDialogNode=f}else{if(f.firstChild){this.options.callbackCode="<script>"+f.firstChild.nodeValue+"<\/script>"}}}else{if(f.nodeName=="clientListener"&&f.firstChild){this.options.listeners[f.getAttribute("name")]="<script>"+f.firstChild.nodeValue+"<\/script>"}}}}}else{if(b.nodeName=="gui"){this.options.text_id=b.getAttribute("text");this.options.title_id=b.getAttribute("title");this.options.text=MessageHash[b.getAttribute("text")];this.options.title=MessageHash[b.getAttribute("title")];this.options.src=b.getAttribute("src");if(b.getAttribute("hasAccessKey")&&b.getAttribute("hasAccessKey")=="true"){this.options.accessKey=b.getAttribute("accessKey");this.options.hasAccessKey=true}for(var d=0;d<b.childNodes.length;d++){if(b.childNodes[d].nodeName=="context"){this.attributesToObject(this.context,b.childNodes[d]);if(this.context.ajxpWidgets){this.context.ajxpWidgets=$A(this.context.ajxpWidgets.split(","))}else{this.context.ajxpWidgets=$A()}if(this.context.infoPanel){this.context.ajxpWidgets.push("InfoPanel")}if(this.context.actionBar){this.context.ajxpWidgets.push("ActionsToolbar")}}else{if(b.childNodes[d].nodeName=="selectionContext"){this.attributesToObject(this.selectionContext,b.childNodes[d])}}}}else{if(b.nodeName=="rightsContext"){this.attributesToObject(this.rightsContext,b)}else{if(b.nodeName=="subMenu"){this.options.subMenu=true;if(b.getAttribute("updateImageOnSelect")&&b.getAttribute("updateImageOnSelect")=="true"){this.options.subMenuUpdateImage=true}if(b.getAttribute("updateTitleOnSelect")&&b.getAttribute("updateTitleOnSelect")=="true"){this.options.subMenuUpdateTitle=true}for(var d=0;d<b.childNodes.length;d++){if(b.childNodes[d].nodeName=="staticItems"||b.childNodes[d].nodeName=="dynamicItems"){this.subMenuItems[b.childNodes[d].nodeName]=[];for(var c=0;c<b.childNodes[d].childNodes.length;c++){if(b.childNodes[d].childNodes[c].nodeName=="item"){var m={};for(var h=0;h<b.childNodes[d].childNodes[c].attributes.length;h++){var a=b.childNodes[d].childNodes[c].attributes[h];m[a.nodeName]=a.nodeValue}this.subMenuItems[b.childNodes[d].nodeName].push(m)}}}else{if(b.childNodes[d].nodeName=="dynamicBuilder"){this.subMenuItems.dynamicBuilderCode="<script>"+b.childNodes[d].firstChild.nodeValue+"<\/script>"}}}}}}}}if(!this.options.hasAccessKey){return}if(this.options.accessKey==""||!MessageHash[this.options.accessKey]||this.options.text.indexOf(MessageHash[this.options.accessKey])==-1){this.options.accessKey==this.options.text.charAt(0)}else{this.options.accessKey=MessageHash[this.options.accessKey]}},buildSubmenuStaticItems:function(){var a=[];if(this.subMenuItems.staticItems){this.subMenuItems.staticItems.each(function(c){var b=MessageHash[c.text];if(c.hasAccessKey&&(c.hasAccessKey=="true"||c.hasAccessKey===true)&&MessageHash[c.accessKey]){b=this.getKeyedText(MessageHash[c.text],true,MessageHash[c.accessKey]);if(!this.subMenuItems.accessKeys){this.subMenuItems.accessKeys=[]}this.manager.registerKey(MessageHash[c.accessKey],this.options.name,c.command)}a.push({name:b,alt:MessageHash[c.title],image:resolveImageSource(c.src,"/images/actions/ICON_SIZE",22),isDefault:(c.isDefault?true:false),callback:function(d){this.apply([c])}.bind(this)})},this)}this.subMenuItems.staticOptions=a},prepareSubmenuDynamicBuilder:function(){this.subMenuItems.dynamicBuilder=function(a){setTimeout(function(){if(this.subMenuItems.dynamicBuilderCode){window.builderContext=this;this.subMenuItems.dynamicBuilderCode.evalScripts();var b=this.builderMenuItems||[]}else{var b=[];this.subMenuItems.dynamicItems.each(function(c){var d=this.manager.actions.get(c.actionId);if(d.deny){return}b.push({name:d.getKeyedText(),alt:d.options.title,image:resolveImageSource(d.options.src,"/images/actions/ICON_SIZE",16),callback:function(f){this.apply()}.bind(d)})},this)}a.options.menuItems=b;a.refreshList()}.bind(this),0)}.bind(this)},setIconSrc:function(a){this.options.src=a;if($(this.options.name+"_button_icon")){$(this.options.name+"_button_icon").src=resolveImageSource(this.options.src,this.__DEFAULT_ICON_PATH,22)}},setLabel:function(a,b){this.options.text=MessageHash[a];if($(this.options.name+"_button_label")){$(this.options.name+"_button_label").update(this.getKeyedText())}if(!b){return}this.options.title=MessageHash[b];if($(this.options.name+"_button_icon")){$(this.options.name+"_button_icon").title=this.options.title}},refreshFromI18NHash:function(){var b;var a;this.setLabel(this.options.text_id,this.options.title_id)},toInfoPanel:function(){return this.options},toContextMenu:function(){return this.options},hideForContext:function(){this.hide();this.contextHidden=true},showForContext:function(){this.show();this.contextHidden=false},hide:function(){this.deny=true;this.notify("hide")},show:function(){this.deny=false;this.notify("show")},disable:function(){this.deny=true;this.notify("disable")},enable:function(){this.deny=false;this.notify("enable")},remove:function(){this.elements.each(function(a){$(a).remove()}.bind(this));this.elements=new Array();if(this.options.formId&&$("all_forms").select('[id="'+this.options.formId+'"]').length){$("all_forms").select('[id="'+this.options.formId+'"]')[0].remove()}},getKeyedText:function(d,b,c){if(!d){d=this.options.text}if(!b){b=this.options.hasAccessKey}if(!c){c=this.options.accessKey}if(!b){return d}var a=d.toLowerCase().indexOf(c.toLowerCase());if(a==-1){return d+" (<u>"+c+"</u>)"}if(d.charAt(a)!=c){c=d.charAt(a)}returnString=d.substring(0,d.indexOf(c));returnString+="<u>"+c+"</u>";returnString+=d.substring(d.indexOf(c)+1,d.length);return returnString},insertForm:function(){if(!this.options.formCode||!this.options.formId){return}if($("all_forms").select('[id="'+this.options.formId+'"]').length){return}$("all_forms").insert(this.options.formCode)},attributesToObject:function(a,b){Object.keys(a).each(function(c){if(b.getAttribute(c)){value=b.getAttribute(c);if(value=="true"){value=true}else{if(value=="false"){value=false}}if(c=="allowedMimes"){if(value&&value.split(",").length){value=$A(value.split(","))}else{value=$A([])}}this[c]=value}}.bind(a))}});Class.create("ActionsManager",{initialize:function(a){this._registeredKeys=new Hash();this._actions=new Hash();this.usersEnabled=a;this.bgManager=new BackgroundManager(this);this.subMenus=[];this.actions=new Hash();this.defaultActions=new Hash();this.toolbars=new Hash();document.observe("ajaxplorer:context_changed",function(b){window.setTimeout(function(){this.fireContextChange()}.bind(this),0)}.bind(this));document.observe("ajaxplorer:selection_changed",function(b){window.setTimeout(function(){this.fireSelectionChange()}.bind(this),0)}.bind(this));document.observe("ajaxplorer:user_logged",function(b){if(b.memo&&b.memo.getPreference){this.setUser(b.memo)}else{this.setUser(null)}}.bind(this))},setUser:function(a){this.oUser=a;if(a!=null&&ajaxplorer&&a.id!="guest"&&a.getPreference("lang")!=null&&a.getPreference("lang")!=""&&a.getPreference("lang")!=ajaxplorer.currentLanguage){ajaxplorer.loadI18NMessages(a.getPreference("lang"))}},getContextActions:function(a){var b="selectionContext";if(a.id&&(a.id=="table_rows_container"||a.id=="selectable_div")){b="genericContext"}else{if(a.id.substring(0,5)=="webfx"){b="directoryContext"}}var c=new Array();var d;this.actions.each(function(m){var l=m.value;if(!l.context.contextMenu){return}if(b=="selectionContext"&&!l.context.selection){return}if(b=="directoryContext"&&!l.context.dir){return}if(b=="genericContext"&&l.context.selection){return}if(l.contextHidden||l.deny){return}if(d&&d!=l.context.actionBarGroup){c.push({separator:true})}var h=false;if(b=="selectionContext"){var e=ajaxplorer.getUserSelection();if(!e.isEmpty()){var f="file";if(e.isUnique()&&(e.hasDir()||e.hasMime(["ajxp_browsable_archive"]))){f="dir"}if(this.defaultActions.get(f)&&l.options.name==this.defaultActions.get(f)){h=true}}}var g={name:l.getKeyedText(),alt:l.options.title,image:resolveImageSource(l.options.src,"/images/actions/ICON_SIZE",16),isDefault:h,callback:function(n){this.apply()}.bind(l)};if(l.options.subMenu){g.subMenu=[];if(l.subMenuItems.staticOptions){g.subMenu=l.subMenuItems.staticOptions}if(l.subMenuItems.dynamicBuilder){g.subMenuBeforeShow=l.subMenuItems.dynamicBuilder}}c.push(g);d=l.context.actionBarGroup}.bind(this));return c},getInfoPanelActions:function(){var a=$A([]);this.actions.each(function(c){var b=c.value;if(b.context.infoPanel&&!b.deny){a.push(b)}});return a},getActionsForAjxpWidget:function(a,b){var c=$A([]);this.actions.each(function(e){var d=e.value;if(d.context.ajxpWidgets&&(d.context.ajxpWidgets.include(a+"::"+b)||d.context.ajxpWidgets.include(a))&&!d.deny){c.push(d)}});return c},fireDefaultAction:function(c){var a=this.defaultActions.get(c);if(a!=null){arguments[0]=a;if(a=="ls"){var b=this.actions.get(a);if(b){b.enable()}}this.fireAction.apply(this,arguments)}},fireAction:function(b){var c=this.actions.get(b);if(c!=null){var a=$A(arguments);a.shift();c.apply(a);return}},registerKey:function(b,a,c){if(c){a=a+"::"+c}this._registeredKeys.set(b.toLowerCase(),a)},clearRegisteredKeys:function(){this._registeredKeys=new Hash()},fireActionByKey:function(b,a){if(this._registeredKeys.get(a)&&!ajaxplorer.blockShortcuts){if(this._registeredKeys.get(a).indexOf("::")!==false){var c=this._registeredKeys.get(a).split("::");this.fireAction(c[0],c[1])}else{this.fireAction(this._registeredKeys.get(a))}Event.stop(b)}return},applyDragMove:function(f,c,a,e){if((!e&&!this.defaultActions.get("dragndrop"))||(e&&(!this.defaultActions.get("ctrldragndrop")||this.getDefaultAction("ctrldragndrop").deny))){return}if(f==null){fileNames=ajaxplorer.getUserSelection().getFileNames()}else{fileNames=[f]}if(a!=null){if(this.checkDestIsChildOfSource(fileNames,a)){ajaxplorer.displayMessage("ERROR",MessageHash[202]);return}for(var b=0;b<fileNames.length;b++){if(fileNames[b]==c){ajaxplorer.displayMessage("ERROR",MessageHash[202]);return}}if(c==ajaxplorer.getContextNode().getPath()){ajaxplorer.displayMessage("ERROR",MessageHash[203]);return}}var d=new Connexion();if(e){d.addParameter("get_action",this.defaultActions.get("ctrldragndrop"))}else{d.addParameter("get_action",this.defaultActions.get("dragndrop"))}if(f!=null){d.addParameter("file",f)}else{for(var b=0;b<fileNames.length;b++){d.addParameter("file_"+b,fileNames[b])}}d.addParameter("dest",c);d.addParameter("dir",ajaxplorer.getContextNode().getPath());d.onComplete=function(g){this.parseXmlMessage(g.responseXML)}.bind(this);d.sendAsync()},getDefaultAction:function(a){if(this.defaultActions.get(a)){return this.actions.get(this.defaultActions.get(a))}return null},checkDestIsChildOfSource:function(c,a){if(typeof c=="string"){c=[c]}var d=webFXTreeHandler.all[a];while(d.parentNode){for(var b=0;b<c.length;b++){if(d.filename==c[b]){return true}}d=d.parentNode}return false},submitForm:function(b,a,c){var d=new Connexion();if(a){d.setMethod("POST")}$(b).getElements().each(function(f){var e=f.getValue();if(f.name=="get_action"&&e.substr(0,4)=="http"){e=getBaseName(e)}if(f.type=="radio"&&!f.checked){return}d.addParameter(f.name,e)});if(ajaxplorer.getContextNode()){d.addParameter("dir",ajaxplorer.getContextNode().getPath())}if(c){d.onComplete=c}else{d.onComplete=function(e){this.parseXmlMessage(e.responseXML)}.bind(this)}d.sendAsync()},parseXmlMessage:function(a){var h=ajaxplorer.messageBox;if(a==null||a.documentElement==null){return}var d=a.documentElement.childNodes;var l=[];for(var s=0;s<d.length;s++){if(d[s].tagName=="message"){var m="No message";if(d[s].firstChild){m=d[s].firstChild.nodeValue}ajaxplorer.displayMessage(d[s].getAttribute("type"),m)}else{if(d[s].tagName=="reload_instruction"){var e=d[s].getAttribute("object");if(e=="data"){var q=d[s].getAttribute("node");if(q){l.push(q)}else{var t=d[s].getAttribute("file");if(t){ajaxplorer.getContextHolder().setPendingSelection(t)}l.push(ajaxplorer.getContextNode())}}else{if(e=="repository_list"){ajaxplorer.reloadRepositoriesList()}}}else{if(d[s].tagName=="logging_result"){if(d[s].getAttribute("secure_token")){Connexion.SECURE_TOKEN=d[s].getAttribute("secure_token");var p=window.ajxpServerAccessPath.split("?secure_token");window.ajxpServerAccessPath=p[0]+"?secure_token="+Connexion.SECURE_TOKEN;ajxpBootstrap.parameters.set("ajxpServerAccess",window.ajxpServerAccessPath)}var n=d[s].getAttribute("value");if(n=="1"){hideLightBox(true);if(d[s].getAttribute("remember_login")&&d[s].getAttribute("remember_pass")){var o=d[s].getAttribute("remember_login");var c=d[s].getAttribute("remember_pass");storeRememberData(o,c)}ajaxplorer.loadXmlRegistry()}else{if(n=="0"||n=="-1"){alert(MessageHash[285])}else{if(n=="2"){ajaxplorer.loadXmlRegistry()}else{if(n=="-2"){alert(MessageHash[286])}else{if(n=="-3"){alert(MessageHash[366])}else{if(n=="-4"){alert(MessageHash[386])}}}}}}}else{if(d[s].tagName=="trigger_bg_action"){var u=d[s].getAttribute("name");var g=d[s].getAttribute("messageId");var f=new Hash();for(var r=0;r<d[s].childNodes.length;r++){var b=d[s].childNodes[r];if(b.tagName=="param"){f.set(b.getAttribute("name"),b.getAttribute("value"))}}this.bgManager.queueAction(u,f,g);this.bgManager.next()}}}}}if(l.length){ajaxplorer.getContextHolder().multipleNodesReload(l)}},fireSelectionChange:function(){var a=null;if(ajaxplorer&&ajaxplorer.getUserSelection()){a=ajaxplorer.getUserSelection();if(a.isEmpty()){a=null}}this.actions.each(function(b){b.value.fireSelectionChange(a)});document.fire("ajaxplorer:actions_refreshed")},fireContextChange:function(){var b=false;var a=false;var d=false;var e;if(ajaxplorer&&ajaxplorer.getContextNode()){var c=ajaxplorer.getContextNode();b=(c.getAjxpMime()=="ajxp_recycle");a=c.hasAjxpMimeInBranch("ajxp_browsable_archive");d=c.isRoot();e=c.getAjxpMime()}this.actions.each(function(f){f.value.fireContextChange(this.usersEnabled,this.oUser,b,a,d,e)}.bind(this));document.fire("ajaxplorer:actions_refreshed")},removeActions:function(){this.actions.each(function(a){a.value.remove()});this.actions=new Hash();this.clearRegisteredKeys()},loadActionsFromRegistry:function(a){this.removeActions();this.parseActions(a);if(ajaxplorer&&ajaxplorer.guiActions){ajaxplorer.guiActions.each(function(c){var b=c.value;this.registerAction(b)}.bind(this))}document.fire("ajaxplorer:actions_loaded",this.actions);this.fireContextChange();this.fireSelectionChange()},registerAction:function(c){var a=c.options.name;this.actions.set(a,c);if(c.defaults){for(var b in c.defaults){this.defaultActions.set(b,a)}}if(c.options.hasAccessKey){this.registerKey(c.options.accessKey,a)}c.setManager(this)},parseActions:function(b){actions=XPathSelectNodes(b,"actions/action");for(var a=0;a<actions.length;a++){if(actions[a].nodeName!="action"){continue}if(actions[a].getAttribute("enabled")=="false"){continue}var c=new Action();c.createFromXML(actions[a]);this.registerAction(c)}},getActionByName:function(a){return this.actions.get(a)},getFlashVersion:function(){if(!this.pluginVersion){var a;if(navigator.plugins&&navigator.mimeTypes.length){a=navigator.plugins["Shockwave Flash"];if(a&&a.description){a=a.description}}else{if(Prototype.Browser.IE){try{a=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");a=a.GetVariable("$version")}catch(b){}}}this.pluginVersion=(typeof(a)=="string")?parseInt(a.match(/\d+/)[0]):0}return this.pluginVersion}});Class.create("ActionsToolbar",{__implements:"IAjxpWidget",initialize:function(b,a){this.element=b;this.element.ajxpPaneObject=this;this.options=Object.extend({buttonRenderer:"this",toolbarsList:$A(["default","put","get","change","user","remote"])},a||{});var c=this.options.buttonRenderer;if(c=="this"){this.options.buttonRenderer=this}else{this.options.buttonRenderer=new c()}this.toolbars=$H();this.initCarousel();attachMobileScroll(b.id,"horizontal");document.observe("ajaxplorer:actions_loaded",this.actionsLoaded.bind(this));document.observe("ajaxplorer:actions_refreshed",this.refreshToolbarsSeparator.bind(this))},actionsLoaded:function(a){this.actions=a.memo;this.emptyToolbars();this.initToolbars()},initToolbars:function(){this.actions.each(function(e){var d=e.value;var c=e.key;if(d.context.actionBar){if(this.toolbars.get(d.context.actionBarGroup)==null){this.toolbars.set(d.context.actionBarGroup,new Array())}this.toolbars.get(d.context.actionBarGroup).push(c)}}.bind(this));var b=0;var a=this.options.toolbarsList;a.each(function(d){var c=this.initToolbar(d);if(c&&c.actionsCount){if(b<a.size()-1){var e=new Element("div");e.addClassName("separator");c.insert({top:e})}this.element.insert(c);b++}}.bind(this));this.element.select("a").each(disableTextSelection)},refreshToolbarsSeparator:function(){this.toolbars.each(function(d){var c=this.element.select('[id="'+d.key+'_toolbar"]')[0];if(!c){return}var b=c.select("div.separator")[0];if(!b){return}var a=false;c.select("a").each(function(e){if(e.visible()){a=true}});if(a){b.show()}else{b.hide()}}.bind(this));this.refreshSlides()},initToolbar:function(b){if(!this.toolbars.get(b)){return}var a=$(b+"_toolbar");if(!a){var a=new Element("div",{id:b+"_toolbar",style:"display:inline;"})}a.actionsCount=0;this.toolbars.get(b).each(function(c){var e=this.actions.get(c);if(!e){return}var d=this.renderToolbarAction(e);a.insert(d);a.actionsCount++}.bind(this));return a},emptyToolbars:function(){if(this.element.subMenus){this.element.subMenus.invoke("destroy")}this.element.select("div").each(function(a){a.select("a").each(function(b){if(b.arrowDiv){b.arrowDiv.remove()}});a.remove()}.bind(this));this.toolbars=new Hash()},initCarousel:function(){this.outer=this.element;var a=this.outer.getHeight()-1;this.prev=new Element("a",{className:"carousel-control",rel:"prev",style:"height:"+a+"px;"}).update(new Element("img",{src:ajxpResourcesFolder+"/images/arrow_left.png"}));this.next=new Element("a",{className:"carousel-control",rel:"next",style:"float:right;height:"+a+"px;"}).update(new Element("img",{src:ajxpResourcesFolder+"/images/arrow_right.png"}));this.inner=new Element("div",{id:"buttons_inner",style:"width:1000px;"});this.outer.insert({before:this.prev});this.outer.insert({before:this.next});this.outer.insert(this.inner);if(Prototype.Browser.IE){this.outer.setStyle({cssFloat:"left"})}this.element=this.inner;this.carousel=new Carousel(this.outer,[],$A([this.prev,this.next]),{duration:0.1,afterMove:function(){this.carousel.slides.each(function(b){if(b.arrowDiv){b.arrowDiv.show();this.placeArrowDiv(b)}}.bind(this))}.bind(this),beforeMove:function(){this.carousel.slides.each(function(b){if(b.arrowDiv){b.arrowDiv.hide()}}.bind(this))}.bind(this)})},refreshSlides:function(){var a=$A();this.inner.select("a").each(function(b){if(b.visible()){a.push(b)}});this.carousel.refreshSlides(a);this.resize()},renderToolbarAction:function(c){var b=new Element("a",{href:c.options.name,id:c.options.name+"_button"}).observe("click",function(f){Event.stop(f);if(this.options.subMenu){}else{this.apply()}}.bind(c));var e=resolveImageSource(c.options.src,c.__DEFAULT_ICON_PATH,22);var a=new Element("img",{id:c.options.name+"_button_icon",src:e,width:18,height:18,border:0,align:"absmiddle",alt:c.options.title,title:c.options.title});var d=new Element("span",{id:c.options.name+"_button_label"}).setStyle({paddingLeft:6,paddingRight:6,cursor:"pointer"});b.insert(a).insert(new Element("br")).insert(d.update(c.getKeyedText()));if(c.options.subMenu){this.buildActionBarSubMenu(b,c);b.arrowDiv=new Element("div");b.arrowDiv.insert(new Element("img",{src:ajxpResourcesFolder+"/images/arrow_down.png",height:6,width:10,border:0}));b.arrowDiv.imgRef=a;$$("body")[0].insert(b.arrowDiv);b.arrowDiv.setStyle({display:"none"})}else{b.observe("mouseover",function(){this.buttonStateHover(b,c)}.bind(this));b.observe("mouseout",function(){this.buttonStateOut(b,c)}.bind(this))}b.hide();this.attachListeners(b,c);return b},attachListeners:function(a,b){b.observe("hide",function(){a.hide()}.bind(this));b.observe("show",function(){a.show();this.placeArrowDiv(a)}.bind(this));b.observe("disable",function(){a.addClassName("disabled")}.bind(this));b.observe("enable",function(){a.removeClassName("disabled");this.placeArrowDiv(a)}.bind(this));b.observe("submenu_active",function(d){if(!d.src||!b.options.subMenuUpdateImage){return}var c=a.select('img[id="'+b.options.name+'_button_icon"]');if(!c.length){return}c[0].src=resolveImageSource(d.src,b.__DEFAULT_ICON_PATH,22);b.options.src=d.src}.bind(this))},buildActionBarSubMenu:function(b,c){var a=new Proto.Menu({mouseClick:"over",anchor:b,className:"menu desktop toolbarmenu",topOffset:0,leftOffset:0,parent:this.element,menuItems:c.subMenuItems.staticOptions||[],fade:true,zIndex:2000});var d=b.select("span")[0];a.options.beforeShow=function(f){b.addClassName("menuAnchorSelected");this.buttonStateHover(b,c);if(c.subMenuItems.dynamicBuilder){c.subMenuItems.dynamicBuilder(a)}}.bind(this);a.options.beforeHide=function(f){b.removeClassName("menuAnchorSelected");this.buttonStateOut(b,c)}.bind(this);if(!this.element.subMenus){this.element.subMenus=$A([])}this.element.subMenus.push(a)},placeArrowDiv:function(c){if(!c.arrowDiv){return}try{if(!c.visible()){c.arrowDiv.hide();return}var a=this.outer.scrollLeft||0;var l=c.positionedOffset()[0];var d=this.outer.getWidth();if((a<=l)&&(l<a+d)){c.arrowDiv.show();var h=Position.cumulativeOffset(c.arrowDiv.imgRef);var f=h[0]+11-a;var b=h[1]+17;c.arrowDiv.setStyle({position:"absolute",top:b,left:f})}else{c.arrowDiv.hide();return}}catch(g){}},buttonStateHover:function(a,b){if(a.hasClassName("disabled")){return}if(a.hideTimeout){clearTimeout(a.hideTimeout)}new Effect.Morph(a.select('img[id="'+b.options.name+'_button_icon"]')[0],{style:"width:22px; height:22px;margin-top:3px;",duration:0.08,transition:Effect.Transitions.sinoidal,afterFinish:function(){this.updateTitleSpan(a.select("span")[0],"big")}.bind(this)})},buttonStateOut:function(a,b){if(a.hasClassName("disabled")){return}a.hideTimeout=setTimeout(function(){new Effect.Morph(a.select('img[id="'+b.options.name+'_button_icon"]')[0],{style:"width:18px; height:18px;margin-top:8px;",duration:0.2,transition:Effect.Transitions.sinoidal,afterFinish:function(){this.updateTitleSpan(a.select("span")[0],"small")}.bind(this)})}.bind(this),10)},updateTitleSpan:function(a,b){if(!a.orig_width&&b=="big"){var c=a.getWidth();a.setStyle({display:"block",width:c,overflow:"visible",padding:0});a.orig_width=c}a.setStyle({fontSize:(b=="big"?"11px":"9px")})},resize:function(){var a=0;var b=$(this.outer).parentNode.getWidth();if(Prototype.Browser.IE){b=$(this.outer).getOffsetParent().getWidth()-4}var e=[];var d=this.inner.select("a");d.each(function(f){if(f.visible()){e.push(f)}});if(e.length){var c=e[e.length-1];var a=c.cumulativeOffset()[0]+c.getWidth()}if(a>b){this.prev.show();this.next.show();this.outer.setStyle({width:(b-this.prev.getWidth()-this.next.getWidth())+"px"})}else{this.prev.hide();this.next.hide();this.carousel.first();this.outer.setStyle({width:b+"px"})}d.each(function(f){if(f.arrowDiv){this.placeArrowDiv(f)}}.bind(this))},showElement:function(a){}});Class.create("BackgroundManager",{queue:$A([]),initialize:function(a){this.actionManager=a;this.panel=new Element("div").addClassName("backgroundPanel");if(Prototype.Browser.IE){this.panel.setStyle({width:"35%"})}this.panel.hide();this.working=false;document.body.insert(this.panel)},queueAction:function(a,c,b){var d=new Hash();d.set("name",a);d.set("messageId",b);d.set("parameters",c);this.queue.push(d)},next:function(){if(!this.queue.size()){this.finished();return}if(this.working){return}var c=this.queue[0];var b=new Connexion();b.setParameters(c.get("parameters"));b.addParameter("get_action",c.get("name"));b.onComplete=function(e){var d=e.responseXML;if(d==null||d.documentElement==null){this.working=false;this.next();return}this.parseAnswer(e.responseXML);this.working=false}.bind(this);b.sendAsync();var a='<img src="'+ajxpResourcesFolder+'/images/loadingImage.gif" height="16" width="16" align="absmiddle">';this.panel.update(a+" "+c.get("messageId"));this.panel.show();new Effect.Corner(this.panel,"round 8px bl");new Effect.Corner(this.panel,"round 8px tl");this.queue.shift();this.working=true},parseAnswer:function(b){var g=b.documentElement.childNodes;for(var d=0;d<g.length;d++){if(g[d].tagName=="message"){var l=g[d].getAttribute("type");if(l!="SUCCESS"){return this.interruptOnError(g[d].firstChild.nodeValue)}}else{if(g[d].nodeName=="trigger_bg_action"){var a=g[d].getAttribute("name");var h=g[d].getAttribute("messageId");var m=new Hash();for(var c=0;c<g[d].childNodes.length;c++){var f=g[d].childNodes[c];if(f.tagName=="param"){m.set(f.getAttribute("name"),f.getAttribute("value"))}}if(a=="reload_node"){var e=ajaxplorer.fireContextRefresh();this.finished()}else{this.queueAction(a,m,h)}}}}this.working=false;this.next()},interruptOnError:function(a){if(this.queue.size()){this.queue=$A([])}this.panel.update(a);this.panel.insert(this.makeCloseLink());this.working=false},finished:function(){this.working=false;this.panel.hide()},makeCloseLink:function(){var a=new Element("a",{href:"#"}).update("Close").observe("click",function(b){Event.stop(b);this.panel.hide()}.bind(this));return a},addStub:function(){this.queueAction("local_to_remote",new Hash(),"Stubing a 10s bg action")}});Class.create("AjxpDataModel",{_currentRep:undefined,_bEmpty:undefined,_bUnique:false,_bFile:false,_bDir:false,_isRecycle:false,_pendingContextPath:null,_pendingSelection:null,_selectionSource:{},_rootNode:null,initialize:function(){this._currentRep="/";this._selectedNodes=$A([]);this._bEmpty=true},setAjxpNodeProvider:function(a){this._iAjxpNodeProvider=a},requireContextChange:function(d,h){var g=d.getPath();if((g==""||g=="/")&&d!=this._rootNode){d=this._rootNode}if(d.getMetadata().get("paginationData")&&d.getMetadata().get("paginationData").get("new_page")&&d.getMetadata().get("paginationData").get("new_page")!=d.getMetadata().get("paginationData").get("current")){var c=d.getMetadata().get("paginationData").get("new_page");h=true}if(d!=this._rootNode&&(!d.getParent()||d.fake)){var b=[];d=d.findInArbo(this._rootNode,b);if(b.length){var a=b.shift();a.observeOnce("first_load",function(l){this.requireContextChange(d)}.bind(this));a.observeOnce("error",function(l){ajaxplorer.displayMessage("ERROR",l);a.notify("node_removed");var e=a.getParent();e.removeChild(a);delete (a);this.requireContextChange(e)}.bind(this));document.fire("ajaxplorer:context_loading");a.load(this._iAjxpNodeProvider);return}}d.observeOnce("loaded",function(){this.setContextNode(d,true);document.fire("ajaxplorer:context_loaded")}.bind(this));d.observeOnce("error",function(e){ajaxplorer.displayMessage("ERROR",e);document.fire("ajaxplorer:context_loaded")}.bind(this));document.fire("ajaxplorer:context_loading");try{if(h){if(c){d.getMetadata().get("paginationData").set("current",c)}d.reload(this._iAjxpNodeProvider)}else{d.load(this._iAjxpNodeProvider)}}catch(f){document.fire("ajaxplorer:context_loaded")}},setRootNode:function(a){this._rootNode=a;this._rootNode.setRoot();this._rootNode.observe("child_added",function(b){});document.fire("ajaxplorer:root_node_changed",this._rootNode);this.setContextNode(this._rootNode)},getRootNode:function(a){return this._rootNode},setContextNode:function(b,a){if(this._contextNode&&this._contextNode==b&&this._currentRep==b.getPath()&&!a){return}this._contextNode=b;this._currentRep=b.getPath();document.fire("ajaxplorer:context_changed",b)},getContextNode:function(){return this._contextNode},multipleNodesReload:function(b){b=$A(b);for(var d=0;d<b.length;d++){var a=b[d];var e;if(Object.isString(a)){e=new AjxpNode(a);if(e.getPath()==this._rootNode.getPath()){e=this._rootNode}else{e=e.findInArbo(this._rootNode,[])}}else{e=a}b[d]=e}var c=$A([]);b.sort(function(g,f){if(g.isParentOf(f)){c.push(f);return -1}if(g.isChildOf(f)){c.push(g);return +1}return 0});c.each(function(f){b=b.without(f)});b.each(this.queueNodeReload.bind(this));this.nextNodeReloader()},queueNodeReload:function(a){if(!this.queue){this.queue=[]}if(a){this.queue.push(a)}},nextNodeReloader:function(){if(!this.queue.length){window.setTimeout(function(){document.fire("ajaxplorer:context_changed",this._contextNode)}.bind(this),200);return}var b=this.queue.shift();var a=this.nextNodeReloader.bind(this);b.observeOnce("loaded",a);b.observeOnce("error",a);if(b==this._contextNode||b.isParentOf(this._contextNode)){this.requireContextChange(b,true)}else{b.reload(this._iAjxpNodeProvider)}},setPendingSelection:function(a){this._pendingSelection=a},getPendingSelection:function(){return this._pendingSelection},clearPendingSelection:function(){this._pendingSelection=null},setSelectedNodes:function(a,d){if(!d){this._selectionSource={}}else{this._selectionSource=d}this._selectedNodes=$A(a);this._bEmpty=((a&&a.length)?false:true);this._bFile=this._bDir=this._isRecycle=false;if(!this._bEmpty){this._bUnique=((a.length==1)?true:false);for(var b=0;b<a.length;b++){var c=a[b];if(c.isLeaf()){this._bFile=true}else{this._bDir=true}if(c.isRecycle()){this._isRecycle=true}}}document.fire("ajaxplorer:selection_changed",this)},getSelectedNodes:function(){return this._selectedNodes},getSelectionSource:function(){return this._selectionSource},getSelectedItems:function(){throw new Error("Deprecated : use getSelectedNodes() instead")},selectAll:function(){this.setSelectedNodes(this._contextNode.getChildren(),"dataModel")},isEmpty:function(){return(this._selectedNodes?(this._selectedNodes.length==0):true)},isUnique:function(){return this._bUnique},hasFile:function(){return this._bFile},hasDir:function(){return this._bDir},isRecycle:function(){return this._isRecycle},getCurrentRep:function(){return this._currentRep},isMultiple:function(){if(this._selectedNodes&&this._selectedNodes.length>1){return true}return false},hasMime:function(b){if(b.length==1&&b[0]=="*"){return true}var a=false;b.each(function(c){if(a){return}a=this._selectedNodes.any(function(d){return(getAjxpMimeType(d)==c)})}.bind(this));return a},getFileNames:function(b){if(!this._selectedNodes.length){alert("Please select a file!");return}var a=new Array(this._selectedNodes.length);for(i=0;i<this._selectedNodes.length;i++){a[i]=this._selectedNodes[i].getPath()}if(b){return a.join(b)}else{return a}},getContextFileNames:function(c){var a=this._contextNode.getChildren();if(!a.length){return false}var b=$A([]);for(i=0;i<a.length;i++){b.push(getBaseName(a[i].getPath()))}if(c){return b.join(c)}else{return b}},fileNameExists:function(c){var b=this._contextNode.getChildren();if(!b.length){return false}for(i=0;i<b.length;i++){var d=b[i].getMetadata();var a=getBaseName(d.get("filename"));if(a&&a.toLowerCase()==getBaseName(c).toLowerCase()){return true}}return false},getUniqueFileName:function(){if(this.getFileNames().length){return this.getFileNames()[0]}return null},getUniqueNode:function(){if(this._selectedNodes.length){return this._selectedNodes[0]}return null},getUniqueItem:function(){throw new Error("getUniqueItem is deprecated, use getUniqueNode instead!")},getItem:function(a){throw new Error("getItem is deprecated, use getNode instead!")},getNode:function(a){return this._selectedNodes[a]},updateFormOrUrl:function(b,d){if(b){$(b).getElementsBySelector("input").each(function(e){if(e.name.indexOf("file_")!=-1||e.name=="file"){e.value=""}})}if(b&&b.rep){b.rep.value=this._currentRep}d+="&dir="+encodeURIComponent(this._currentRep);if(this.isEmpty()){return d}var a=this.getFileNames();if(this.isUnique()){d+="&file="+encodeURIComponent(a[0]);if(b){this._addHiddenField(b,"file",a[0])}}else{for(var c=0;c<a.length;c++){d+="&file_"+c+"="+encodeURIComponent(a[c]);if(b){this._addHiddenField(b,"file_"+c,a[c])}}}return d},_addHiddenField:function(a,b,d){if(a[b]){a[b].value=d}else{var c=document.createElement("input");c.type="hidden";c.name=b;c.value=d;a.appendChild(c)}}});Class.create("HeaderResizer",{initialize:function(b,a){this.element=b;this.options=Object.extend({initSizes:null,initSizesType:"percent",cellSelector:"div.header_cell",handleSelector:"div.resizer",body:$("tBody"),bodyRowSelector:"tr",bodyCellSelector:"td",bodyIsMaster:false,handleWidth:3,headerData:null,useCSS3:false},a||{});if(this.options.headerData){this.generateHeader()}this.options.useCSS3=this.detectCSS3();this.mainSize=this.element.getWidth();this.cells=this.element.select(this.options.cellSelector);this.cells.each(function(d){disableTextSelection(d)});this.element.select(this.options.handleSelector).each(function(d){this.initDraggable(d)}.bind(this));var c;if(this.options.initSizes){if(this.options.initSizesType=="percent"){c=this.computePercentSizes(this.options.initSizes,100)}else{c=this.options.initSizes}}else{c=this.computeEqualSizes()}this.resizeHeaders(c);this.observe("drag_resize",function(d){this.refreshBody()}.bind(this))},generateHeader:function(){var c=this.options.headerData;this.element.addClassName("header_resizer");var b;var a=0;c.each(function(d){this.element.insert('<div class="header_cell"><div class="header_label">'+d.label+"</div></div>");if(d!=c.last()){this.element.insert('<div class="resizer">&nbsp;</div>')}if(d.size){if(!b){b=$A()}b[a]=d.size}a++}.bind(this));if(b&&b.length){this.options.initSizes=b}},computeEqualSizes:function(){var c=1/this.cells.length;var d=$A();var e=this.getInnerWidth()-(this.cells.length-1)*this.options.handleWidth;var a=Math.floor(e*c);for(var b=0;b<this.cells.length;b++){d[b]=a}return d},computePercentSizes:function(b,d){var c=$A();var a=this.getInnerWidth();b.each(function(e){c.push(Math.round(e*a/d))});return c},getCurrentSizes:function(d){if(!d){return this.currentSizes}var a=this.getInnerWidth();var c=$A();for(var b=0;b<this.currentSizes.length;b++){c[b]=Math.floor(this.currentSizes[b]/a*100)}return c},resize:function(a){this.mainSize=a;this.element.setStyle({width:this.mainSize});this.checkBodyScroll();this.resizeHeaders();this.log("Resize:"+a);if(this.timer){window.clearTimeout(this.timer)}this.timer=window.setTimeout(this.refreshBody.bind(this),50)},resizeHeaders:function(d){var a=this.getInnerWidth();if(!a){return}if(!d&&this.currentInner&&a!=this.currentInner){d=this.computePercentSizes(this.currentSizes,this.currentInner)}if(!d){return}this.log("Inner Width:"+a+"/"+this.element.offsetWidth);var c=0;for(var b=0;b<this.cells.length;b++){if(!d[b]){d[b]=Math.floor((a-(this.verticalScrollerMargin||0)-c)/(this.cells.length-b))}c+=d[b]+this.options.handleWidth;if(b<this.cells.length-1&&c<a){this.cells[b].setStyle({width:(d[b]-(Prototype.Browser.IE?1:0))+"px"})}else{c-=d[b]+this.options.handleWidth;d[b]=Math.floor((a-(this.verticalScrollerMargin||0)-c)/(this.cells.length-b));this.cells[b].setStyle({width:d[b]+"px"});if(Position.cumulativeOffset(this.cells[b])[1]>Position.cumulativeOffset(this.element)[1]+10){d[b]=a-c-1-(this.verticalScrollerMargin||0);this.cells[b].setStyle({width:d[b]+"px"})}c+=d[b]+this.options.handleWidth;if(b==this.cells.length-1&&c<a-(this.verticalScrollerMargin||0)){d[b]=(a-(this.verticalScrollerMargin||0)-c);this.cells[b].setStyle({width:d[b]+"px"})}}}this.currentSizes=d;this.log(this.currentSizes.join(","));this.currentInner=a;this.notify("headers_resize")},initDraggable:function(a){new Draggable(a,{constraint:"horizontal",snap:function(c,g,b){function f(m,h,l){if(m>l){return l}else{if(m<h){return h}else{return m}}}var d=Element.cumulativeOffset(b.element).left;var e=d-b.originalLeft;if((c<0&&-e>b._initLeftCell-10)||(e<0&&-e>b._initLeftCell)){c=0}if(c>0&&e>b._initRightCell-10){c=0}return[f(c,-b._initLeftCell,b._initRightCell),g]},onDrag:function(b){var d=Element.cumulativeOffset(b.element).left;var f=d-b.originalLeft;var e=$A();for(var c=0;c<this.cells.length;c++){if(this.cells[c]==b.previous){e[c]=b._initLeftCell+f}else{e[c]=this.currentSizes[c]-(c==(this.cells.length-1)?f:0)}}this.log(e);b.element.setStyle({left:0});this.resizeHeaders(e);if(b._ghost){if(b._ghost.getOffsetParent()){d-=b._ghost.getOffsetParent().positionedOffset()[0]+2}b._ghost.setStyle({left:d-(Prototype.Browser.IE?0:this.options.body.scrollLeft)})}}.bind(this),onStart:function(b){b.element.addClassName("dragging");b.originalLeft=Element.cumulativeOffset(b.element).left;b.previous=b.element.previous();b.next=b.element.next();b._initLeftCell=b.previous.getWidth();b._initRightCell=b.next.getWidth();b._ghost=this.createResizeGhost();if(b._ghost){b._ghost.setStyle({left:b.originalLeft})}}.bind(this),onEnd:function(b){b.element.setStyle({left:0});b.element.removeClassName("dragging");if(b._ghost){b._ghost.remove()}for(var c=0;c<this.cells.length;c++){if(this.cells[c]==b.previous){this.currentSizes[c]=b.previous.getWidth()}if(this.cells[c]==b.next){this.currentSizes[c]=b.next.getWidth()}}this.notify("drag_resize")}.bind(this)})},createResizeGhost:function(){if(!this.options.body){return null}var a=new Element("div",{className:"resizeGhost"});this.options.body.insert({before:a});a.setStyle({height:this.getInnerHeight(this.options.body)-((this.options.body.scrollWidth>this.options.body.getWidth())?16:0),left:0});return a},refreshBody:function(){var d=this.getCurrentSizes();var f=this.options.useCSS3;var c=this.createStyleSheet();if(Prototype.Browser.IE){this.options.body.select(this.options.bodyRowSelector).each(function(l){var g=l.select(this.options.bodyCellSelector);for(var h=0;h<g.length;h++){if(d[h]){this.setGridCellWidth(g[h],d[h])}}}.bind(this));this.checkBodyScroll();return}for(var b=0;b<d.length;b++){if(f){var a="#"+this.options.body.id+" td:nth-child("+(b+1)+")"}else{var a="#"+this.options.body.id+" td.resizer_"+(b)}var e="width:"+(d[b]+(Prototype.Browser.IE?10:-6))+" !important;";this.addStyleRule(c,a,e);if(f){a="#"+this.options.body.id+" td:nth-child("+(b+1)+") .text_label"}else{a="#"+this.options.body.id+" td.resizer_"+(b)+" .text_label"}e="width:"+(d[b]-(Prototype.Browser.IE?0:this.options.headerData[b].leftPadding))+" !important;";this.addStyleRule(c,a,e)}this.checkBodyScroll()},addStyleRule:function(b,a,c){if(Prototype.Browser.IE){b.addRule(a,c)}else{b.insertRule(a+"{"+c+"}",b.length)}},createStyleSheet:function(){if(Prototype.Browser.IE){return;if(!window.ajxp_resizer_sheet){window.ajxp_resizer_sheet=document.createStyleSheet()}var d=window.ajxp_resizer_sheet;var e=d.rules;var a=e.length;for(var c=a-1;c>=0;c--){d.removeRule(c)}}else{var b=$("resizer_css");if(b){b.remove()}b=new Element("style",{type:"text/css",id:"resizer_css"});$$("head")[0].insert(b);var d=b.sheet}return d},removeStyleSheet:function(){if(Prototype.Browser.IE){return;if(window.ajxp_resizer_sheet){var d=window.ajxp_resizer_sheet;var e=d.rules;var a=e.length;for(var c=a-1;c>=0;c--){d.removeRule(c)}}}else{var b=$("resizer_css");if(b){b.remove()}}},detectCSS3:function(){if(Prototype.Browser.IE){return false}if(window.ajxp_resizer_csstest!=undefined){return window.ajxp_resizer_csstest}var b=this.createStyleSheet();var a=false;try{this.addStyleRule(b,this.options.cellSelector+":nth-child(1)","color:rgb(0, 0, 15);");var d=this.element.down(this.options.cellSelector);if(d&&d.getStyle("color")=="rgb(0, 0, 15)"){a=true}this.removeStyleSheet()}catch(c){}window.ajxp_resizer_csstest=a;return a},setGridCellWidth:function(a,d,e){var c=a.down(".text_label");if(!c){if(d){a.setStyle({width:d+"px"})}return}var b;if(d){b=parseInt(d)}else{b=a.getWidth()-3}var f=1+(e||0);c.siblings().each(function(g){f+=g.getWidth()});c.setStyle({width:(b-f)+"px"});if(d){a.setStyle({width:b+"px"})}},checkBodyScroll:function(){var a=this.options.body;if(a.scrollHeight>a.getHeight()){this.verticalScrollerMargin=18}else{if(a.scrollHeight<=a.getHeight()){this.verticalScrollerMargin=0}}if(!this.options.bodyIsMaster){return}if(a.scrollWidth>a.getWidth()){if(!this.scroller){this.element._origWidth=this.element.getWidth();this.scroller=new Element("div",{style:"overflow:hidden;"});this.scroller.setStyle({width:this.element._origWidth});$(this.element.parentNode).insert({top:this.scroller});this.scroller.insert(this.element);this.scroller.observer=function(){this.log(a.scrollWidth);this.scroller.scrollLeft=a.scrollLeft}.bind(this);a.observe("scroll",this.scroller.observer)}else{this.scroller.setStyle({width:this.mainSize})}this.element.setStyle({width:a.scrollWidth});this.verticalScrollerMargin=0;this.resizeHeaders()}else{if(a.scrollWidth<=a.getWidth()&&this.scroller){this.element.setStyle({width:this.element._origWidth});$(this.scroller.parentNode).insert({top:this.element});a.stopObserving("scroll",this.scroller.observer);this.scroller.remove();this.scroller=null;this.resizeHeaders()}}},getInnerWidth:function(){var a=parseInt(this.element.getStyle("borderLeftWidth"))||0;var b=parseInt(this.element.getStyle("borderRightWidth"))||0;return innerWidth=this.element.getWidth()-a-b},getInnerHeight:function(a){return innerWidth=a.getHeight()-(parseInt(a.getStyle("borderTopWidth"))||0)-(parseInt(a.getStyle("borderBottomWidth"))||0)},log:function(a){return;if(window.console){console.log(a)}else{if($("info_panel")){$("info_panel").insert("<div>"+a+"</div>");$("info_panel").scrollTop=$("info_panel").scrollHeight}}}});Class.create("FilesList",SelectableElements,{__implements:["IAjxpWidget","IFocusable","IContextMenuable","IActionProvider"],initialize:function($super,c,b){$super(null,true);$(c).ajxpPaneObject=this;this.htmlElement=$(c);if(typeof b=="string"){this.options={};this._displayMode=b}else{this.options=b;this._displayMode="list"}Event.observe(document,"ajaxplorer:user_logged",function(){if(!ajaxplorer||!ajaxplorer.user){return}disp=ajaxplorer.user.getPreference("display");if(disp&&(disp=="thumb"||disp=="list")){if(disp!=this._displayMode){this.switchDisplayMode(disp)}}this._thumbSize=parseInt(ajaxplorer.user.getPreference("thumb_size"));if(this.slider){this.slider.setValue(this._thumbSize);this.resizeThumbnails()}}.bind(this));var a=this.contextObserver.bind(this);var e=this.setOnLoad.bind(this);var d=this.removeOnLoad.bind(this);document.observe("ajaxplorer:context_changed",function(g){var h=g.memo;var f=this.crtContext;if(f){f.stopObserving("loaded",d);f.stopObserving("loading",e)}this.crtContext=h;if(this.crtContext.isLoaded()){this.contextObserver()}else{this.crtContext.observeOnce("loaded",a)}this.crtContext.observe("loaded",d);this.crtContext.observe("loading",e)}.bind(this));document.observe("ajaxplorer:context_loading",e);document.observe("ajaxplorer:component_config_changed",function(g){if(g.memo.className=="FilesList"){var f=this.parseComponentConfig(g.memo.classConfig.get("all"));if(f){this.initGUI()}}}.bind(this));document.observe("ajaxplorer:selection_changed",function(f){if(f.memo._selectionSource==null||f.memo._selectionSource==this){return}this.setSelectedNodes(ajaxplorer.getContextHolder().getSelectedNodes())}.bind(this));this._thumbSize=64;this._crtImageIndex=0;this._pendingFile=null;this.allDraggables=new Array();this.allDroppables=new Array();this.gridStyle="file";this.paginationData=null;this.even=true;this.hiddenColumns=$A([]);this.columnsDef=$A([]);this.columnsDef.push({messageId:1,attributeName:"ajxp_label"});this.columnsDef.push({messageId:2,attributeName:"filesize"});this.columnsDef.push({messageId:3,attributeName:"mimestring"});this.columnsDef.push({messageId:4,attributeName:"ajxp_modiftime"});this.defaultSortTypes=["StringDirFile","NumberKo","String","MyDate"];this._oSortTypes=this.defaultSortTypes;this.initGUI();Event.observe(document,"keydown",this.keydown.bind(this))},getVisibleColumns:function(){var a=$A([]);this.columnsDef.each(function(b){if(!this.hiddenColumns.include(b.attributeName)){a.push(b)}}.bind(this));return a},getVisibleSortTypes:function(){var c=$A([]);var a=0;for(var b=0;b<this.columnsDef.length;b++){if(!this.hiddenColumns.include(this.columnsDef[b].attributeName)){c.push(this.columnsDef[b].sortType)}}return c},setColumnVisible:function(c,b){var d=false;if(b&&this.hiddenColumns.include(c)){this.hiddenColumns=this.hiddenColumns.without(c);d=true}if(!b&&!this.hiddenColumns.include(c)){this.hiddenColumns.push(c);d=true}if(d){if(ajaxplorer&&ajaxplorer.user){var a=ajaxplorer.user.getPreference("columns_visibility",true)||{};a=new Hash(a);a.set(ajaxplorer.user.getActiveRepository(),this.hiddenColumns);ajaxplorer.user.setPreference("columns_visibility",a,true)}this.initGUI();this.fill(this.crtContext);if(ajaxplorer&&ajaxplorer.user){ajaxplorer.user.savePreference("columns_visibility")}}},contextObserver:function(){if(!this.crtContext){return}this.fill(this.crtContext);this.removeOnLoad()},parseComponentConfig:function(e){refreshGUI=false;this.columnsTemplate=false;var n=XPathSelectSingleNode(e,"columns");if(n){if(n.getAttribute("switchGridMode")){this.gridStyle=n.getAttribute("switchGridMode");refreshGUI=true}if(n.getAttribute("switchDisplayMode")){var h=n.getAttribute("switchDisplayMode");this._fullview=false;if(h=="full"){this._fullview=true;h="list"}if(h!=this._displayMode){this.switchDisplayMode(h)}}if(n.getAttribute("template_name")){this.columnsTemplate=n.getAttribute("template_name")}var d=XPathSelectNodes(n,"column");var a=XPathSelectNodes(n,"additional_column");if(d.length){var c=$A([]);var g=$A([]);d.concat(a)}else{var c=this.columnsDef;var g=this._oSortTypes;d=a}d.each(function(o){var p={};$A(o.attributes).each(function(q){p[q.nodeName]=q.nodeValue;if(q.nodeName=="sortType"){g.push(q.nodeValue)}});c.push(p)});if(c.size()){this.columnsDef=c;this._oSortTypes=g;if(this._displayMode=="list"){refreshGUI=true}}}var l=XPathSelectNodes(e,"property");if(l.length){for(var f=0;f<l.length;f++){var m=l[f];if(m.getAttribute("name")=="thumbSize"){this._thumbSize=parseInt(m.getAttribute("value"));refreshGUI=true}else{if(m.getAttribute("name")=="fixedThumbSize"){this._fixedThumbSize=parseInt(m.getAttribute("value"));refreshGUI=true}else{if(m.getAttribute("name")=="displayMode"){var b=m.getAttribute("value");if(!(ajaxplorer&&ajaxplorer.user&&ajaxplorer.user.getPreference("display"))){this._displayMode=b;refreshGUI=true}}}}}}return refreshGUI},getActions:function(){var e=this;var b={name:"multi_display",src:"view_icon.png",text_id:150,title_id:151,text:MessageHash[150],title:MessageHash[151],hasAccessKey:false,subMenu:true,subMenuUpdateImage:true,callback:function(){if(window.actionArguments){if(Object.isString(window.actionArguments[0])){e.switchDisplayMode(window.actionArguments[0])}else{e.switchDisplayMode(window.actionArguments[0].command)}}},listeners:{init:function(){window.setTimeout(function(){var g=e.getDisplayMode();var f=this.subMenuItems.staticItems.detect(function(h){return h.command==g});this.notify("submenu_active",f)}.bind(window.listenerContext),500)}}};var d={selection:false,dir:true,actionBar:true,actionBarGroup:"default",contextMenu:true,infoPanel:false};var a={staticItems:[{text:228,title:229,src:"view_icon.png",command:"thumb",hasAccessKey:true,accessKey:"thumbs_access_key"},{text:226,title:227,src:"view_text.png",command:"list",hasAccessKey:true,accessKey:"list_access_key"}]};var c=new Action(b,d,{},{},a);return $H({multi_display:c})},initGUI:function(){if(this.observer){this.stopObserving("resize",this.observer)}if(this._displayMode=="list"){var c="";if(ajaxplorer&&ajaxplorer.user&&ajaxplorer.user.getPreference("columns_visibility",true)){var d=new Hash(ajaxplorer.user.getPreference("columns_visibility",true));if(d.get(ajaxplorer.user.getActiveRepository())){this.hiddenColumns=$A(d.get(ajaxplorer.user.getActiveRepository()))}else{this.hiddenColumns=$A()}}var h=this.getVisibleColumns();var f;if(ajaxplorer&&ajaxplorer.user&&ajaxplorer.user.getPreference("columns_size",true)){var d=new Hash(ajaxplorer.user.getPreference("columns_size",true));if(this.columnsTemplate&&d.get(this.columnsTemplate)){f=new Hash(d.get(this.columnsTemplate))}else{if(d.get(ajaxplorer.user.getActiveRepository())){f=new Hash(d.get(ajaxplorer.user.getActiveRepository()))}}}var m=$A();for(var e=0;e<h.length;e++){var b=h[e];var g=0;if((this.gridStyle!="grid"||this.columnsTemplate)&&f&&f.get(e)&&e<(h.length-1)){g=f.get(e)}if(b.fixedWidth){g=b.fixedWidth}var l=(b.messageId?MessageHash[b.messageId]:b.messageString);var a=0;if(b.attributeName=="ajxp_label"){a=24}m.push({label:l,size:g,leftPadding:a})}c='<div id="selectable_div_header" class="sort-table"></div>';c=c+'<div id="table_rows_container" style="overflow:auto;"><table id="selectable_div" class="sort-table" width="100%" cellspacing="0"><tbody></tbody></table></div>';this.htmlElement.update(c);attachMobileScroll("table_rows_container","vertical");oElement=$("selectable_div");if(this.paginationData&&parseInt(this.paginationData.get("total"))>1){$("table_rows_container").insert({before:this.createPaginator()})}this.initSelectableItems(oElement,true,$("table_rows_container"));this._headerResizer=new HeaderResizer($("selectable_div_header"),{headerData:m,body:$("table_rows_container"),initSizesType:"percent",bodyIsMaster:(this.gridStyle=="grid")});this._headerResizer.observe("drag_resize",function(){if(this.prefSaver){window.clearTimeout(this.prefSaver)}this.prefSaver=window.setTimeout(function(){if(!ajaxplorer.user||(this.gridStyle=="grid"&&!this.columnsTemplate)){return}var n=this._headerResizer.getCurrentSizes("percent");var o=ajaxplorer.user.getPreference("columns_size",true);o=(o?new Hash(o):new Hash());n.type="percent";var p=(this.columnsTemplate?this.columnsTemplate:ajaxplorer.user.getActiveRepository());o.set(p,n);ajaxplorer.user.setPreference("columns_size",o,true);ajaxplorer.user.savePreference("columns_size")}.bind(this),2000)}.bind(this));this._sortableTable=new AjxpSortable(oElement,this.getVisibleSortTypes(),$("selectable_div_header"));this._sortableTable.onsort=function(){this.redistributeBackgrounds();var n=ajaxplorer.getContextNode();n.getMetadata().set("filesList.sortColumn",""+this._sortableTable.sortColumn);n.getMetadata().set("filesList.descending",this._sortableTable.descending)}.bind(this);if(this.paginationData&&this.paginationData.get("remote_order")&&parseInt(this.paginationData.get("total"))>1){this._sortableTable.setPaginationBehaviour(function(n){this.reload(n)}.bind(this),this.columnsDef,this.paginationData.get("currentOrderCol")||-1,this.paginationData.get("currentOrderDir"))}this.disableTextSelection($("selectable_div_header"));this.disableTextSelection($("table_rows_container"));this.observer=function(n){fitHeightToBottom($("table_rows_container"),this.htmlElement);if(Prototype.Browser.IE){this._headerResizer.resize($("table_rows_container").getWidth())}else{this._headerResizer.resize($("content_pane").getWidth())}}.bind(this);this.observe("resize",this.observer);if(this.headerMenu){this.headerMenu.destroy();delete this.headerMenu}this.headerMenu=new Proto.Menu({selector:"#selectable_div_header",className:"menu desktop",menuItems:[],fade:true,zIndex:2000,beforeShow:function(){var n=$A([]);this.columnsDef.each(function(p){var o=!this.hiddenColumns.include(p.attributeName);n.push({name:(p.messageId?MessageHash[p.messageId]:p.messageString),alt:(p.messageId?MessageHash[p.messageId]:p.messageString),image:resolveImageSource((o?"column-visible":"transp")+".png","/images/actions/ICON_SIZE",16),isDefault:false,callback:function(q){this.setColumnVisible(p.attributeName,!o)}.bind(this)})}.bind(this));this.headerMenu.options.menuItems=n;this.headerMenu.refreshList()}.bind(this)})}else{if(this._displayMode=="thumb"){if(this.headerMenu){this.headerMenu.destroy();delete this.headerMenu}var c='<div class="panelHeader"><div style="float:right;padding-right:5px;font-size:1px;height:16px;"><input type="image" height="16" width="16" src="'+ajxpResourcesFolder+'/images/actions/16/zoom-in.png" id="slider-input-1" style="border:0px;width:16px;height:16px;margin-top:0px;padding:0px;" value="64"/></div>'+MessageHash[126]+"</div>";c+='<div id="selectable_div" style="overflow:auto; padding:2px 5px;">';this.htmlElement.update(c);attachMobileScroll("selectable_div","vertical");if(this.paginationData&&parseInt(this.paginationData.get("total"))>1){$("selectable_div").insert({before:this.createPaginator()})}this.observer=function(n){fitHeightToBottom($("selectable_div"),this.htmlElement)}.bind(this);this.observe("resize",this.observer);if(ajaxplorer&&ajaxplorer.user&&ajaxplorer.user.getPreference("thumb_size")){this._thumbSize=parseInt(ajaxplorer.user.getPreference("thumb_size"))}if(this._fixedThumbSize){this._thumbSize=parseInt(this._fixedThumbSize)}this.slider=new SliderInput($("slider-input-1"),{range:$R(30,250),sliderValue:this._thumbSize,leftOffset:0,onSlide:function(n){this._thumbSize=n;this.resizeThumbnails()}.bind(this),onChange:function(n){if(!ajaxplorer||!ajaxplorer.user){return}ajaxplorer.user.setPreference("thumb_size",this._thumbSize);ajaxplorer.user.savePreference("thumb_size")}.bind(this)});this.disableTextSelection($("selectable_div"));this.initSelectableItems($("selectable_div"),true)}}this.notify("resize")},createPaginator:function(){var c=parseInt(this.paginationData.get("current"));var b=parseInt(this.paginationData.get("total"));var d=new Element("div").addClassName("paginator");var a=new Element("input",{value:c,className:"paginatorInput"});d.update(MessageHash[331]);d.insert(a);d.insert("/"+b);if(c>1){d.insert({top:this.createPaginatorLink(c-1,"<b>&lt;</b>","Previous")});if(c>2){d.insert({top:this.createPaginatorLink(1,"<b>&lt;&lt;</b>","First")})}}if(b>1&&c<b){d.insert({bottom:this.createPaginatorLink(c+1,"<b>&gt;</b>","Next")});if(c<(b-1)){d.insert({bottom:this.createPaginatorLink(b,"<b>&gt;&gt;</b>","Last")})}}a.observe("focus",function(){this.blockNavigation=true}.bind(this));a.observe("blur",function(){this.blockNavigation=false}.bind(this));a.observe("keydown",function(g){if(g.keyCode==Event.KEY_RETURN){Event.stop(g);var e=parseInt(a.getValue());if(e==c){return}if(e<1||e>b){ajaxplorer.displayMessage("ERROR",MessageHash[335]+" "+b);a.setValue(c);return}var f=ajaxplorer.getContextNode();f.getMetadata().get("paginationData").set("new_page",e);ajaxplorer.updateContextData(f)}}.bind(this));return d},createPaginatorLink:function(b,d,c){var a=ajaxplorer.getContextNode();return new Element("a",{href:"#",style:"font-size:12px;padding:0 7px;",title:c}).update(d).observe("click",function(f){a.getMetadata().get("paginationData").set("new_page",b);ajaxplorer.updateContextData(a);Event.stop(f)}.bind(this))},setColumnsDef:function(a){this.columnsDef=a;if(this._displayMode=="list"){this.initGUI()}},getColumnsDef:function(){return this.columnsDef},setContextualMenu:function(a){this.protoMenu=a},resize:function(){if(this.options.fit&&this.options.fit=="height"){var marginBottom=0;if(this.options.fitMarginBottom){var expr=this.options.fitMarginBottom;try{marginBottom=parseInt(eval(expr))}catch(e){}}fitHeightToBottom(this.htmlElement,(this.options.fitParent?$(this.options.fitParent):null),expr)}if($("table_rows_container")&&Prototype.Browser.IE&&this.gridStyle=="file"){$("table_rows_container").setStyle({width:"100%"})}this.notify("resize")},setFocusBehaviour:function(){this.htmlElement.observe("click",function(){if(ajaxplorer){ajaxplorer.focusOn(this)}}.bind(this))},showElement:function(a){},switchDisplayMode:function(a){if(a){this._displayMode=a}else{if(this._displayMode=="thumb"){this._displayMode="list"}else{this._displayMode="thumb"}}this.pendingSelection=this.getSelectedFileNames();this.initGUI();this.reload();this.pendingSelection=null;this.fireChange();if(ajaxplorer&&ajaxplorer.user){ajaxplorer.user.setPreference("display",this._displayMode);ajaxplorer.user.savePreference("display")}return this._displayMode},getDisplayMode:function(){return this._displayMode},initRows:function(){if(this._displayMode=="thumb"){this.resizeThumbnails();if(this.protoMenu){this.protoMenu.addElements("#selectable_div")}window.setTimeout(this.loadNextImage.bind(this),10)}else{if(this.protoMenu){this.protoMenu.addElements("#table_rows_container")}if(this._headerResizer){this._headerResizer.resize(this.htmlElement.getWidth()-2)}}if(this.protoMenu){this.protoMenu.addElements(".ajxp_draggable")}var b=this.getItems();for(var a=0;a<b.length;a++){this.disableTextSelection(b[a],true)}},loadNextImage:function(){if(this.imagesHash&&this.imagesHash.size()){if(this.loading){return}var b=this.imagesHash.unset(this.imagesHash.keys()[0]);window.loader=new Image();window.loader.editorClass=b.editorClass;window.loader.src=window.loader.editorClass.prototype.getThumbnailSource(b.ajxpNode);var a=function(){var c=b.rowObject.IMAGE_ELEMENT||$(b.index);if(c==null||window.loader==null){return}var d=window.loader.editorClass.prototype.getPreview(b.ajxpNode);d.setAttribute("is_loaded","true");c.parentNode.replaceChild(d,c);b.rowObject.IMAGE_ELEMENT=d;this.resizeThumbnails(b.rowObject);this.loadNextImage()}.bind(this);if(window.loader.readyState&&window.loader.readyState=="complete"){a()}else{window.loader.onload=a}}else{if(window.loader){window.loader=null}}},reload:function(a){if(ajaxplorer.getContextNode()){this.fill(ajaxplorer.getContextNode())}},setPendingSelection:function(a){this._pendingFile=a},fill:function(o){this.imagesHash=new Hash();if(this.protoMenu){this.protoMenu.removeElements(".ajxp_draggable");this.protoMenu.removeElements("#selectable_div")}for(var m=0;m<AllAjxpDroppables.length;m++){var e=AllAjxpDroppables[m];if(this.isItem(e)){Droppables.remove(AllAjxpDroppables[m]);delete (AllAjxpDroppables[m])}}for(m=0;m<AllAjxpDraggables.length;m++){if(AllAjxpDraggables[m]&&AllAjxpDraggables[m].element&&this.isItem(AllAjxpDraggables[m].element)){Element.remove(AllAjxpDraggables[m].element)}}AllAjxpDraggables=$A([]);var s=this.getSelectedItems();var l=this.setItemSelected.bind(this);for(var m=0;m<s.length;m++){l(s[m],false)}this.removeCurrentLines();var q=false;this.gridStyle="file";this.even=false;this._oSortTypes=this.defaultSortTypes;var n=(this.paginationData?true:false);if(o.getMetadata().get("paginationData")){this.paginationData=o.getMetadata().get("paginationData");q=true}else{this.paginationData=null;if(n){q=true}}var h=o.getMetadata().get("client_configs");if(h){var t=XPathSelectSingleNode(h,'component_config[@className="FilesList"]');if(t){q=this.parseComponentConfig(t)}}if(q){this.initGUI()}this.parsingCache=new Hash();var d=o.getChildren();for(var m=0;m<d.length;m++){var c=d[m];var p;if(this._displayMode=="list"){p=this.ajxpNodeToTableRow(c)}else{p=this.ajxpNodeToDiv(c)}p.ajxpNode=c}this.initRows();if(this._displayMode=="list"&&(!this.paginationData||!this.paginationData.get("remote_order"))){this._sortableTable.sortColumn=-1;this._sortableTable.updateHeaderArrows()}if(this._displayMode=="list"&&o.getMetadata().get("filesList.sortColumn")){var b=parseInt(o.getMetadata().get("filesList.sortColumn"));var g=o.getMetadata().get("filesList.descending");this._sortableTable.sort(b,g);this._sortableTable.updateHeaderArrows()}if(ajaxplorer.getContextHolder().getPendingSelection()){var a=ajaxplorer.getContextHolder().getPendingSelection();if(Object.isString(a)){this.selectFile(a)}else{if(a.length){for(var r=0;r<a.length;r++){this.selectFile(a[r],true)}}}this.hasFocus=true;ajaxplorer.getContextHolder().clearPendingSelection()}if(this.hasFocus){window.setTimeout(function(){ajaxplorer.focusOn(this)}.bind(this),200)}},switchCurrentLabelToEdition:function(q){var b=this.getSelectedItems();var s=b[0];var c={top:0,left:0};var a=0;if(this._displayMode=="list"){var n=s.select("span.text_label")[0];var r=s.select("span.list_selectable_span")[0];c.top=1;c.left=20;a=$("table_rows_container").scrollTop}else{var n=s.select("div.thumbLabel")[0];var r=n;c.top=2;c.left=3;a=$("selectable_div").scrollTop}var l=r.cumulativeOffset();var p=n.innerHTML;var m=new Element("input",{value:s.ajxpNode.getLabel("text"),id:"editbox"}).setStyle({zIndex:5000,position:"absolute",marginLeft:0,marginTop:0,height:24});$(document.getElementsByTagName("body")[0]).insert({bottom:m});modal.showContent("editbox",(r.getWidth()-c.left)+"","20",true);m.setStyle({left:l.left+c.left,top:(l.top+c.top-a)});window.setTimeout(function(){m.focus();var t=m.getValue().lastIndexOf(".");if(t==-1){m.select()}else{var v=0;if(m.setSelectionRange){m.setSelectionRange(v,t)}else{if(m.createTextRange){var u=m.createTextRange();u.collapse(true);u.moveStart("character",v);u.moveEnd("character",t);u.select()}}}},300);var e=function(){var t=m.getValue();hideLightBox();modal.close();q(s.ajxpNode,t)};m.observe("keydown",function(t){if(t.keyCode==Event.KEY_RETURN){Event.stop(t);e()}}.bind(this));var g=modal.addSubmitCancel(m,null,false,"after");var h=g.select('input[name="ok"]')[0];h.observe("click",e);var o=m.getWidth()-44;var d=o;if(o<70){m.setStyle({left:l.left+c.left-70+o});d=70}m.setStyle({width:d});g.select("input").invoke("setStyle",{margin:0,width:22,border:0,backgroundColor:"transparent"});g.setStyle({position:"absolute",width:46,zIndex:2500,left:l.left+c.left+o,top:(l.top+c.top-a)-1});var f=function(){n.setStyle({color:""});m.remove();g.remove()};n.setStyle({color:"#ddd"});modal.setCloseAction(f)},ajxpNodeToTableRow:function(ajxpNode){var metaData=ajxpNode.getMetadata();var newRow=document.createElement("tr");var tBody=this.parsingCache.get("tBody")||$(this._htmlElement).select("tbody")[0];this.parsingCache.set("tBody",tBody);metaData.each(function(pair){newRow.setAttribute(pair.key,pair.value);if(Prototype.Browser.IE&&pair.key=="ID"){newRow.setAttribute("ajxp_sql_"+pair.key,pair.value)}});var attributeList;if(!this.parsingCache.get("attributeList")){attributeList=$H();var visibleColumns=this.getVisibleColumns();visibleColumns.each(function(column){attributeList.set(column.attributeName,column)});this.parsingCache.set("attributeList",attributeList)}else{attributeList=this.parsingCache.get("attributeList")}var attKeys=attributeList.keys();for(i=0;i<attKeys.length;i++){var s=attKeys[i];var tableCell=new Element("td");var fullview="";if(this._fullview){fullview=" full"}if(s=="ajxp_label"){var innerSpan=new Element("span",{className:"list_selectable_span",style:"cursor:default;display:block;"}).update('<span id="ajxp_label" class="text_label" style="padding-left:24px; background-repeat:no-repeat;background-position:4 2px;background-image:url(\''+resolveImageSource(metaData.get("icon"),"/images/mimes/ICON_SIZE/",16)+"')\">"+metaData.get("text")+"</span>");innerSpan.ajxpNode=ajxpNode;tableCell.insert(innerSpan);window.setTimeout(function(){if(ajxpNode.getAjxpMime()!="ajxp_recycle"){var newDrag=new AjxpDraggable(innerSpan,{revert:true,ghosting:true,scroll:($("tree_container")?"tree_container":null)},this,"filesList");if(this.protoMenu){this.protoMenu.addElements(innerSpan)}}if(!ajxpNode.isLeaf()){AjxpDroppables.add(innerSpan)}}.bind(this),500)}else{if(s=="ajxp_modiftime"){var date=new Date();date.setTime(parseInt(metaData.get(s))*1000);newRow.ajxp_modiftime=date;tableCell.update('<span class="text_label">'+formatDate(date)+"</span>")}else{var metaValue=metaData.get(s)||"";tableCell.update('<span class="text_label'+fullview+'">'+metaValue+"</span>")}}if(this.gridStyle=="grid"){tableCell.setAttribute("valign","top");tableCell.setStyle({verticalAlign:"top",borderRight:"1px solid #eee"});if(this.even){tableCell.setStyle({borderRightColor:"#fff"})}if(tableCell.innerHTML==""){tableCell.innerHTML="&nbsp;"}}if(this._headerResizer&&!this._headerResizer.options.useCSS3){tableCell.addClassName("resizer_"+i)}newRow.appendChild(tableCell);if(attributeList.get(s).modifier){var modifier=eval(attributeList.get(s).modifier);modifier(tableCell,ajxpNode,"row")}}tBody.appendChild(newRow);if(this.even){$(newRow).addClassName("even")}this.even=!this.even;return newRow},ajxpNodeToDiv:function(ajxpNode){var newRow=new Element("div",{className:"thumbnail_selectable_cell"});var metadata=ajxpNode.getMetadata();var innerSpan=new Element("span",{style:"cursor:default;"});var editors=ajaxplorer.findEditorsForMime(ajxpNode.getAjxpMime());var textNode=ajxpNode.getLabel();var img=AbstractEditor.prototype.getPreview(ajxpNode);var label=new Element("div",{className:"thumbLabel",title:textNode}).update(textNode);innerSpan.insert({bottom:img});innerSpan.insert({bottom:label});newRow.insert({bottom:innerSpan});newRow.IMAGE_ELEMENT=img;newRow.LABEL_ELEMENT=label;this._htmlElement.insert(newRow);var modifiers;if(!this.parsingCache.get("modifiers")){modifiers=$A();this.columnsDef.each(function(column){if(column.modifier){try{modifiers.push(eval(column.modifier))}catch(e){}}});this.parsingCache.set("modifiers",modifiers)}else{modifiers=this.parsingCache.get("modifiers")}modifiers.each(function(el){el(newRow,ajxpNode,"thumb")});if(editors&&editors.length){this._crtImageIndex++;var imgIndex=this._crtImageIndex;img.writeAttribute("is_loaded","false");img.writeAttribute("id","ajxp_image_"+imgIndex);var crtIndex=this._crtImageIndex;ajaxplorer.loadEditorResources(editors[0].resourcesManager);var editorClass=Class.getByName(editors[0].editorClass);if(editorClass){var oImageToLoad={index:"ajxp_image_"+crtIndex,ajxpNode:ajxpNode,editorClass:editorClass,rowObject:newRow};this.imagesHash.set(oImageToLoad.index,oImageToLoad)}}if(!ajxpNode.isRecycle()){window.setTimeout(function(){var newDrag=new AjxpDraggable(newRow,{revert:true,ghosting:true,scroll:($("tree_container")?"tree_container":null)},this,"filesList")}.bind(this),500)}if(!ajxpNode.isLeaf()){AjxpDroppables.add(newRow)}return newRow},resizeThumbnails:function(c){var b=5;var a;if(c){a=[c]}else{a=this._htmlElement.getElementsBySelector(".thumbnail_selectable_cell")}a.each(function(h){var f=h.ajxpNode;var r=h.IMAGE_ELEMENT||h.select("img")[0];var o=h.LABEL_ELEMENT||h.select(".thumbLabel")[0];var g=this._thumbSize;var s,m,l,e;if(r.resizePreviewElement&&r.getAttribute("is_loaded")=="true"){r.resizePreviewElement({width:g,height:g,margin:b})}else{if(g>=64){s=m=64;l=parseInt((g-64)/2)+b;e=g+(b*2)-m-l-1}else{s=m=g;l=e=b}r.setStyle({width:s+"px",height:m+"px",marginTop:l+"px",marginBottom:e+"px"})}h.setStyle({width:g+25+"px",height:g+30+"px"});var n=g+25;var d=6;var p=parseInt(n/d);var q=new String(o.getAttribute("title"));o.innerHTML=q.truncate(p,"...")}.bind(this))},redistributeBackgrounds:function(){var b=this.getItems();this.even=false;for(var a=0;a<b.length;a++){if(this.even){$(b[a]).addClassName("even").removeClassName("odd")}else{$(b[a]).removeClassName("even").addClassName("odd")}this.even=!this.even}},removeCurrentLines:function(){var a;if(this._displayMode=="list"){a=$(this._htmlElement).select("tr")}else{if(this._displayMode=="thumb"){a=$(this._htmlElement).select("div")}}for(i=0;i<a.length;i++){try{a[i].innerHTML="";if(a[i].IMAGE_ELEMENT){a[i].IMAGE_ELEMENT=null;delete (a[i].IMAGE_ELEMENT)}}catch(b){}if(a[i].parentNode){a[i].remove()}}this.fireChange()},setOnLoad:function(){if(this.loading){return}addLightboxMarkupToElement(this.htmlElement);var a=new Element("img",{src:ajxpResourcesFolder+"/images/loadingImage.gif"});var b=$(this.htmlElement).down("#element_overlay");b.insert(a);a.setStyle({marginTop:Math.max(0,(b.getHeight()-a.getHeight())/2)});this.loading=true},removeOnLoad:function(){removeLightboxFromElement(this.htmlElement);this.loading=false},fireChange:function(){if(this._fireChange){ajaxplorer.updateContextData(null,this.getSelectedNodes(),this)}},fireDblClick:function(b){if(ajaxplorer.getContextNode().getAjxpMime()=="ajxp_recycle"){return}selRaw=this.getSelectedItems();if(!selRaw||!selRaw.length){return}var a=selRaw[0].ajxpNode;if(a.isLeaf()){ajaxplorer.getActionBar().fireDefaultAction("file")}else{ajaxplorer.getActionBar().fireDefaultAction("dir",a)}},getSelectedFileNames:function(){selRaw=this.getSelectedItems();if(!selRaw.length){return}var a=new Array(selRaw.length);for(i=0;i<selRaw.length;i++){a[i]=selRaw[i].getAttribute("filename")}return a},getFilesCount:function(){return this.getItems().length},fileNameExists:function(c){var b=this.getItems();if(!b.length){return false}for(i=0;i<b.length;i++){var a=getBaseName(b[i].getAttribute("filename"));if(a&&a.toLowerCase()==getBaseName(c).toLowerCase()){return true}}return false},getFileNames:function(d){var a=$A([]);var c=this.getItems();for(var b=0;b<c.length;b++){a.push(getBaseName(c[b].getAttribute("filename")))}if(d){return a.join(d)}else{return a.toArray()}},selectFile:function(d,a){d=getBaseName(d);if(!this.fileNameExists(d)){return}var c=this.getItems();for(var b=0;b<c.length;b++){if(getBaseName(c[b].getAttribute("filename"))==getBaseName(d)){this.setItemSelected(c[b],true)}else{if(a==null){this.setItemSelected(c[b],false)}}}return},getCurrentRep:function(){return ajaxplorer.getContextNode().getPath()},enableTextSelection:function(a){if(a.origOnSelectStart){a.onselectstart=a.origOnSelectStart}a.unselectable="off";a.style.MozUserSelect="text"},disableTextSelection:function(b,a){if(b.onselectstart){b.origOnSelectStart=b.onselectstart;b.onselectstart=function(){return false}}b.unselectable="on";b.style.MozUserSelect="none";$(b).addClassName("no_select_bg");if(a){$(b).select("td,img,div,span").each(function(c){this.disableTextSelection(c)}.bind(this))}},keydown:function(d){if(this.blockNavigation){return false}if(d.keyCode==9&&!ajaxplorer.blockNavigation){return false}if(!this.hasFocus){return true}var q=d.keyCode;if(this._displayMode=="list"&&q!=Event.KEY_UP&&q!=Event.KEY_DOWN&&q!=Event.KEY_RETURN&&q!=Event.KEY_END&&q!=Event.KEY_HOME){return true}if(this._displayMode=="thumb"&&q!=Event.KEY_UP&&q!=Event.KEY_DOWN&&q!=Event.KEY_LEFT&&q!=Event.KEY_RIGHT&&q!=Event.KEY_RETURN&&q!=Event.KEY_END&&q!=Event.KEY_HOME){return true}var m=this._selectedItems;if(m.length==0){return false}var b=this._fireChange;this._fireChange=false;var l=this.getSelectedItems();Event.stop(d);var c;var p;var n=d.shiftKey;p=m[m.length-1];var h=this.getItems();var o=this.getItemIndex(p);var a=false;if(d.keyCode==Event.KEY_RETURN){for(var g=0;g<m.length;g++){this.setItemSelected(m[g],false)}this.setItemSelected(p,true);this.fireDblClick(null);this._fireChange=b;return false}if(d.keyCode==Event.KEY_END){c=h[h.length-1];if(n&&this._multiple){a=true;nextItemIndex=h.length-1}}else{if(d.keyCode==Event.KEY_HOME){c=h[0];if(n&&this._multiple){a=true;nextItemIndex=0}}else{if(d.keyCode==Event.KEY_UP){if(this._displayMode=="list"){c=this.getPrevious(p)}else{nextItemIndex=this.findOverlappingItem(o,false);if(nextItemIndex!=null){c=h[nextItemIndex];a=true}}}else{if(d.keyCode==Event.KEY_LEFT){c=this.getPrevious(p)}else{if(d.keyCode==Event.KEY_DOWN){if(this._displayMode=="list"){c=this.getNext(p)}else{nextItemIndex=this.findOverlappingItem(o,true);if(nextItemIndex!=null){c=h[nextItemIndex];a=true}}}else{if(d.keyCode==Event.KEY_RIGHT){c=this.getNext(p)}}}}}}if(c==null){this._fireChange=b;return false}if(!n||!this._multiple){for(var g=0;g<m.length;g++){this.setItemSelected(m[g],false)}}else{if(a){if(nextItemIndex>=o){for(var g=o+1;g<nextItemIndex;g++){this.setItemSelected(h[g],!h[g]._selected)}}else{for(var g=nextItemIndex+1;g<o;g++){this.setItemSelected(h[g],!h[g]._selected)}}}}this.setItemSelected(c,!c._selected);var r;var f=l.length!=this._selectedItems.length;if(!f){for(var g=0;g<l.length;g++){r=false;for(var e=0;e<this._selectedItems.length;e++){if(l[g]==this._selectedItems[e]){r=true;break}}if(!r){f=true;break}}}this._fireChange=b;if(f&&this._fireChange){this.fireChange()}return false},findOverlappingItem:function(h,e){if(!e&&h==0){return}var d=this.getItems();if(e&&h==d.length-1){return}var c=$(d[h]);var f=Position.cumulativeOffset(c);var g=Element.getDimensions(c);var a=f[0]+parseInt(g.width/2);if(e){var l=f[1]+parseInt(g.height*3/2);for(var b=h+1;b<d.length;b++){if(Position.within($(d[b]),a,l)){return b}}return null}else{var l=f[1]-parseInt(g.height/2);for(var b=h-1;b>-1;b--){if(Position.within($(d[b]),a,l)){return b}}return null}},isItem:function(a){if(this._displayMode=="list"){return a!=null&&(a.tagName=="TR"||a.tagName=="tr")&&(a.parentNode.tagName=="TBODY"||a.parentNode.tagName=="tbody")&&a.parentNode.parentNode==this._htmlElement}if(this._displayMode=="thumb"){return a!=null&&(a.tagName=="DIV"||a.tagName=="div")&&a.parentNode==this._htmlElement}},getItems:function(){if(this._displayMode=="list"){return this._htmlElement.rows}if(this._displayMode=="thumb"){var d=[];var b=0;var e=this._htmlElement.childNodes;var a=e.length;for(var c=0;c<a;c++){if(e[c].nodeType==1){d[b++]=e[c]}}return d}},getItemIndex:function(e){if(this._displayMode=="list"){return e.rowIndex}if(this._displayMode=="thumb"){var b=0;var d=this._htmlElement.childNodes;var a=d.length;for(var c=0;c<a;c++){if(d[c]==e){return b}if(d[c].nodeType==1){b++}}return -1}},getItem:function(a){if(this._displayMode=="list"){return this._htmlElement.rows[a]}if(this._displayMode=="thumb"){var c=0;var e=this._htmlElement.childNodes;var b=e.length;for(var d=0;d<b;d++){if(e[d].nodeType==1){if(c==a){return e[d]}c++}}return null}}});Class.create("FoldersTree",AjxpPane,{__implements:["IFocusable","IContextMenuable"],initialize:function($super,c,b){$super(c);this.treeContainer=new Element("div",{id:"tree_container",style:"overflow:auto;height:100%;width:100%;"});c.insert(this.treeContainer);disableTextSelection(this.treeContainer);this.options={};if(b){this.options=b}var a=this;var f=function(g){if(!ajaxplorer){return}ajaxplorer.focusOn(a);if(this.ajxpNode){ajaxplorer.actionBar.fireDefaultAction("dir",this.ajxpNode)}};var d=this.createFilter();var e=new AjxpNode("/",true,MessageHash[391],"folder.png");e._isLoaded=true;this.tree=new AJXPTree(e,f,d);this.treeContainer.update(this.tree.toString());$(this.tree.id).ajxpNode=this.tree.ajxpNode;$(this.tree.id).observe("click",function(g){this.action(g);Event.stop(g)}.bind(this.tree));AjxpDroppables.add(this.tree.id);if(!this.tree.open&&!this.tree.loading){this.tree.toggle()}this.treeContainer.observe("click",function(){ajaxplorer.focusOn(this)}.bind(this));this.rootNodeId=this.tree.id;this.hasFocus;document.observe("ajaxplorer:context_changed",function(g){var h=g.memo.getPath();window.setTimeout(function(l){this.setSelectedPath(h)}.bind(this),100)}.bind(this));document.observe("ajaxplorer:root_node_changed",function(g){var h=g.memo;this.tree.setAjxpRootNode(h);this.changeRootLabel(h.getLabel(),h.getIcon())}.bind(this));document.observe("ajaxplorer:component_config_changed",function(m){if(m.memo.className=="FoldersTree"){var h=m.memo.classConfig.get("all");var g=XPathSelectNodes(h,"property");for(var l=0;l<g.length;l++){this.options[g[l].getAttribute("name")]=g[l].getAttribute("value")}if(this.tree){this.tree.filter=this.createFilter()}}}.bind(this))},createFilter:function(){var g=this.options.display||"dz";if(g.indexOf("a")>-1){g="dzf"}if(g.indexOf("z")>-1&&window.zipEnabled===false){g=g.split("z").join("")}this.options.display=g;var e=(g.indexOf("d")>-1);var c=(g.indexOf("z")>-1);var b=(g.indexOf("f")>-1);var a=function(d){return(((e&&!d.isLeaf())||(b&&d.isLeaf())||(c&&(d.getAjxpMime()=="zip"||d.getAjxpMime()=="ajxp_browsable_archive")))&&(d.getParent().getAjxpMime()!="ajxp_recycle"))};return a},focus:function(){if(webFXTreeHandler.selected){webFXTreeHandler.selected.focus()}webFXTreeHandler.setFocus(true);this.hasFocus=true},blur:function(){if(webFXTreeHandler.selected){webFXTreeHandler.selected.blur()}webFXTreeHandler.setFocus(false);this.hasFocus=false},resize:function(){fitHeightToBottom(this.treeContainer,null)},showElement:function(a){if(a){this.treeContainer.show()}else{this.treeContainer.hide()}},setContextualMenu:function(protoMenu){Event.observe(this.rootNodeId+"-anchor","contextmenu",function(e){eval(this.action)}.bind(webFXTreeHandler.all[this.rootNodeId]));protoMenu.addElements("#"+this.rootNodeId+"-anchor");webFXTreeHandler.contextMenu=protoMenu},getNodeByPath:function(b){for(var a in webFXTreeHandler.all){if(webFXTreeHandler.all[a]&&webFXTreeHandler.all[a].ajxpNode&&webFXTreeHandler.all[a].ajxpNode.getPath()==b){return webFXTreeHandler.all[a]}}},setSelectedPath:function(e){if(e==""||e=="/"){this.tree.select();return}var d=this.cleanPathToArray(e);var a="";for(var b=0;b<d.length;b++){a+="/"+d[b];var c=this.getNodeByPath(a);if(c&&c.childNodes.length){c._webfxtree_expand()}}if(c){c.select()}},cleanPathToArray:function(c){var a=c.split("/");var d=new Array();var b=0;for(i=0;i<a.length;i++){if(a[i]!=""){d[b]=a[i];b++}}return d},changeRootLabel:function(b,a){this.changeNodeLabel(this.tree.id,b,a)},changeNodeLabel:function(e,b,a){var d=$(e+"-label").update(b);if(a){var c=webFXTreeHandler.all[e];c.icon=a;c.openIcon=a}}});Class.create("SearchEngine",AjxpPane,{htmlElement:undefined,_inputBox:undefined,_resultsBox:undefined,_searchButtonName:undefined,state:"idle",_runningQueries:undefined,_queriesIndex:0,_ajxpOptions:undefined,_queue:undefined,initialize:function($super,b,a){$super($(b));if(a){this._ajxpOptions=a}this.initGUI()},initGUI:function(){if(!this.htmlElement){return}this.htmlElement.update('<div id="search_form"><input style="float:left;" type="text" id="search_txt" name="search_txt" onfocus="blockEvents=true;" onblur="blockEvents=false;"><a href="" id="search_button" ajxp_message_title_id="184" title="'+MessageHash[184]+'"><img width="16" height="16" align="absmiddle" src="'+ajxpResourcesFolder+'/images/actions/16/search.png" border="0"/></a><a href="" id="stop_search_button" ajxp_message_title_id="185" title="'+MessageHash[185]+'"><img width="16" height="16" align="absmiddle" src="'+ajxpResourcesFolder+'/images/actions/16/fileclose.png" border="0" /></a></div><div id="search_results"></div>');this.metaOptions=[];if(this._ajxpOptions&&this._ajxpOptions.metaColumns){var b=this._ajxpOptions.metaColumns;$("search_form").insert({bottom:'<div id="search_meta">'+MessageHash[344]+' : <span id="search_meta_options"></span></div>'});this.initMetaOption($("search_meta_options"),"filename","Filename",true);for(var a in b){this.initMetaOption($("search_meta_options"),a,b[a])}}else{$("search_form").insert('<div style="clear:left;height:9px;"></div>')}this._inputBox=$("search_txt");this._resultsBoxId="search_results";this._searchButtonName="search_button";this._runningQueries=new Array();this._queue=$A([]);$("stop_"+this._searchButtonName).addClassName("disabled");this.htmlElement.select("a",'div[id="search_results"]').each(function(c){disableTextSelection(c)});this._inputBox.onkeypress=function(c){if(c==null){c=window.event}if(c.keyCode==13){this.search();Event.stop(c)}if(c.keyCode==9){return false}}.bind(this);this._inputBox.onkeydown=function(c){if(c==null){c=window.event}if(c.keyCode==9){return false}return true};this._inputBox.onfocus=function(c){ajaxplorer.disableShortcuts();this.hasFocus=true;this._inputBox.select();return false}.bind(this);this._inputBox.onblur=function(c){ajaxplorer.enableShortcuts();this.hasFocus=false}.bind(this);$(this._searchButtonName).onclick=function(){this.search();return false}.bind(this);$("stop_"+this._searchButtonName).onclick=function(){this.interrupt();return false}.bind(this);this.resize()},showElement:function(a){if(!this.htmlElement){return}if(a){this.htmlElement.show()}else{this.htmlElement.hide()}},resize:function(){fitHeightToBottom($(this._resultsBoxId));if(this.htmlElement&&this.htmlElement.visible()){this._inputBox.setStyle({width:Math.max((this.htmlElement.getWidth()-70),70)+"px"})}},initMetaOption:function(a,e,d,c){var b=new Element("meta_opt",{value:e}).update(d);if(c){b.addClassName("checked")}if(a.childElements().length){a.insert(", ")}a.insert(b);b.observe("click",function(f){b.toggleClassName("checked")});this.metaOptions.push(b)},hasMetaSearch:function(){var a=false;this.metaOptions.each(function(b){if(b.getAttribute("value")!="filename"&&b.hasClassName("checked")){a=true}});return a},getSearchColumns:function(){var a=$A();this.metaOptions.each(function(b){if(b.hasClassName("checked")){a.push(b.getAttribute("value"))}});return a},focus:function(){if(this.htmlElement&&this.htmlElement.visible()){this._inputBox.activate();this.hasFocus=true}},blur:function(){if(this._inputBox){this._inputBox.blur()}this.hasFocus=false},search:function(){var b=this._inputBox.value;if(b==""){return}this.crtText=b.toLowerCase();this.updateStateSearching();this.clearResults();var a=ajaxplorer.getContextNode().getPath();if(a=="/"){a=""}window.setTimeout(function(){this.searchFolderContent(a)}.bind(this),0)},interrupt:function(){if(this._state=="idle"){return}this._state="interrupt";this._queue=$A()},updateStateSearching:function(){this._state="searching";$(this._searchButtonName).addClassName("disabled");$("stop_"+this._searchButtonName).removeClassName("disabled")},updateStateFinished:function(a){this._state="idle";this._inputBox.disabled=false;$(this._searchButtonName).removeClassName("disabled");$("stop_"+this._searchButtonName).addClassName("disabled")},clear:function(){this.clearResults();if(this._inputBox){this._inputBox.value=""}},clearResults:function(){while($(this._resultsBoxId).childNodes.length){$(this._resultsBoxId).removeChild($(this._resultsBoxId).childNodes[0])}},addResult:function(a,l,f){var c=l.getLabel();var g=l.getIcon();if(a==""){a="/"}var h=false;if(g==null){h=true;g="folder.png";if(a!="/"){a+="/"}a+=c}var e='<img align="absmiddle" width="16" height="16" src="'+ajxpResourcesFolder+"/images/mimes/16/"+g+'"> ';var d;if(f){d=c+" ("+this.highlight(f,this.crtText,20)+") "}else{d=this.highlight(c,this.crtText)}var b=new Element("div",{title:MessageHash[224]+" "+a}).update(e+d);$(this._resultsBoxId).insert(b);if(h){b.observe("click",function(m){ajaxplorer.goTo(a)})}else{b.observe("click",function(m){ajaxplorer.getContextHolder().setPendingSelection(c);ajaxplorer.goTo(a)})}},appendFolderToQueue:function(a){this._queue.push(a)},searchNext:function(){if(this._queue.length){var a=this._queue.first();this._queue.shift();this.searchFolderContent(a)}else{this.updateStateFinished()}},searchFolderContent:function(a){if(this._state=="interrupt"){this.updateStateFinished();return}var b=new Connexion();b.addParameter("get_action","ls");b.addParameter("options","a"+(this.hasMetaSearch()?"l":""));b.addParameter("dir",a);b.onComplete=function(c){this._parseXmlAndSearchString(c.responseXML,a);this.searchNext()}.bind(this);b.sendAsync()},_parseXmlAndSearchString:function(a,d){if(this._state=="interrupt"){this.updateStateFinished();return}if(a==null||a.documentElement==null){}else{var b=XPathSelectNodes(a.documentElement,"tree");for(var c=0;c<b.length;c++){if(b[c].tagName=="tree"){var f=this.parseAjxpNode(b[c]);this._searchNode(f,d);if(!f.isLeaf()){var e=f.getPath();this.appendFolderToQueue(e)}}}}},_searchNode:function(e,b){var d=true;var c;if(this.hasMetaSearch()){c=this.getSearchColumns();if(!c.indexOf("filename")){d=false}}if(d&&e.getLabel().toLowerCase().indexOf(this.crtText)!=-1){this.addResult(b,e);return}if(!c){return}for(var a=0;a<c.length;a++){var f=e.getMetadata().get(c[a]);if(f&&f.toLowerCase().indexOf(this.crtText)!=-1){this.addResult(b,e,f);return}}},parseAjxpNode:function(d){var e=new AjxpNode(d.getAttribute("filename"),(d.getAttribute("is_file")=="1"||d.getAttribute("is_file")=="true"),d.getAttribute("text"),d.getAttribute("icon"));var a=["filename","is_file","text","icon"];var c=new Hash();for(var b=0;b<d.attributes.length;b++){c.set(d.attributes[b].nodeName,d.attributes[b].nodeValue);if(Prototype.Browser.IE&&d.attributes[b].nodeName=="ID"){c.set("ajxp_sql_"+d.attributes[b].nodeName,d.attributes[b].nodeValue)}}e.setMetadata(c);return e},highlight:function(h,e,g){var a=h.toLowerCase().indexOf(e);var d=a+e.length;if(g&&h.length>g){var l=Math.round(g/2);var f=Math.max(Math.round((d+a)/2-g/2),0);var c=Math.min(Math.round((d+a)/2+g/2),h.length);h=h.substring(f,c);if(f>0){h="..."+h}if(c<h.length){h=h+"..."}a=h.toLowerCase().indexOf(e);d=a+e.length}var b=h.substring(0,a)+"<em>"+h.substring(a,d)+"</em>"+h.substring(d);return b}});Class.create("InfoPanel",AjxpPane,{initialize:function($super,a){$super(a);attachMobileScroll(a,"vertical");disableTextSelection(a);this.setContent("<br><br><center><i>"+MessageHash[132]+"</i></center>");this.mimesTemplates=new Hash();this.registeredMimes=new Hash();document.observe("ajaxplorer:actions_refreshed",this.update.bind(this));document.observe("ajaxplorer:component_config_changed",function(b){if(b.memo.className=="InfoPanel"){this.parseComponentConfig(b.memo.classConfig.get("all"))}}.bind(this));document.observe("ajaxplorer:user_logged",this.clearPanels.bind(this))},clearPanels:function(){this.mimesTemplates=new Hash();this.registeredMimes=new Hash()},empty:function(){this.setContent("")},update:function(){if(!this.htmlElement){return}var r=ajaxplorer.getUserSelection();var d=r.getContextNode();this.empty();if(!d){return}if(r.isEmpty()){var l;if(r.getContextNode()){l=getBaseName(r.getContextNode().getPath())}if(l==""){l=$("repo_path").value}var h=r.getContextNode().getChildren();var q=0;var a=0;var o=0;for(var c=0;c<h.length;c++){if(!h[c].isLeaf()){a++}else{o++}var b=h[c].getMetadata();if(b.get("bytesize")&&b.get("bytesize")!=""){q+=parseInt(b.get("bytesize"))}}this.evalTemplateForMime("no_selection",null,{filelist_folders_count:a,filelist_files_count:o,filelist_totalsize:roundSize(q,(MessageHash?MessageHash[266]:"B")),current_folder:l});try{if(!a&&$(this.htmlElement).select('[id="filelist_folders_count"]').length){$(this.htmlElement).select('[id="filelist_folders_count"]')[0].hide()}if(!o&&$(this.htmlElement).select('[id="filelist_files_count').length){$(this.htmlElement).select('[id="filelist_files_count"]')[0].hide()}if(!q&&$(this.htmlElement).select('[id="filelist_totalsize"]').length){$(this.htmlElement).select('[id="filelist_totalsize"]')[0].hide()}}catch(g){}this.addActions("empty");return}if(!r.isUnique()){this.setContent("<br><br><center><i>"+r.getFileNames().length+" "+MessageHash[128]+"</i></center><br><br>");this.addActions("multiple");return}var f=r.getUniqueNode();var m=false;if(f){m=f.isLeaf()}this.evalTemplateForMime((m?"generic_file":"generic_dir"),f);var n=getAjxpMimeType(f);if(n!=""&&this.registeredMimes.get(n)){this.evalTemplateForMime(n,f)}this.addActions("unique");var p=this.htmlElement.select('div[id="preview_rich_fake_element"]');if(p&&p.length){this.currentPreviewElement=this.getPreviewElement(f,false);$(p[0]).replace(this.currentPreviewElement);this.resize()}},setContent:function(a){if(!this.htmlElement){return}this.htmlElement.update(a)},showElement:function(a){if(!this.htmlElement){return}if(a){this.htmlElement.show()}else{this.htmlElement.hide()}},resize:function(){fitHeightToBottom(this.htmlElement,null);if(this.currentPreviewElement&&this.currentPreviewElement.visible()){var a=Math.min(parseInt(this.htmlElement.getWidth()-40));this.currentPreviewElement.resizePreviewElement({width:a,height:a,maxHeight:150})}},evalTemplateForMime:function(mimeType,fileNode,tArgs){if(!this.htmlElement){return}if(!this.registeredMimes.get(mimeType)){return}var registeredTemplates=this.registeredMimes.get(mimeType);for(var i=0;i<registeredTemplates.length;i++){var templateData=this.mimesTemplates.get(registeredTemplates[i]);var tString=templateData[0];var tAttributes=templateData[1];var tMessages=templateData[2];var tModifier=templateData[3];if(!tArgs){tArgs=new Object()}var panelWidth=this.htmlElement.getWidth();var oThis=this;if(fileNode){var metadata=fileNode.getMetadata();tAttributes.each(function(attName){if(attName=="basename"&&metadata.get("filename")){this[attName]=getBaseName(metadata.get("filename"))}else{if(attName=="compute_image_dimensions"){if(metadata.get("image_width")&&metadata.get("image_height")){var width=metadata.get("image_width");var height=metadata.get("image_height");var newHeight=150;if(height<newHeight){newHeight=height}var newWidth=newHeight*width/height;var dimAttr='height="'+newHeight+'"';if(newWidth>panelWidth-16){dimAttr='width="100%"'}}else{dimAttr='height="64" width="64"'}this[attName]=dimAttr}else{if(attName=="preview_rich"){this[attName]=oThis.getPreviewElement(fileNode,true)}else{if(attName=="encoded_filename"&&metadata.get("filename")){this[attName]=encodeURIComponent(metadata.get("filename"))}else{if(attName=="escaped_filename"&&metadata.get("filename")){this[attName]=escape(encodeURIComponent(metadata.get("filename")))}else{if(attName=="formated_date"&&metadata.get("ajxp_modiftime")){var modiftime=metadata.get("ajxp_modiftime");if(modiftime instanceof Object){this[attName]=formatDate(modiftime)}else{var date=new Date();date.setTime(parseInt(metadata.get("ajxp_modiftime"))*1000);this[attName]=formatDate(date)}}else{if(attName=="uri"){var url=document.location.href;if(url[(url.length-1)]=="/"){url=url.substr(0,url.length-1)}else{if(url.lastIndexOf("/")>-1){url=url.substr(0,url.lastIndexOf("/"))}}this[attName]=url}else{if(metadata.get(attName)){this[attName]=metadata.get(attName)}else{this[attName]=""}}}}}}}}}.bind(tArgs))}tMessages.each(function(pair){this[pair.key]=MessageHash[pair.value]}.bind(tArgs));var template=new Template(tString);this.htmlElement.insert(template.evaluate(tArgs));if(tModifier){var modifierFunc=eval(tModifier);modifierFunc(this.htmlElement)}}},addActions:function(a){var c=ajaxplorer.actionBar.getActionsForAjxpWidget("InfoPanel",this.htmlElement.id);if(!c.length){return}var d='<div class="panelHeader infoPanelGroup">'+MessageHash[5]+'</div><div class="infoPanelActions">';var b=0;c.each(function(e){if(a=="empty"&&e.context.selection){return}if(a=="multiple"&&e.selectionContext.unique){return}if(a=="unique"&&(!e.context.selection||e.selectionContext.multipleOnly)){return}d+='<a href="" onclick="ajaxplorer.actionBar.fireAction(\''+e.options.name+'\');return false;"><img src="'+resolveImageSource(e.options.src,"/images/actions/ICON_SIZE",16)+'" width="16" height="16" align="absmiddle" border="0"> '+e.options.title+"</a>";b++}.bind(this));d+="</div>";if(!b){return}this.htmlElement.insert(d)},getPreviewElement:function(e,d){var c=ajaxplorer.findEditorsForMime(e.getAjxpMime());if(c&&c.length){ajaxplorer.loadEditorResources(c[0].resourcesManager);var a=Class.getByName(c[0].editorClass);if(a){if(d){return'<div id="preview_rich_fake_element"></div>'}else{var b=a.prototype.getPreview(e,true);return b}}}return'<img src="'+resolveImageSource(e.getIcon(),"/images/mimes/ICON_SIZE",64)+'" height="64" width="64">'},parseComponentConfig:function(a){var n=XPathSelectNodes(a,"infoPanel|infoPanelExtension");for(var g=0;g<n.length;g++){var m=n[g].getAttribute("mime");var e=$A(n[g].getAttribute("attributes").split(","));var d=new Hash();var b=n[g].getAttribute("modifier")||"";var f="";var c=n[g].childNodes;for(j=0;j<c.length;j++){if(c[j].nodeName=="messages"){var l=c[j].childNodes;for(k=0;k<l.length;k++){if(l[k].nodeName!="message"){continue}d.set(l[k].getAttribute("key"),parseInt(l[k].getAttribute("id")))}}else{if(c[j].nodeName=="html"){f=c[j].firstChild.nodeValue}}}var h=hex_md5(f);if(this.mimesTemplates.get(h)){continue}this.mimesTemplates.set(h,$A([f,e,d,b]));$A(m.split(",")).each(function(o){var p=this.registeredMimes.get(o)||$A([]);p.push(h);this.registeredMimes.set(o,p)}.bind(this))}}});Class.create("PropertyPanel",{initialize:function(a,b){this.rights=["4","2","1"];this.accessors=["u","g","a"];this.accessLabels=[MessageHash[288],MessageHash[289],MessageHash[290]];this.rightsLabels=["r","w","x"];this.htmlElement=$(b).select("[id='properties_box']")[0];if(a.isUnique()){this.origValue=a.getUniqueNode().getMetadata().get("file_perms")}else{this.origValue=""}this.createChmodForm();this.valueInput.observe((Prototype.Browser.IE?"change":"input"),function(c){this.updateBoxesFromValue(this.valueInput.value)}.bind(this));this.updateBoxesFromValue(this.valueInput.value);if(a.hasDir()){this.createRecursiveBox()}},valueChanged:function(){return(this.origValue!=this.valueInput.value)},createChmodForm:function(){this.checks=$H({});var m=new Element("table",{style:"font-size:11px;"});var n=new Element("thead");var l=new Element("tbody");m.insert(n);m.insert(l);var g=new Element("tr");var c=new Element("td");g.insert(c);n.insert(g);for(var e=0;e<3;e++){g.insert(new Element("td").update(this.rightsLabels[e]+"&nbsp;&nbsp;").setStyle({textAlign:"center"}))}for(var f=0;f<3;f++){var d=new Element("tr");var h=new Element("td").setStyle({textAlign:"right",paddingRight:"2px",width:"35px"});h.insert(this.accessLabels[f]);l.insert(d);d.insert(h);for(var e=0;e<3;e++){var b=this.createCheckBox(this.accessors[f],this.rights[e]);d.insert(b)}}this.valueInput=new Element("input",{value:this.origValue,name:"chmod_value"}).setStyle({width:"95%"});var a=new Element("tr");l.insert(a);a.insert(new Element("td"));a.insert(new Element("td",{colspan:3}).update(this.valueInput));this.htmlElement.insert(m)},createCheckBox:function(a,b){var c=new Element("input",{type:"checkbox",id:a+"_"+b}).setStyle({width:"14px",height:"14px",borderWidth:"0"});var d=new Element("td",{align:"center"}).insert(c).setStyle({width:"25px"});c.observe("click",function(f){this.updateValueFromBoxes()}.bind(this));this.checks.set(a+"_"+b,c);return d},createRecursiveBox:function(){var g=new Element("div",{style:"padding-top:8px;"});var b=new Element("input",{type:"checkbox",name:"recursive"}).setStyle({width:"14px",height:"14px",borderWidth:"0"});g.insert(b);g.insert(MessageHash[291]);this.htmlElement.insert(g);var f={both:"Both",file:"Files",dir:"Folders"};var e=new Element("div");g.insert(e);for(var c in f){var d=new Element("div",{style:"padding-left:25px"});var a=new Element("input",{type:"radio",name:"recur_apply_to",value:c,style:"width:25px;border:0;"});d.insert(a);if(c=="both"){a.checked=true}d.insert(f[c]);e.insert(d)}e.hide();b.observe("click",function(h){if(b.checked){e.show()}else{e.hide()}modal.refreshDialogAppearance()})},updateValueFromBoxes:function(){var b="0";for(var a=0;a<3;a++){b=b+this.updateValueForAccessor(this.accessors[a])}this.valueInput.value=b},updateValueForAccessor:function(a){var c=0;for(var b=0;b<3;b++){c+=(this.checks.get(a+"_"+this.rights[b]).checked?parseInt(this.rights[b]):0)}return c},updateBoxesFromValue:function(b){if(b.length!=4){return}for(var a=0;a<3;a++){this.valueToBoxes(parseInt(b.charAt(a+1)),this.accessors[a])}},valueToBoxes:function(d,a){for(var b=0;b<3;b++){this.checks.get(a+"_"+this.rights[b]).checked=false}if(d==0){return}var c=$A([]);switch(d){case 1:c.push("1");break;case 2:c.push("2");break;case 3:c.push("1");c.push("2");break;case 4:c.push("4");break;case 5:c.push("4");c.push("1");break;case 6:c.push("4");c.push("2");break;case 7:c.push("2");c.push("4");c.push("1");break}c.each(function(e){this.checks.get(a+"_"+e).checked=true}.bind(this))}});Class.create("AbstractEditor",{defaultActions:new Hash(),toolbarSeparator:'<div class="separator"></div>',fullScreenMode:false,editorOptions:new Hash({fullscreen:true,closable:true,floatingToolbar:false}),initialize:function(a){this.element=$(a);this.defaultActions=new Hash({fs:'<a id="fsButton"><img src="'+ajxpResourcesFolder+'/images/actions/22/window_fullscreen.png"  width="22" height="22" alt="" border="0"><br><span message_id="235"></span></a>',nofs:'<a id="nofsButton" style="display:none;"><img src="'+ajxpResourcesFolder+'/images/actions/22/window_nofullscreen.png"  width="22" height="22" alt="" border="0"><br><span message_id="236"></span></a>',close:'<a id="closeButton"><img src="'+ajxpResourcesFolder+'/images/actions/22/fileclose.png"  width="22" height="22" alt="" border="0"><br><span message_id="86"></span></a>'});this.createTitleSpans();this.initActions();modal.setCloseAction(function(){this.close()}.bind(this))},initActions:function(){this.actions=new Hash();var a=this.element.select(".action_bar");if(!a.length){this.actionBar=new Element("div",{className:"action_bar"});this.element.insert({top:this.actionBar})}else{this.actionBar=a[0]}if(!this.editorOptions.get("fullscreen")){this.defaultActions.unset("fs");this.defaultActions.unset("nofs")}this.actionBar.insert({top:this.toolbarSeparator});this.actionBar.insert({bottom:this.toolbarSeparator});this.actionBar.insert({bottom:this.defaultActions.values().join("\n")});this.actionBar.select("a").each(function(c){c.onclick=function(){return false};c.href="#";var b=c.select("span[message_id]")[0];if(b){b.update(MessageHash[b.readAttribute("message_id")])}this.actions.set(c.id,c)},this);if(this.actions.get("closeButton")){this.actions.get("closeButton").observe("click",function(){hideLightBox(true)}.bind(this));modal.setCloseValidation(function(){if(this.isModified&&!window.confirm(MessageHash[201])){return false}return true}.bind(this));if(window.ajxpMobile){this.actionBar.insert({top:this.actions.get("closeButton")})}}if(this.actions.get("fsButton")){this.actions.get("fsButton").observe("click",this.setFullScreen.bind(this));this.actions.get("nofsButton").observe("click",this.exitFullScreen.bind(this));this.actions.get("fsButton").show();this.actions.get("nofsButton").hide()}if(this.editorOptions.floatingToolbar){this.makeToolbarFloatable()}attachMobileScroll(this.actionBar,"horizontal")},makeToolbarFloatable:function(){this.actionBar.absolutize();this.actionBar.setStyle({zIndex:(parseInt(this.element.getStyle("zIndex"))+1000),width:"",top:"",bottom:20,left:"30%"})},createTitleSpans:function(){var a=$(modal.dialogTitle).select("span.titleString")[0];this.filenameSpan=new Element("span",{className:"filenameSpan"});a.insert({bottom:this.filenameSpan});this.modifSpan=new Element("span",{className:"modifiedSpan"});a.insert({bottom:this.modifSpan})},open:function(a){this.userSelection=a},updateTitle:function(a){if(a!=""){a=" - "+a}this.filenameSpan.update(a);if(this.fullScreenMode){this.refreshFullScreenTitle()}},setModified:function(a){this.isModified=a;this.modifSpan.update((a?"*":""));if(this.actions.get("saveButton")){if(a){this.actions.get("saveButton").removeClassName("disabled")}else{this.actions.get("saveButton").addClassName("disabled")}}if(this.fullScreenMode){this.refreshFullScreenTitle()}this.element.fire("editor:modified",a)},setFullScreen:function(){this.element.fire("editor:enterFS");if(!this.contentMainContainer){this.contentMainContainer=this.element}this.originalHeight=this.contentMainContainer.getHeight();this.originalWindowTitle=document.title;this.element.absolutize();this.actionBar.setStyle({marginTop:0});$(document.body).insert(this.element);this.element.setStyle({top:0,left:0,marginBottom:0,backgroundColor:"#fff",width:"100%",height:document.viewport.getHeight(),zIndex:3000});this.actions.get("fsButton").hide();this.actions.get("nofsButton").show();this.fullScreenListener=function(){this.element.setStyle({height:document.viewport.getHeight()});this.resize()}.bind(this);Event.observe(window,"resize",this.fullScreenListener);this.refreshFullScreenTitle();this.resize();this.fullScreenMode=true;this.element.fire("editor:enterFSend")},exitFullScreen:function(){if(!this.fullScreenMode){return}this.element.fire("editor:exitFS");Event.stopObserving(window,"resize",this.fullScreenListener);this.element.relativize();$$(".dialogContent")[0].insert(this.element);this.element.setStyle({top:0,left:0,zIndex:100});this.resize(this.originalHeight);this.actions.get("fsButton").show();this.actions.get("nofsButton").hide();document.title=this.originalWindowTitle;this.fullScreenMode=false;this.element.fire("editor:exitFSend")},resize:function(a){if(a){this.contentMainContainer.setStyle({height:a})}else{fitHeightToBottom(this.contentMainContainer,this.element)}this.element.fire("editor:resize",a)},close:function(){if(this.fullScreenMode){this.exitFullScreen()}this.element.fire("editor:close");modal.setCloseAction(null);return false},refreshFullScreenTitle:function(){document.title="AjaXplorer - "+$(modal.dialogTitle).innerHTML.stripTags().replace("&nbsp;","")},setOnLoad:function(b){addLightboxMarkupToElement(b);var a=document.createElement("img");a.src=ajxpResourcesFolder+"/images/loadingImage.gif";$(b).select("#element_overlay")[0].appendChild(a);this.loading=true},removeOnLoad:function(a){removeLightboxFromElement(a);this.loading=false},getPreview:function(b,a){src=AbstractEditor.prototype.getThumbnailSource(b);imgObject=new Element("img",{src:src,width:64,height:64,align:"absmiddle",border:0});imgObject.resizePreviewElement=function(f){f.maxWidth=f.maxHeight=64;var e=fitRectangleToDimension({width:64,height:64},f);if(f.width>=64){var d=parseInt(e.height);var c=parseInt((f.width-64)/2)+f.margin;var g=f.width+(f.margin*2)-d-c-1;e.marginTop=c+"px";e.marginBottom=g+"px"}this.setStyle(e)}.bind(imgObject);return imgObject},getThumbnailSource:function(a){return resolveImageSource(a.getIcon(),"/images/mimes/ICON_SIZE",64)}});Class.create("Modal",{pageLoading:true,initialize:function(){},initForms:function(){this.elementName="generic_dialog_box";this.htmlElement=$(this.elementName);this.dialogTitle=this.htmlElement.select(".dialogTitle")[0];this.dialogContent=this.htmlElement.select(".dialogContent")[0];this.currentForm;this.cachedForms=new Hash();this.iframeIndex=0},prepareHeader:function(a,d){var c='<span class="titleString">';if(d!=""){c='<span class="titleString"><img src="'+d.replace("22","16")+'" width="16" height="16" align="top"/>&nbsp;'}var b='<img id="modalCloseBtn" style="cursor:pointer;float:right;margin-top:2px;" src="'+ajxpResourcesFolder+'/images/actions/16/window_close.png" />';c+=a+"</span>";this.dialogTitle.update(b+c)},showDialogForm:function(n,g,e,f,l,o,h){this.clearContent(this.dialogContent);var m;if($(g).tagName=="FORM"){m=$(g);m.show()}else{var c=$(g);var m=document.createElement("form");m.id="modal_action_form";m.setAttribute("name","modal_action_form");m.setAttribute("action","cont.php");m.appendChild(c.cloneNode(true));var b=null;if($(m).getElementsByTagName("iframe")[0]){b=$(m).getElementsByTagName("iframe")[0];reloadIFrameSrc=$(m).getElementsByTagName("iframe")[0].getAttribute("src")}if(c.getAttribute("action")){var a=document.createElement("input");a.setAttribute("type","hidden");a.setAttribute("name","get_action");a.setAttribute("value",c.getAttribute("action"));m.appendChild(a)}}if(!this.cachedForms.get(g)&&!h){this.addSubmitCancel(m,l,o)}this.dialogContent.appendChild(m);var d=$(g).getAttribute("box_padding");if(!d){d=10}this.dialogContent.setStyle({padding:d});if(l){this.dialogTitle.select("#modalCloseBtn")[0].observe("click",function(){l(modal.getForm());hideLightBox()})}else{this.dialogTitle.select("#modalCloseBtn")[0].observe("click",function(){hideLightBox()})}if(f){m.onsubmit=function(){try{f(modal.getForm())}catch(p){alert("Unexpected Error : please report!\n"+p)}return false}}else{m.onsubmit=function(){ajaxplorer.actionBar.submitForm(modal.getForm());hideLightBox();return false}}this.showContent(this.elementName,$(g).getAttribute("box_width"),$(g).getAttribute("box_height"));if($(m).getElementsBySelector(".dialogFocus").length){objToFocus=$(m).getElementsBySelector(".dialogFocus")[0];setTimeout("objToFocus.focus()",500)}if($(m).getElementsBySelector(".replace_rep").length){repDisplay=$(m).getElementsBySelector(".replace_rep")[0];repDisplay.innerHTML=ajaxplorer.getContextHolder().getContextNode().getPath()}if($(m).getElementsBySelector(".replace_file").length){repDisplay=$(m).getElementsBySelector(".replace_file")[0];repDisplay.innerHTML=getBaseName(ajaxplorer.getUserSelection().getUniqueFileName())}if($(m).select(".dialogEnterKey").length&&Prototype.Browser.IE){$(m).select(".dialogEnterKey").each(function(p){if(p.enterObserver){return}p.observe("keypress",function(q){if(q.keyCode==Event.KEY_RETURN){m.onsubmit()}});p.enterObserver=true})}this.currentForm=m;if(e!=null){e(this.currentForm);this.refreshDialogAppearance()}if(Prototype.Browser.WebKit&&b&&reloadIFrameSrc){b.src=reloadIFrameSrc}},showContent:function(a,d,e,f){ajaxplorer.disableShortcuts();ajaxplorer.disableNavigation();ajaxplorer.blurAll();var c=$(document.body).getWidth();var b=$(document.body).getHeight();if(d!=null){if(d.indexOf("%")==-1&&parseInt(d)>c){d="90%"}if(d.indexOf("%")>-1){percentWidth=parseInt(d);d=parseInt((c*percentWidth)/100)}$(a).setStyle({width:d+"px"})}if(e!=null){if(e.indexOf("%")>-1){percentHeight=parseInt(e);e=parseInt((b*percentHeight)/100)}$(a).setStyle({height:e+"px"})}else{if(Prototype.Browser.IE){$(a).setStyle({height:"1%"})}else{$(a).setStyle({height:"auto"})}}this.refreshDialogPosition();displayLightBoxById(a);$(a).style.position="absolute";if(Prototype.Browser.Gecko){$(a).style.position="fixed"}else{if(Prototype.Browser.IE){$$("select").invoke("show");refreshPNGImages(this.dialogContent)}}if(f){return}Shadower.shadow($(a),{distance:3,angle:130,opacity:0.5,nestedShadows:3,color:"#000000",shadowStyle:{display:"block"}},true)},openEditorDialog:function(editorData){if(!editorData.formId){ajaxplorer.displayMessage("ERROR",'Error, you must define a formId attribute in your &lt;editor&gt; manifest (or set it as openable="false")');return}var editorKlass=editorData.editorClass;modal.prepareHeader(editorData.text,resolveImageSource(editorData.icon,"/images/actions/ICON_SIZE",16));var loadFunc=function(oForm){if(typeof(editorKlass)=="string"){ajaxplorer.actionBar.editor=eval("new "+editorKlass+"(oForm)")}else{ajaxplorer.actionBar.editor=new editorKlass(oForm)}ajaxplorer.actionBar.editor.open(ajaxplorer.getUserSelection())};this.showDialogForm("",editorData.formId,loadFunc,null,null,true,true)},getForm:function(){return this.currentForm},refreshDialogPosition:function(m,d){var c=$(document.body).getWidth();var e=$(document.body).getHeight();boxWidth=$(this.elementName).getWidth();var g=$(this.elementName).getHeight();if(m&&g>parseInt(e*90/100)){var h=parseInt(e*90/100);var f=d.getHeight();var l=g-f;if(h>l){d.setStyle({overflow:"auto",height:(h-l)+"px"});g=$(this.elementName).getHeight()}}var b=parseInt((c-parseInt(boxWidth))/2);$(this.elementName).setStyle({left:b+"px"});var a=parseInt(((e-g)/3));$(this.elementName).setStyle({top:a+"px"})},refreshDialogAppearance:function(){Shadower.shadow($(this.elementName),{distance:4,angle:130,opacity:0.5,nestedShadows:3,color:"#000000",shadowStyle:{display:"block"}},true)},clearContent:function(a){if(a.getElementsBySelector("form").length){var b=this;a.getElementsBySelector("form").each(function(c){if(c.target=="hidden_iframe"||c.id=="login_form"||c.id=="user_pref_form"){c.hide();b.cachedForms.set(c.id,true)}else{try{a.removeChild(c)}catch(d){}}})}},addSubmitCancel:function(g,d,b,a){var c=new Element("div",{className:"dialogButtons"});var h=new Element("input",{type:"image",name:(b?"close":"ok"),src:ajxpResourcesFolder+"/images/actions/22/dialog_"+(b?"close":"ok_apply")+".png",height:22,width:22,title:MessageHash[48]});h.addClassName("dialogButton");h.addClassName("dialogFocus");c.insert(h);if(!b){var f=new Element("input",{type:"image",name:"can",height:22,width:22,src:ajxpResourcesFolder+"/images/actions/22/dialog_close.png",title:MessageHash[49],className:"dialogButton"});if(d){f.observe("click",function(l){d(modal.getForm());hideLightBox();Event.stop(l);return false})}else{f.observe("click",function(l){hideLightBox();Event.stop(l);return false})}c.insert(f)}if(!a){a="bottom"}var e={};e[a]=c;$(g).insert(e);g.hasButtons=true;return c},simpleTooltip:function(a,b){a.observe("mouseover",function(d){var c=Event.pointerX(d)+10;var e=Event.pointerY(d)+10;if(!this.tooltip){this.tooltip=new Element("div",{className:"simple_tooltip"});$$("body")[0].insert(this.tooltip)}this.tooltip.update(b);this.tooltip.setStyle({top:e,left:c});if(this.tipTimer){window.clearTimeout(this.tipTimer)}this.tooltip.show()}.bind(this));a.observe("mouseout",function(c){if(!this.tooltip){return}this.tipTimer=window.setTimeout(function(){this.tooltip.hide()}.bind(this),300)}.bind(this))},closeMessageDiv:function(){if(this.messageDivOpen){new Effect.Fade(this.messageBox);this.messageDivOpen=false}},tempoMessageDivClosing:function(){this.messageDivOpen=true;setTimeout("modal.closeMessageDiv()",6000)},displayMessage:function(e,l){if(!this.messageBox){this.messageBox=new Element("div",{title:MessageHash[98],id:"message_div",className:"messageBox"});$(document.body).insert(this.messageBox);this.messageContent=new Element("div",{id:"message_content"});this.messageBox.update(this.messageContent);this.messageBox.observe("click",this.closeMessageDiv.bind(this))}l=l.stripScripts();l=l.replace(new RegExp("(\\n)","g"),"<br>");if(e=="ERROR"){this.messageBox.removeClassName("logMessage");this.messageBox.addClassName("errorMessage")}else{this.messageBox.removeClassName("errorMessage");this.messageBox.addClassName("logMessage")}this.messageContent.update(l);var a=$("content_pane");if(!a){a=$("ajxp_desktop")}var d=Position.cumulativeOffset(a);var g=a.getDimensions();var f=$(this.messageBox).getHeight();var h=d[1]+g.height-f-20;var c=parseInt(g.width*90/100);var b=d[0]+parseInt(g.width*5/100);this.messageBox.setStyle({top:h+"px",left:b+"px",width:c+"px"});new Effect.Corner(this.messageBox,"5px");new Effect.Appear(this.messageBox);this.tempoMessageDivClosing()},setLoadingStepCounts:function(a){this.loadingStepsCount=a;this.loadingStep=a},incrementStepCounts:function(a){this.loadingStepsCount+=a;this.loadingStep+=a},updateLoadingProgress:function(b){this.loadingStep--;var a=(1-(this.loadingStep/this.loadingStepsCount));if(window.loaderProgress){window.loaderProgress.setPercentage(parseInt(a)*100,false)}if(b&&$("progressState")){$("progressState").update(b)}if(this.loadingStep==0){this.pageLoading=false}return},setCloseValidation:function(a){this.closeValidation=a},setCloseAction:function(a){this.closeFunction=a},close:function(){Shadower.deshadow($(this.elementName));if(this.closeFunction){this.closeFunction()}}});var modal=new Modal();Class.create("BookmarksBar",{initialize:function(a){this.element=$(a);this.currentCount=0;this.bookmarks=$A([]);this.createMenu();document.observe("ajaxplorer:registry_loaded",function(b){this.parseXml(b.memo)}.bind(this));document.observeOnce("ajaxplorer:actions_loaded",function(){var b=ajaxplorer.actionBar.actions.get("bookmark");this.addBookmarkObject={name:b.getKeyedText(),alt:b.options.title,image:ajxpResourcesFolder+"/images/actions/16/bookmark_add.png",callback:function(d){var c=ajaxplorer.getContextNode();this.addBookmark(c.getPath(),c.getLabel())}.bind(this)}}.bind(this));document.observe("ajaxplorer:add_bookmark",function(){var b=ajaxplorer.getContextNode();this.addBookmark(b.getPath(),b.getLabel())}.bind(this))},parseXml:function(a){this.clear();var d=XPathSelectNodes(a,"user/bookmarks/bookmark");for(var b=0;b<d.length;b++){var c={name:d[b].getAttribute("title"),alt:d[b].getAttribute("path"),image:ajxpResourcesFolder+"/images/mimes/16/folder.png"};c.callback=function(f){ajaxplorer.goTo(this.alt)}.bind(c);c.moreActions=this.getContextActions(c.alt,c.name);this.bookmarks.push(c)}this.bmMenu.options.menuItems=this.bookmarks;this.bmMenu.refreshList();if(this.bookmarks.length){this.element.removeClassName("inline_disabled")}if(modal.pageLoading){modal.updateLoadingProgress("Bookmarks Loaded")}},createMenu:function(){this.bmMenu=new Proto.Menu({className:"menu bookmarksMenu",mouseClick:"left",anchor:this.element,createAnchor:false,topOffset:2,leftOffset:0,menuItems:this.bookmarks,fade:true,zIndex:2000})},clear:function(){this.currentCount=0;if(this.addBookmarkObject){this.bookmarks=$A([this.addBookmarkObject,{separator:true}])}else{this.bookmarks=$A()}this.element.addClassName("inline_disabled");this.bmMenu.options.menuItems=this.bookmarks;this.bmMenu.refreshList()},getContextActions:function(b,c){var d={name:MessageHash[146],alt:MessageHash[146],image:ajxpResourcesFolder+"/images/actions/16/delete_bookmark.png",disabled:false,className:"edit",callback:function(f){this.removeBookmark(b)}.bind(this)};var a={name:MessageHash[6],alt:MessageHash[6],image:ajxpResourcesFolder+"/images/actions/16/applix.png",disabled:false,className:"edit",callback:function(f){this.toggleRenameForm(b,c)}.bind(this)};return new Array(a,d)},toggleRenameForm:function(a,d){modal.prepareHeader(MessageHash[225],ajxpResourcesFolder+"/images/actions/16/bookmark.png");var b=function(e){$(e).bm_path.value=a;$(e).bm_title.value=d};var c=function(){this.renameBookmark(modal.getForm().bm_path.value,modal.getForm().bm_title.value);hideLightBox(true)}.bind(this);modal.showDialogForm("Rename","rename_bookmark",b,c)},load:function(b){var a=new Connexion();if(!b){b=new Hash()}b.set("get_action","get_bookmarks");a.setParameters(b);a.onComplete=function(c){document.observeOnce("ajaxplorer:registry_part_loaded",function(d){if(d.memo!="user/bookmarks"){return}this.parseXml(ajaxplorer.getXmlRegistry())}.bind(this));ajaxplorer.loadXmlRegistry(false,"user/bookmarks");this.bmMenu.refreshList();this.bmMenu.show()}.bind(this);a.sendAsync()},addBookmark:function(b,c){var a=new Hash();a.set("bm_action","add_bookmark");a.set("bm_path",b);if(c){a.set("bm_title",c)}this.load(a)},removeBookmark:function(b){var a=new Hash();a.set("bm_action","delete_bookmark");a.set("bm_path",b);this.load(a)},renameBookmark:function(b,c){var a=new Hash();a.set("bm_action","rename_bookmark");a.set("bm_path",b);a.set("bm_title",c);this.load(a)}});Class.create("FormManager",{initialize:function(){},replicateRow:function(b,e,d){for(var c=0;c<e-1;c++){tr=$(b.cloneNode(true));if(tr.id){tr.id=tr.id+"_"+(c+1)}var a=tr.select("input","select","textarea");a.each(function(g){var f=g.getAttribute("name")+"_"+(c+1);g.setAttribute("name",f);if(d&&Prototype.Browser.IE){d[f]=g}});b.up().insert({bottom:tr})}b.select("input","select","textarea").each(function(g){var f=g.getAttribute("name")+"_0";g.setAttribute("name",f);if(d&&Prototype.Browser.IE){d[f]=g}})},fetchValueToForm:function(b,a,c,d){$A(a).each(function(g){if(!c[g]){return}if(d!=null){realFieldName=g+"_"+d}else{realFieldName=g}var e=b[realFieldName];if(!e){return}var f=e.nodeName.toLowerCase();switch(f){case"input":if(e.getAttribute("type")=="checkbox"){if(e.value==c[g]){e.checked=true}}else{e.value=c[g]}break;case"select":e.select("option").each(function(h){if(h.value==c[g]){h.selected=true}});break;case"textarea":e.update(c[g]);e.value=c[g];break;default:break}})},fetchMultipleValueToForm:function(d,a,b){var c=0;$A(b).each(function(e){this.fetchValueToForm(d,a,e,c);c++}.bind(this))}});Class.create("MultiDownloader",{initialize:function(a,b){this.list_target=a;this.count=0;this.id=0;this.downloadUrl=b},addListRow:function(c){this.count++;var a=new Element("div");var b=new Element("a");b.href=this.downloadUrl+c;b.insert('<img src="'+ajxpResourcesFolder+'/images/actions/16/download_manager.png" height="16" width="16" align="absmiddle" border="0"> '+getBaseName(c));b.multidownloader=this;b.onclick=function(){this.parentNode.parentNode.removeChild(this.parentNode);this.multidownloader.count--;if(this.multidownloader.count==0&&this.multidownloader.triggerEnd){this.multidownloader.triggerEnd()}gaTrackEvent("Data","Download",c)};a.insert(b);$(this.list_target).insert(a)},emptyList:function(){}});Class.create("ActivityMonitor",{_serverSessionTime:0,_warningTime:0,_logoutTime:0,_warningMinutes:3,_renewMinutes:10,_logoutMinutes:0,_lastActive:0,_state:"active",initialize:function(c,a,d){if(!c){return}this._serverSessionTime=c;if(d){this._warningMinutes=d}this._warningTime=a-this._warningMinutes*60;this._logoutTime=a-this._logoutMinutes*60;this._renewTime=c-this._renewMinutes*60;this._lastActive=this.getNow();var b=this.activityObserver.bind(this);document.observe("ajaxplorer:user_logged",function(){this._lastActive=this.getNow();if(this.interval){window.clearInterval(this.interval)}if(this.serverInterval){window.clearInterval(this.serverInterval)}$(document.body).stopObserving("keypress",b);$(document.body).stopObserving("mouseover",b);$(document.body).stopObserving("mousemove",b);document.stopObserving("ajaxplorer:server_answer",b);this._state="inactive";if(ajaxplorer.user){this._state="active";$(document.body).observe("keypress",b);$(document.body).observe("mouseover",b);$(document.body).observe("mousemove",b);document.observe("ajaxplorer:server_answer",b);this.interval=window.setInterval(this.idleObserver.bind(this),5000);this.serverInterval=window.setInterval(this.serverObserver.bind(this),this._renewTime*1000)}}.bind(this))},activityObserver:function(){if(this._state=="warning"){return}if(this.timer){window.clearTimeout(this.timer)}this.timer=window.setTimeout(this.activityUpdater.bind(this),1000)},activityUpdater:function(){this._lastActive=this.getNow()},serverObserver:function(){new Ajax.Request(window.ajxpServerAccessPath,{method:"get",parameters:{ping:"true"}})},idleObserver:function(){if(this._state=="inactive"){return}var a=(this.getNow()-this._lastActive);if(a>=this._logoutTime){this.removeWarningState();this._state="active";if(this.interval){window.clearInterval(this.interval)}if(this.serverInterval){window.clearInterval(this.serverInterval)}ajaxplorer.actionBar.fireDefaultAction("expire");return}if(a>=this._warningTime){if(this._state=="active"){this.setWarningState()}this.updateWarningTimer((this._logoutTime-a))}},exitIdleState:function(){this.removeWarningState();this.activityUpdater();this._state="active";window.clearInterval(this.interval);this.interval=window.setInterval(this.idleObserver.bind(this),5000)},setWarningState:function(){this._state="warning";window.clearInterval(this.interval);this.interval=window.setInterval(this.idleObserver.bind(this),1000);if(!this.warningPane){var a=MessageHash[375].replace("__IDLE__",Math.round(this._warningTime/60)+"mn");a=a.replace("__LOGOUT__",'<span class="warning_timer"></span>');this.warningPane=new Element("div",{id:"activity_monitor_warning",className:"dialogBox",style:"padding:3px"}).update('<div class="dialogContent">'+a+'<br><span class="click_anywhere">'+MessageHash[376]+"</span></div>");$(document.body).insert(this.warningPane)}displayLightBoxById("activity_monitor_warning");$("overlay").setStyle({cursor:"pointer"});$("overlay").observeOnce("click",this.exitIdleState.bind(this));$("activity_monitor_warning").observeOnce("click",this.exitIdleState.bind(this));new Effect.Shake(this.warningPane);this.opaFx=new Effect.Opacity($("overlay"),{from:0.4,to:1,duration:this._warningMinutes*60})},updateWarningTimer:function(b){var a=Math.floor(b/60)+"mn"+(b%60)+"s";this.warningPane.down("span.warning_timer").update(a);if(this.warningPane.visible()&&b%60%10==0){new Effect.Shake(this.warningPane)}},removeWarningState:function(){if(this.opaFx){this.opaFx.cancel()}$("overlay").setStyle({cursor:"default",opacity:0.4});hideLightBox()},getNow:function(){return Math.round((new Date()).getTime()/1000)}});Class.create("Ajaxplorer",{initialize:function(c,a,b){this._initLoadRep=c;this._initObj=true;this.usersEnabled=a;this._initLoggedUser=b;this._contextHolder=new AjxpDataModel();this._contextHolder.setAjxpNodeProvider(new RemoteNodeProvider());this._focusables=[];this._registry=null;this._resourcesRegistry={};this._initDefaultDisp="list";this.histCount=0;this._guiComponentsConfigs=new Hash()},init:function(){document.observe("ajaxplorer:registry_loaded",function(){this.refreshExtensionsRegistry();this.logXmlUser(this._registry);this.loadActiveRepository();if(this.guiLoaded){this.refreshTemplateParts();this.refreshGuiComponentConfigs()}else{document.observe("ajaxplorer:gui_loaded",function(){this.refreshTemplateParts();this.refreshGuiComponentConfigs()}.bind(this))}}.bind(this));modal.setLoadingStepCounts(5);this.loadXmlRegistry(true);this.initTemplates();modal.initForms();this.initObjects();window.setTimeout(function(){document.fire("ajaxplorer:loaded")},500)},loadXmlRegistry:function(a,c){var b=new Connexion();b.onComplete=function(d){if(d.responseXML==null||d.responseXML.documentElement==null){return}if(d.responseXML.documentElement.nodeName=="ajxp_registry"){this._registry=d.responseXML.documentElement;modal.updateLoadingProgress("XML Registry loaded");if(!a){document.fire("ajaxplorer:registry_loaded",this._registry)}}else{if(d.responseXML.documentElement.nodeName=="ajxp_registry_part"){this.refreshXmlRegistryPart(d.responseXML.documentElement)}}}.bind(this);b.addParameter("get_action","get_xml_registry");if(c){b.addParameter("xPath",c)}if(a){b.sendSync()}else{b.sendAsync()}},refreshXmlRegistryPart:function(d){var e=d.getAttribute("xPath");var c=XPathSelectSingleNode(this._registry,e);if(c&&c.parentNode){var a=c.parentNode;a.removeChild(c);if(d.firstChild){a.appendChild(d.firstChild.cloneNode(true))}}else{if(e.indexOf("/")>-1){var b=e.substring(0,e.lastIndexOf("/"));var a=XPathSelectSingleNode(this._registry,b);if(a&&d.firstChild){a.appendChild(d.firstChild.cloneNode(true))}}else{if(d.firstChild){this._registry.appendChild(d.firstChild.cloneNode(true))}}}document.fire("ajaxplorer:registry_part_loaded",e)},initObjects:function(){this.contextMenu=new Proto.Menu({selector:"",className:"menu desktop",menuItems:[],fade:true,zIndex:2000});var c=this.contextMenu;c.options.beforeShow=function(h){this.options.lastElement=Event.element(h);this.options.menuItems=ajaxplorer.actionBar.getContextActions(Event.element(h));this.refreshList()}.bind(c);c.options.beforeHide=function(h){this.options.lastElement=null}.bind(c);document.observe("ajaxplorer:actions_refreshed",function(){if(this.options.lastElement){this.options.menuItems=ajaxplorer.actionBar.getContextActions(this.options.lastElement);this.refreshList()}}.bind(c));this.actionBar=new ActionsManager(this.usersEnabled);if(this._registry){this.actionBar.loadActionsFromRegistry(this._registry)}document.observe("ajaxplorer:registry_loaded",function(h){this.actionBar.loadActionsFromRegistry(h.memo)}.bind(this));if(!Prototype.Browser.WebKit&&!Prototype.Browser.IE){this.history=new Proto.History(function(h){this.goTo(this.historyHashToPath(h))}.bind(this));document.observe("ajaxplorer:context_changed",function(h){this.updateHistory(this.getContextNode().getPath())}.bind(this))}else{document.observe("ajaxplorer:context_changed",function(h){var l=this.getContextNode().getPath();document.title="AjaXplorer - "+(getBaseName(l)?getBaseName(l):"/")}.bind(this))}document.observe("ajaxplorer:context_changed",function(h){if(this.skipLsHistory||!this.user||!this.user.getActiveRepository()){return}window.setTimeout(function(){var l=this.user.getPreference("ls_history",true)||{};l=new Hash(l);l.set(this.user.getActiveRepository(),this.getContextNode().getPath());this.user.setPreference("ls_history",l,true);this.user.savePreference("ls_history")}.bind(this),100)}.bind(this));modal.updateLoadingProgress("Actions Initialized");this.activityMonitor=new ActivityMonitor(window.ajxpBootstrap.parameters.get("session_timeout"),window.ajxpBootstrap.parameters.get("client_timeout"),window.ajxpBootstrap.parameters.get("client_timeout_warning"));this.guiLoaded=false;this.buildGUI($(ajxpBootstrap.parameters.get("MAIN_ELEMENT")));document.fire("ajaxplorer:before_gui_load");var e;if(this.guiCompRegistry&&this.guiCompRegistry.length){for(var b=this.guiCompRegistry.length;b>0;b--){var d=this.guiCompRegistry[b-1];var g=d.ajxpId;this.guiCompRegistry[b-1]=new d.ajxpClass(d.ajxpNode,d.ajxpOptions);window[g]=this.guiCompRegistry[b-1];e=this.guiCompRegistry[b-1]}if(e){e.resize()}for(var a=0;a<this.guiCompRegistry.length;a++){var f=this.guiCompRegistry[a];if(Class.objectImplements(f,"IFocusable")){f.setFocusBehaviour();this._focusables.push(f)}if(Class.objectImplements(f,"IContextMenuable")){f.setContextualMenu(this.contextMenu)}if(Class.objectImplements(f,"IActionProvider")){if(!this.guiActions){this.guiActions=new Hash()}this.guiActions.update(f.getActions())}}}this.guiLoaded=true;document.fire("ajaxplorer:gui_loaded");modal.updateLoadingProgress("GUI Initialized");this.initTabNavigation();this.blockShortcuts=false;this.blockNavigation=false;modal.updateLoadingProgress("Navigation loaded");this.tryLogUserFromCookie();document.fire("ajaxplorer:registry_loaded",this._registry)},buildGUI:function(d){if(d.nodeType!=1){return}if(!this.guiCompRegistry){this.guiCompRegistry=$A([])}d=$(d);var b=d.readAttribute("ajxpClass")||"";var c=Class.getByName(b);var e=d.readAttribute("id")||"";var a={};if(d.readAttribute("ajxpOptions")){a=d.readAttribute("ajxpOptions").evalJSON()}if(c&&e&&Class.objectImplements(c,"IAjxpWidget")){this.guiCompRegistry.push({ajxpId:e,ajxpNode:d,ajxpClass:c,ajxpOptions:a})}$A(d.childNodes).each(function(f){this.buildGUI(f)}.bind(this))},refreshTemplateParts:function(){var d=XPathSelectNodes(this._registry,"client_configs/template_part");for(var c=0;c<d.length;c++){var e=d[c].getAttribute("ajxpId");var b=Class.getByName(d[c].getAttribute("ajxpClass"));var a=d[c].getAttribute("ajxpOptions").evalJSON();if(b&&e&&Class.objectImplements(b,"IAjxpWidget")){this.refreshGuiComponent(e,b,a)}}},refreshGuiComponent:function(e,c,a){if(!window[e]){return}var b=window[e];if(Class.objectImplements(b,"IFocusable")){this._focusables=this._focusables.without(b)}if(Class.objectImplements(b,"IActionProvider")){b.getActions().each(function(f){this.guiActions=this.guiActions.without(f)}.bind(this))}var d=new c($(e),a);if(Class.objectImplements(d,"IFocusable")){d.setFocusBehaviour();this._focusables.push(d)}if(Class.objectImplements(d,"IContextMenuable")){d.setContextualMenu(this.contextMenu)}if(Class.objectImplements(d,"IActionProvider")){if(!this.guiActions){this.guiActions=new Hash()}this.guiActions.update(d.getActions())}window[e]=d;d.resize();delete (b)},refreshGuiComponentConfigs:function(){var a=XPathSelectNodes(this._registry,"client_configs/component_config");if(!a.length){return}for(var b=0;b<a.length;b++){this.setGuiComponentConfig(a[b])}},setGuiComponentConfig:function(b){var a=b.getAttribute("className");var d=b.getAttribute("classId")||null;var c=this._guiComponentsConfigs.get(a)||new Hash();if(d){c.set(d,b)}else{c.set("all",b)}this._guiComponentsConfigs.set(a,c);document.fire("ajaxplorer:component_config_changed",{className:a,classConfig:c})},tryLogUserFromCookie:function(){var b=new Connexion();var a=retrieveRememberData();if(a!=null){b.addParameter("get_action","login");b.addParameter("userid",a.user);b.addParameter("password",a.pass);b.addParameter("cookie_login","true");b.onComplete=function(c){this.actionBar.parseXmlMessage(c.responseXML)}.bind(this);b.sendAsync()}},logXmlUser:function(d,a){this.user=null;var e=XPathSelectSingleNode(d,"user");if(e){var c=e.getAttribute("id");var b=e.childNodes;if(c){this.user=new User(c,b)}}if(!a){document.fire("ajaxplorer:user_logged",this.user)}},loadActiveRepository:function(){var b=new Repository(null);if(this.user!=null){var a=this.user.getActiveRepository();var d=this.user.getRepositoriesList();b=d.get(a);if(!b){alert("No active repository found for user!")}if(this.user.getPreference("pending_folder")&&this.user.getPreference("pending_folder")!="-1"){this._initLoadRep=this.user.getPreference("pending_folder");this.user.setPreference("pending_folder","-1");this.user.savePreference("pending_folder")}else{if(this.user.getPreference("ls_history",true)){var c=new Hash(this.user.getPreference("ls_history",true));this._initLoadRep=c.get(a)}}}this.loadRepository(b);if(d&&a){document.fire("ajaxplorer:repository_list_refreshed",{list:d,active:a})}else{document.fire("ajaxplorer:repository_list_refreshed",{list:false,active:false})}},reloadRepositoriesList:function(){if(!this.user){return}document.observeOnce("ajaxplorer:registry_part_loaded",function(a){if(a.memo!="user/repositories"){return}this.logXmlUser(this._registry,true);repId=this.user.getActiveRepository();repList=this.user.getRepositoriesList();document.fire("ajaxplorer:repository_list_refreshed",{list:repList,active:repId})}.bind(this));this.loadXmlRegistry(false,"user/repositories")},loadRepository:function(c){c.loadResources();var d=c.getId();var b=c.getIcon();this.skipLsHistory=true;var a=new AjxpNode("/",false,c.getLabel(),b);this._contextHolder.setRootNode(a);if(this.repositoryId==null||this.repositoryId!=d){a.load()}if(!this._initObj){this.repositoryId=d}else{this._initObj=null}if(this._initLoadRep){if(this._initLoadRep!=""&&this._initLoadRep!="/"){var e=this._initLoadRep.valueOf();this._initLoadRep=null;a.observeOnce("loaded",function(){setTimeout(function(){if(this.pathExists(e)){this.goTo(new AjxpNode(e))}this.skipLsHistory=false}.bind(this),1000)}.bind(this))}else{this.skipLsHistory=false}}else{this.skipLsHistory=false}},pathExists:function(a){var b=new Connexion();b.addParameter("get_action","stat");b.addParameter("file",a);this.tmpResTest=false;b.onComplete=function(c){if(c.responseJSON&&c.responseJSON.mode){this.tmpResTest=true}}.bind(this);b.sendSync();return this.tmpResTest},goTo:function(a){if(Object.isString(a)){node=new AjxpNode(a)}else{node=a}this._contextHolder.requireContextChange(node)},triggerRepositoryChange:function(c){document.fire("ajaxplorer:trigger_repository_switch");var b=new Connexion();b.addParameter("get_action","switch_repository");b.addParameter("repository_id",c);oThis=this;b.onComplete=function(d){this.loadXmlRegistry()}.bind(this);var a=this._contextHolder.getRootNode();if(a){this.skipLsHistory=true;a.clear()}b.sendAsync()},initExtension:function(xmlNode,extensionDefinition){var activeCondition=XPathSelectSingleNode(xmlNode,"processing/activeCondition");if(activeCondition&&activeCondition.firstChild){try{var func=new Function(activeCondition.firstChild.nodeValue.strip());if(func()===false){return false}}catch(e){}}if(xmlNode.nodeName=="editor"){Object.extend(extensionDefinition,{openable:(xmlNode.getAttribute("openable")=="true"?true:false),formId:xmlNode.getAttribute("formId")||null,text:MessageHash[xmlNode.getAttribute("text")],title:MessageHash[xmlNode.getAttribute("title")],icon:xmlNode.getAttribute("icon"),editorClass:xmlNode.getAttribute("className"),mimes:$A(xmlNode.getAttribute("mimes").split(",")),write:(xmlNode.getAttribute("write")&&xmlNode.getAttribute("write")=="true"?true:false)})}else{if(xmlNode.nodeName=="uploader"){var clientForm=XPathSelectSingleNode(xmlNode,"processing/clientForm");if(clientForm&&clientForm.firstChild&&clientForm.getAttribute("id")){extensionDefinition.formId=clientForm.getAttribute("id");if(!$("all_forms").select('[id="'+clientForm.getAttribute("id")+'"]').length){$("all_forms").insert(clientForm.firstChild.nodeValue)}}var extensionOnInit=XPathSelectSingleNode(xmlNode,"processing/extensionOnInit");if(extensionOnInit&&extensionOnInit.firstChild){try{eval(extensionOnInit.firstChild.nodeValue)}catch(e){}}var dialogOnOpen=XPathSelectSingleNode(xmlNode,"processing/dialogOnOpen");if(dialogOnOpen&&dialogOnOpen.firstChild){extensionDefinition.dialogOnOpen=dialogOnOpen.firstChild.nodeValue}var dialogOnComplete=XPathSelectSingleNode(xmlNode,"processing/dialogOnComplete");if(dialogOnComplete&&dialogOnComplete.firstChild){extensionDefinition.dialogOnComplete=dialogOnComplete.firstChild.nodeValue}}}return true},refreshExtensionsRegistry:function(){this._extensionsRegistry={editor:$A([]),uploader:$A([])};var c=XPathSelectNodes(this._registry,"plugins/editor|plugins/uploader");for(var b=0;b<c.length;b++){var e={id:c[b].getAttribute("id"),xmlNode:c[b],resourcesManager:new ResourcesManager()};this._resourcesRegistry[e.id]=e.resourcesManager;for(var a=0;a<c[b].childNodes.length;a++){var d=c[b].childNodes[a];e.resourcesManager.loadFromXmlNode(d)}if(this.initExtension(c[b],e)){this._extensionsRegistry[c[b].nodeName].push(e)}}ResourcesManager.prototype.loadAutoLoadResources(this._registry)},getActiveExtensionByType:function(b){var a=$A();return this._extensionsRegistry[b]},findEditorById:function(a){return this._extensionsRegistry.editor.detect(function(b){return(b.id==a)})},findEditorsForMime:function(c){var b=$A([]);var a=false;if(this.user!=null&&!this.user.canWrite()){a=true}this._extensionsRegistry.editor.each(function(d){if(d.mimes.include(c)){if(!a||!d.write){b.push(d)}}});return b},loadEditorResources:function(b){var a=this._resourcesRegistry;b.load(a)},initTemplates:function(){if(!this._registry){return}var c=XPathSelectNodes(this._registry,"client_configs/template");for(var b=0;b<c.length;b++){var e=c[b].getAttribute("element");if($(e)||$$(e).length){if($(e)){e=$(e)}else{e=$$(e)[0]}var a=c[b].getAttribute("position");var d={};d[a]=c[b].firstChild.nodeValue;e.insert(d);d[a].evalScripts()}}modal.updateLoadingProgress("Html templates loaded")},triggerDownload:function(a){document.location.href=a},loadI18NMessages:function(a){var b=new Connexion();b.addParameter("get_action","get_i18n_messages");b.onComplete=function(e){if(e.responseText){var c=e.responseText.evalScripts();MessageHash=c[0];for(var d in MessageHash){MessageHash[d]=MessageHash[d].replace("\\n","\n")}this.updateI18nTags();if(this.guiActions){this.guiActions.each(function(f){f.value.refreshFromI18NHash()})}this.loadXmlRegistry();this.fireContextRefresh();this.currentLanguage=a}}.bind(this);b.sendSync()},updateI18nTags:function(){var a=$$("[ajxp_message_id]");a.each(function(b){var c=b.getAttribute("ajxp_message_id");try{b.update(MessageHash[c])}catch(d){}})},loadSeedOrCaptcha:function(e,b,d,a){var c=new Connexion();c.addParameter("get_action","get_seed");c.onComplete=function(m){if(m.responseJSON){e.value=m.responseJSON.seed;var l=window.ajxpServerAccessPath+"&get_action=get_captcha&sid="+Math.random();var h=ajxpResourcesFolder+"/images/actions/16/reload.png";if(b){b.src=l}else{var g={};var f='<div class="main_captcha_div"><div class="dialogLegend" ajxp_message_id="389">'+MessageHash[389]+"</div>";f+='<div class="captcha_container"><img id="captcha_image" align="top" src="'+l+'" width="170" height="80"><img align="top" style="cursor:pointer;" id="captcha_refresh" src="'+h+'" with="16" height="16"></div>';f+='<div class="SF_element">';f+='		<div class="SF_label" ajxp_message_id="390">'+MessageHash[390]+'</div> <div class="SF_input"><input type="text" class="dialogFocus dialogEnterKey" style="width: 100px; padding: 0px;" name="captcha_code"></div>';f+="</div>";f+='<div style="clear:left;margin-bottom:7px;"></div></div>';g[a]=f;d.insert(g);modal.refreshDialogPosition();modal.refreshDialogAppearance();$("captcha_refresh").observe("click",function(){$("captcha_image").src=window.ajxpServerAccessPath+"&get_action=get_captcha&sid="+Math.random()})}}else{e.value=m.responseText;if(b){b.up(".main_captcha_div").remove();modal.refreshDialogPosition();modal.refreshDialogAppearance()}}};c.sendSync()},updateHistory:function(a){if(this.history){this.history.historyLoad(this.pathToHistoryHash(a))}},pathToHistoryHash:function(b){document.title="AjaXplorer - "+(getBaseName(b)?getBaseName(b):"/");if(!this.pathesHash){this.pathesHash=new Hash();this.histCount=-1}var a;this.pathesHash.each(function(c){if(c.value==b){a=c.key}});if(a!=undefined){return a}this.histCount++;this.pathesHash.set(this.histCount,b);return this.histCount},historyHashToPath:function(b){if(!this.pathesHash){return"/"}var a=this.pathesHash.get(b);if(a==undefined){return"/"}return a},updateContextData:function(b,c,a){if(b){this._contextHolder.requireContextChange(b)}if(c){this._contextHolder.setSelectedNodes(c,a)}},getContextHolder:function(){return this._contextHolder},getContextNode:function(){return this._contextHolder.getContextNode()||new AjxpNode("")},getUserSelection:function(){return this._contextHolder},fireContextRefresh:function(){this.getContextHolder().requireContextChange(this.getContextNode(),true)},fireNodeRefresh:function(a){this.getContextHolder().requireNodeReload(a)},fireContextUp:function(){if(this.getContextNode().isRoot()){return}this.updateContextData(this.getContextNode().getParent())},getXmlRegistry:function(){return this._registry},cancelCopyOrMove:function(){this.actionBar.treeCopyActive=false;hideLightBox();return false},disableShortcuts:function(){this.blockShortcuts=true},enableShortcuts:function(){this.blockShortcuts=false},disableNavigation:function(){this.blockNavigation=true},enableNavigation:function(){this.blockNavigation=false},getActionBar:function(){return this.actionBar},displayMessage:function(a,b){var c=parseUrl(b);if(c.length&&this.user&&this.user.repositories){c.each(function(d){var e=this.user.repositories.get(d.host);if(!e){return}b=b.replace(d.url,e.label+":"+d.path+d.file)}.bind(this))}modal.displayMessage(a,b)},focusOn:function(a){this._focusables.each(function(b){if(b!=a){b.blur()}});a.focus()},blurAll:function(){this._focusables.each(function(a){if(a.hasFocus){this._lastFocused=a}a.blur()}.bind(this))},focusLast:function(){if(this._lastFocused){this.focusOn(this._lastFocused)}},initTabNavigation:function(){var a=this._focusables;Event.observe(document,"keydown",function(f){if(f.keyCode==Event.KEY_TAB){if(this.blockNavigation){return}var c=f.shiftKey;var d=false;for(i=0;i<a.length;i++){if(a[i].hasFocus){a[i].blur();var b;if(c){if(i>0){b=i-1}else{b=(a.length)-1}}else{if(i<a.length-1){b=i+1}else{b=0}}a[b].focus();d=true;break}}if(!d&&a[0]){this.focusOn(a[0])}Event.stop(f)}if(this.blockShortcuts||f.ctrlKey){return}if(f.keyCode>90||f.keyCode<65){return}else{return this.actionBar.fireActionByKey(f,String.fromCharCode(f.keyCode).toLowerCase())}}.bind(this))}});